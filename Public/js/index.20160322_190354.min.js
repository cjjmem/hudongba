/**
 * Created by joo on 2015/8/10.
 */
var _zbfScroll = {
  _len: "",
  _init: function() {
    _zbfScroll._len = $(".scrollcontainer ul li a").length;
    if(_zbfScroll._len % 2 == 1){
    	$(".scrollcontainer ul li").eq((_zbfScroll._len-1)/2).remove();
    }
    if(_zbfScroll._len<6){
    	$("#zbfDiv").hide();
    }else if(_zbfScroll._len==6 || _zbfScroll._len==7){
    	$(".zbf_scroll_btn").css("visibility","hidden");
    }else if(_zbfScroll._len>7){
    	$(function(){
    	    $(".productshow").Xslider({
    			unitdisplayed:3,
    			numtoMove:3,
    			autoscroll:4000,
    			loop:"cycle"
    		});
        });
    }
  }
}

var _zbfHeight = {
  _addH : 1,
  _init:function(){
	_zbfHeight._addH = 1;
	var _l = $(".jxhdLb_Ul li").length;
	var _r = $(".zbf_Qu ul li").length;
	if(_l<2){
		$(".zbf_Qu ul li").each(function(){
			if($(this).index()<3){
				$(this).css("display","block");
			}
		});
	}else{
		for(var i=0;i<_r;i++){
			_zbfHeight._addH = _zbfHeight._addH + $(".zbf_Qu ul li").eq(i).height() ;
			if(_zbfHeight._addH < (_l*190)){
				$(".zbf_Qu ul li").eq(i).css("display","block");
			}
		}
	}
	
	$(".hdLb_Li").each(function(){
	  if($(this).find(".hdLb_Li_dizhiQu").children("p").length==2){
	    $(this).find(".hdLb_Li_address").width(310);
	    $(this).find(".hdLb_Li_address").children("span").width(290);
	  }else if($(this).find(".hdLb_Li_dizhiQu").children("p").length==1 && $(this).find(".hdLb_Li_address").length!=0){
		$(this).find(".hdLb_Li_address").width(440);
		$(this).find(".hdLb_Li_address").children("span").width(420);
	  }
	})
  }
}

var _activiAddress={//活动地址筛选
  _open:false,
  _areaid:_info._area_id,
  _areaname:_info._area_name,
  _areacode: "",
  _init : function(){
    $(".activity_address_tc_ul").css({"max-height":$(window).height()-32+"px"});
    if(_activiAddress._open == false){
      _tc._show('activity_address_tc');
    }else{
      _tc._hide('activity_address_tc');
    }
  },
  _hidden : function(){
  	_tc._hide('activity_address_tc');
  }
};

var _newFind = {
  _init:function(){
    var w = $("body").width();
    if(_user._login()){//登录前后设置
    $(".index_re_LoginAfter").show();
    }else{
      $(".index_re_LoginFront").show();
    }
    $(".login_tit").css("max-width",w-210+"px");
    if(_user._useIOs()){
      $(".index_re_Top .re_top_btn2 a,.index_re_Top .re_top_btn1 a").css("background-position-y",2+"px");
    }
    $(".index_re_Zt2 ul li a img").height($(".index_re_Zt2 ul li a img").width()*0.55);
    $(".index_re_Zt2 ul li a span").width((w-22)/2);
    $(".index_re_Zt2 ul li").each(function(){
      $(this).find("span").css("top",($(this).height()-$(this).find("span").height())/2+"px");
    });
  }
}

if (_pub_client== "mb") {
  var _info = {
    _coverImageUrl: ""
  };
  $(function() {
    app.TabSlider('#tabSlider', {
      auto: false,
      type: 'slide'
    });
    _onclick_href = function(categoryId) {
      _g("" + _domain + "find?category_id=" + categoryId);
    };
  });
  $(window).bind("resize", app.TabSlider('#tabSlider', {
    auto: false,
    type: 'slide'
  }));
  $(document).ready(function() {
    var w = $(".act_choice_top").width();
    $(".act_choice .act_choice_ul li a div img").height((w / 2 - 20) * 0.69);
    $(".act_topic .act_topic_t div.r p a img").height((w / 2 - 4) * 0.56);
    _hdbLoad._run(".dt_content_pic img");
  });
} else {
  $(".user_address_ul li a").click(function() { //地域筛选
    var _area_id = $(this).attr("id");
    var _area_name = $(this).html();
    var _area_code = $(this).attr("name");
    if (_area_code == "-1") {
      window.location.href = "" + _domain + "quanguo/";
    } else {
      window.location.href = "" + _domain + _area_code + "/";
    }
  });
  //首页的鼠标移动到图片，图片底部滑动显示时间和地点
  $(".hd_setup_7 li span").each(function() {
    var h = $(this).height();
    $(this).css({
      "bottom": 36 - h + "px"
    });
  });
  $(".hd_setup_7 .first a").mouseover(function() {
    $(this).children("div").animate({
      height: "96px"
    }, 100);
  });
  $(".hd_setup_7 .first a").mouseleave(function() {
    $(this).children("div").animate({
      height: "36px"
    }, 100);
  });
  $(".hd_setup_7 .other a").mouseover(function() {
    var _h = $(this).children("b").height();
    if (_h != 20) {
      $(this).children("span").css({
        "line-height": 20 + "px",
        "padding-top": 8 + "px",
        "padding-bottom": 8 + "px"
      });
      $(this).children("span").animate({
        height: _h + "px"
      }, 100);
    }
  });
  $(".hd_setup_7 .other a").mouseleave(function() {
    var _h = $(this).children("b").height();
    if (_h != 20) {
      $(this).children("span").animate({
        height: 36 + "px"
      }, 100);
      $(this).children("span").css({
        "line-height": 36 + "px",
        "padding-top": 0 + "px",
        "padding-bottom": 0 + "px"
      });
    }
  });
  //调用图片懒加载
  _hdbLoad._run(".dt_content_pic img");
  //首页的图片轮播
  (function($) { //焦点图js
    $.extend({
      'foucs': function(con) {
        var $container = $('#index_b_hero'),
          $imgs = $container.find('li.hero'),
          $leftBtn = $container.find('a.prev'),
          $rightBtn = $container.find('a.next'),
          config = {
            interval: con && con.interval || 3500,
            animateTime: con && con.animateTime || 500,
            direction: con && (con.direction === 'left'),
            _imgLen: $imgs.length
          },
          i = 0,
          getNextIndex = function(y) {
            return i + y >= config._imgLen ? i + y - config._imgLen : i + y;
          },
          getPrevIndex = function(y) {
            return i - y < 0 ? config._imgLen + i - y : i - y;
          },
          silde = function(d) {
            $imgs.eq((d ? getPrevIndex(2) : getNextIndex(2))).css('left', (d ? '-2000px' : '2000px'));
            $imgs.animate({
              'left': (d ? '+' : '-') + '=1000px'
            }, config.animateTime);
            i = d ? getPrevIndex(1) : getNextIndex(1);
          },
          s = setInterval(function() {
            silde(config.direction);
          }, config.interval);
        $imgs.eq(i).css('left', 0).end().eq(i + 1).css('left', '1000px').end().eq(i - 1).css('left', '-1000px');
        $container.find('.hero-wrap').add($leftBtn).add($rightBtn).hover(function() {
          clearInterval(s);
        }, function() {
          s = setInterval(function() {
            silde(config.direction);
          }, config.interval);
        });
        $leftBtn.click(function() {
          if ($(':animated').length === 0) {
            silde(false);
          }
        });
        $rightBtn.click(function() {
          if ($(':animated').length === 0) {
            silde(true);
          }
        });
      }
    });
  }(jQuery));
  $.foucs({
    direction: 'right'
  });
  //跳转指定页码
  $(function() {
    $("#queD").click(function() { //初始化是绑定
      var pageNum = $("#fenY_input").val();
      var maxPageNum = "_maxPageNum";
      if (isNaN(pageNum) || pageNum == "" || pageNum > maxPageNum) {
        pageNum = maxPageNum;
      }
      var areaName = $("#areadName").val();
      window.location.href = "" + _domain + "hdjx/?page_num=" + pageNum;
    });
  });
  (function($){
		$.extend($.easing,{
			easeInSine: function (x, t, b, c, d) {
				return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
			}
		});

		$.fn.Xslider=function(settings){
			settings=$.extend({},$.fn.Xslider.sn.defaults,settings);
			this.each(function(){
				var scrollobj=settings.scrollobj ? $(this).find(settings.scrollobj) : $(this).find("ul"),
				    viewedSize=settings.viewedSize || (settings.dir=="H" ? scrollobj.parent().width() : scrollobj.parent().height()),//length of the wrapper visible;
				    scrollunits=scrollobj.find("li"),//units to move;
				    unitlen=settings.unitlen || (settings.dir=="H" ? scrollunits.eq(0).outerWidth() : scrollunits.eq(0).outerHeight()),
				    unitdisplayed=settings.unitdisplayed,//units num displayed;
					numtoMove=settings.numtoMove > unitdisplayed ? unitdisplayed : settings.numtoMove,
				    scrollobjSize=settings.scrollobjSize || scrollunits.length*unitlen,//length of the scrollobj;
				    offset=0,//max width to move;
				    offsetnow=0,//scrollobj now offset;
				    movelength=unitlen*numtoMove,
					pos=settings.dir=="H" ? "left" : "top",
				    moving=false,//moving now?;
				    btnright=$(this).find("a.aright"),
				    btnleft=$(this).find("a.aleft");
				
				btnright.unbind("click");
				btnleft.unbind("click");
						
				settings.dir=="H" ? scrollobj.css("left","0px") : scrollobj.css("top","0px");
								
				if(scrollobjSize>viewedSize){
					if(settings.loop=="cycle"){
						btnleft.removeClass("agrayleft");
						if(scrollunits.length<2*numtoMove+unitdisplayed-numtoMove){
							scrollobj.find("li").clone().appendTo(scrollobj);	
						}
					}else{
						btnleft.addClass("agrayleft");
						offset=scrollobjSize-viewedSize;
					}
					btnright.removeClass("agrayright");
				}else{
					btnleft.addClass("agrayleft");
					btnright.addClass("agrayright");
				}

				btnleft.click(function(){
					if($(this).is("[class*='agrayleft']")){return false;}
					
					if(!moving){
						moving=true;
						
						if(settings.loop=="cycle"){
							scrollobj.find("li:gt("+(scrollunits.length-numtoMove-1)+")").prependTo(scrollobj);
							scrollobj.css(pos,"-"+movelength+"px");
							$.fn.Xslider.sn.animate(scrollobj,0,settings.dir,settings.speed,function(){moving=false;});
						}else{
							offsetnow-=movelength;
							if(offsetnow>unitlen*unitdisplayed-viewedSize){
								$.fn.Xslider.sn.animate(scrollobj,-offsetnow,settings.dir,settings.speed,function(){moving=false;});
							}else{
								$.fn.Xslider.sn.animate(scrollobj,0,settings.dir,settings.speed,function(){moving=false;});
								offsetnow=0;
								$(this).addClass("agrayleft");
							}
							btnright.removeClass("agrayright");
						}
					}

					return false;
				});
				btnright.click(function(){
					if($(this).is("[class*='agrayright']")){return false;}
					
					if(!moving){
						moving=true;
						
						if(settings.loop=="cycle"){
							var callback=function(){
								scrollobj.find("li:lt("+numtoMove+")").appendTo(scrollobj);
								scrollobj.css(pos,"0px");
								moving=false;
							}
							$.fn.Xslider.sn.animate(scrollobj,-movelength,settings.dir,settings.speed,callback);
						}else{
							offsetnow+=movelength;
							if(offsetnow<offset-(unitlen*unitdisplayed-viewedSize)){
								$.fn.Xslider.sn.animate(scrollobj,-offsetnow,settings.dir,settings.speed,function(){moving=false;});
							}else{
								$.fn.Xslider.sn.animate(scrollobj,-offset,settings.dir,settings.speed,function(){moving=false;});//滚动到最后一个位置;
								offsetnow=offset;
								$(this).addClass("agrayright");
							}
							btnleft.removeClass("agrayleft");
						}
					}
					
					return false;
				});
				
				if(settings.autoscroll){
					$.fn.Xslider.sn.autoscroll($(this),settings.autoscroll);
				}
			})
		}
		
		$.fn.Xslider.sn={
			defaults:{
				dir:"H",
				speed:500
			},
			animate:function(obj,w,dir,speed,callback){
				if(dir=="H"){
					obj.animate({
						left:w
					},speed,"easeInSine",callback);
				}else if(dir=="V"){
					obj.animate({
						top:w
					},speed,"easeInSine",callback);	
				}	
			},
			autoscroll:function(obj,time){
				var  vane="right";
				function autoscrolling(){
					if(vane=="right"){
						if(!obj.find("a.agrayright").length){
							obj.find("a.aright").trigger("click");
						}else{
							vane="left";
						}
					}
					if(vane=="left"){
						if(!obj.find("a.agrayleft").length){	
							obj.find("a.aleft").trigger("click");
						}else{
							vane="right";
						}
					}
				}
				var scrollTimmer=setInterval(autoscrolling,time);
				obj.hover(function(){
					clearInterval(scrollTimmer);
				},function(){
					scrollTimmer=setInterval(autoscrolling,time);
				});
			}
		}
	})(jQuery);
  $(document).ready(function() {
    $(".find_hd_join_num").each(function() { //有无报名的文字显示
      var it = $(this).children("b").html();
      if (it == 0) {
        $(this).hide();
        $(this).prev("span").show();
      }
    });
    if(typeof(isDownloadApp) != 'undefined' && "1" == isDownloadApp){
   	 _tc._show('indexTc');
   	 _hdbQr._tab('sjB','sjBan');
     }
    _zbfScroll._init();
  });
}