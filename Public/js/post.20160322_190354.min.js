// JavaScript Document WAP端发布页
var _postApi={
    _movie:"/post/api:70",
    _picUpload:"/post/api:img",
    _vote:"/post/api:33",
    _party:"/post/api:25",
    _article:"/post/api:30",
    _recruit:"/post/api:39",
    _job:"/post/api:27",
    _checkBind:"/post/api:58",
    _maxMoney:"/post/api:63",
    _noAudit:"/attest/fail",
    _auditing:"/attest/auditing",
    _attest:"/attest",
    _attestYes:"/post/api:65"
};

/**值缓存*/
var _postTemp={
	_set:function(key,value){
		_post._id==""?_t._set(key,value):_t._set(key+"_m",value);
	},
	_get:function(key){
		return _post._id==""?_t._get(key):_t._get(key+"_m");
	}
};

/**是否登录判断*/
var _postBeforeLogin={
    _mark:function(kind,id){
        _t._set("post_before_login_"+kind,id);
    },
    _continue:function(kind,fun){
        var _id=_t._get("post_before_login_"+kind);
        if(_id!=""){
            (fun)(_id=="0"?"":_id);
        }
    }
};

/**文本框*/
var _textArea={
    _update:function(o){
        $(o).val($(o).val()
            .replace(/[\x20]+\n/g,"\n")
            .replace(/[\x20]+($)/g,"$1")
            .replace(/(\n(\r*))*([\x20]{20,})/g,"\n"));
    },
    _onPaste:function(o){
        setTimeout(function(){
            _textArea._update(o);
        },200);
    },
    _onBlur:function(o,temp){
        _textArea._update(o);
        _postTemp._set(temp,$(o).val());
    }
};

/*富文本*/
var _richText = {
    _id:"",
    _black:function(){
        if('undefined' !=typeof(editor)&&editor.text()!=$("#"+_richText._id).attr("placeholder")){_richText._gray('');}
    },
    _gray:function(gray){
        var _iframeBody = $("iframe").contents().find("body");
        _iframeBody.attr("class","ke-content "+gray);
    },
    _init:function(id){
        _richText._id=id;
        if(_user._inMobile()){
            $("#"+_richText._id).val(_postTemp._get(_richText._id));
            postJs();
        }else{
            $("#"+_richText._id+"_richtext_bar").show();
            _richText._setValue(true);
            _upload._ok=_richText._uploadOk;
        }

    },
    _maxPic:function(){
        if(_user._inMobile()){
            return false;
        }
        var _img = $("#f").html().match(/<img[^>]*class\=["']?post_pic["']?[^>]*>|<embed[^>]*\/?>/gi);
        if(_img!=null){
            return _img.length>30;
        }
        return false;
    },
    _isEmpty:function(){
        if(_user._inMobile()){
            return $("#"+_richText._id).val()=="";
        }else{
            return editor.text().replace(/(<br>)/ig,"").replace(/(&nbsp;)/ig,"").replace(/ /ig,"")==""&&!_HdbToolbar._img;
        }
    },
    _getValue:function(){
        if($("#"+_richText._id).attr("id")!=undefined){
            return _._htmlencode($("#"+_richText._id).val());
        }else{
           return  appTxt("");
        }
    },
    _showEmo:function(){
        _emo._show(_richText._id+"_emo",_richText._inserEmo);
    },
    _inserEmo:function(num){
        _richText._setNull();
        editor.insertHtml("<img class=\"dt_emo\" src=\"" + _imgCdn +"/images/emo/"+ (num+1) + ".png\"  />");
    },
    _setValue:function(flag,val){
        var _html = "";
        if(flag){
            _html = _postTemp._get(_richText._id)!=""?_postTemp._get(_richText._id): _richText._default();
        }else{
            _html=val;
        }
        if(_user._inMobile()){
            $("#"+_richText._id).val("");
        }else{
            if('undefined' !=typeof(editor)){
                editor.html(_html);
            }else{
                $("#"+_richText._id).html(_html);
            }
            if(_html!=$("#"+_richText._id).attr("placeholder")){_richText._black();}
          }
    },
    _onBlur:function(){
        if(_user._inMobile()){
            _postTemp._set(_richText._id,$("#"+_richText._id).val());
           return ;
        }
        if(editor.html()!=""&&editor.html()!=$("#"+_richText._id).attr("placeholder")){
            if(editor.text()==""&&editor.html().indexOf("<embed")==-1){
                editor.html($("#"+_richText._id).attr("placeholder"));
                _richText._gray("hui");
                return;
            }
            _postTemp._set(_richText._id,editor.html());
        }else{
            editor.html(_richText._default());
        }
        $("#"+_richText._id).html(editor.html());
    },
    _onFocus:function(){
        _richText._setNull();
    },
    _setNull:function(){
        if(editor.text() != "" && editor.text() == $("#"+_richText._id).attr("placeholder")){;
            if(editor.html().indexOf("<embed")==-1){
                editor.html("");
            }
        }
        _richText._black();
    },
    _default:function(){
       var _d = "";
        if('undefined' !=typeof(editor)){
            _d = editor.html();
        }else{
            _d = $("#"+_richText._id).html();
        }
       if(_d==""){
           _d=$("#"+_richText._id).attr("placeholder");
           _richText._gray("hui");
           _postTemp._set(_richText._id,"");
       }else{
           if(_d==$("#"+_richText._id).attr("placeholder")){
               _d="";
           }
       }
      return _d;
    },
    _insertMaxPic:function(){
        var _img = editor.html().match(/<img[^>]*class\=["']?post_pic["']?[^>]*>|<embed[^>]*\/?>/gi);
        if(_img!=null){
            return _img.length>30;
        }
         return false;
    },
    _upload:function(){
    	var _img = editor.html().split('class="post_pic"').length-1;
    	var _video = editor.html().split('class="embed_mov"').length-1;
    	if((_img+_video)>29){
    		_toast._show("视频和图片的总数不能超过30");
    	}else{
    		if(_upload._limit($("#"+_richText._id+"_upload_file").val())){
                _toast._show("只能选择图片文件");
                _upload._clearFile($(_richText._id+"_upload"));
                return;
            }
            if(_richText._insertMaxPic()){
                _toast._show("图片太多了，最多只能上传30张图片");
                _upload._clearFile($("#"+_richText._id+"_upload"));
                return;
            }
            _loading._show("上传中");
            $("#"+_richText._id+"_upload").submit();
    	}
    },
    _uploadOk:function(state,error,saveUrl){
        _loading._hide();
        _upload._clearFile($("#"+_richText._id+"_upload"));
        if(state!="0"){
            _toast._show(error);
            return;
        }
        _richText._setNull();
       editor.cmd.insertimage(saveUrl,"","","","","");
    },
    _mov:function(){
         var _movUrl = _._trim($("#media_input").val());
        if(_movUrl==""){
            _toast._show("请输入视频地址");
            return;
        }
        if(!/^http:\/\/[a-zA-Z]+(.qq.com|.youku.com)(\/[a-zA-Z0-9\?%=&#;_\.\-\+\/]+)?$/.test(_movUrl)){
            _toast._show("暂不支持你输入的视频");
            return;
        }
        _loading._show("插入中");
        _$(_postApi._movie,"videoUrl="+_movUrl,_richText._movOk);
    },
    _movOk:function(json,code){
        _loading._hide();
        if(code!=200){return;}
        $("#media_input").val("");
        var _imgUrl =  json.thumbnail;
        var _videoUrl = json.video;
        var _swfUrl = json.swf;
        _richText._setNull();
        var _html ='<p><embed id="'+_videoUrl+'" class="embed_mov" imgsrc="'+_imgUrl+'" wmode="transparent"   src="'+_swfUrl+'" width="450" height="372"/></p>';
        editor.insertHtml(_html);
        _videoTc._hide();
    }
};
/*视频框*/
var _videoTc = {
    _center:function(){
        var _top =  _._zero(_._client().bh-$("#tc_video").outerHeight())/2+"px";
        var _left = _._zero(_._client().bw -$("#tc_video").outerWidth())/2+"px";
        $("#tc_video").css({"left": _left,"top":_top,"z-index":"3000","position":"fixed"});
    },
    _show:function(){
    	var _img = editor.html().split('class="post_pic"').length-1;
    	var _video = editor.html().split('class="embed_mov"').length-1;
    	if((_img+_video)>29){
    		_toast._show("视频和图片的总数不能超过30");
    	}else{
    		_cover._show("cover2");
            _videoTc._center();
            $("#tc_video").show();
            $(window).bind("resize", _videoTc._center);
            $("#cover2").bind("click",_videoTc._hide);
    	}
    },
    _hide:function(){
        $("#tc_video").hide();
        _cover._hide("cover2");
    }
};

/**上传*/
var _upload={
    _limit:function(path){
        return path.match(/\.(gif|jpg|jpeg|png)$/i)==null;
    },
    _clearFile:function(o){
        var _id = $(o).attr("id");
        var _type = $("#"+_id+"_type").val();
        $(o).html("");
        $(o).html("<input name=\"file\" id=\""+_id+"_file\" type=\"file\" onchange=\"_richText._upload()\" title=\"上传图片\"><input name=\"infoType\" id=\""+_id+"_type\" value=\""+_type+"\" type=\"hidden\">");
    },
    _ok:null
};

/**日期*/
var _datePicker={
    _id:"",
    _interval:null,
    _timeout:null,
    _showDay:["日","一","二","三","四","五","六"],
    _showDate:function(t){
        var _d=new Date(t);
        return  (_d.getMonth()+1)+"月"+_d.getDate()+" 周"+_datePicker._showDay[_d.getDay()];
    },
    _showHour:function(t){
        return t+"时";
    },
    _showMinute:function(t){
        return t+"分";
    },
    _getCurrent:function(id){
        return $("#"+id+" div")[2];
    },
    _current:function(id,cur){
       var _div =  _datePicker._getCurrent(id);
       $(_div).css({"color":(cur?"#0099e9":"#999999")});
    },
    _minStart:function(o,fun){
        _datePicker._timeout=setTimeout(function(){
            _datePicker._interval=setInterval(fun,100);
        },500);
        _datePicker._stopEvent(o);
    },
    _addStart:function(o,fun){
        _datePicker._timeout=setTimeout(function(){
            _datePicker._interval=setInterval(fun,100);
        },500);
        _datePicker._stopEvent(o);
    },
    _stopEvent:function(o){
        o.onmouseup=_datePicker._stop;
        o.onmouseout=_datePicker._stop;
    },
    _stop:function(){
        clearTimeout(_datePicker._timeout);
        clearInterval(_datePicker._interval);
    },
    _min:function(id,fun1,fun2){
       _datePicker._current(id,false);
       $("#"+id).children().first().css({"margin-top":"0px"});
       $("#"+id).children().last().insertBefore($("#"+id).children().first());
       var _t = parseInt($("#"+id).children().first().next().attr("time"));
       _t=(fun1)(_t);
       $("#"+id).children().first().html((fun2)(_t));
       $("#"+id).children().first().attr("time",_t);
       $("#"+id).children().first().css({"margin-top":"-50px"});
       _datePicker._current(id,true);
    },
    _add:function(id,fun1,fun2){
        _datePicker._current(id,false);

        $("#"+id).children().first().css({"magin-top":"-100px"});
        $("#"+id).children().first().insertAfter($("#"+id).children().last());
        var _t = parseInt($("#"+id).children().last().prev().attr("time"));
        _t=(fun1)(_t);
        $("#"+id).children().last().html((fun2)(_t));
        $("#"+id).children().last().attr("time",_t);
        $("#"+id).children().last().css({"margin-top":"0px"});
        $("#"+id).children().first().css({"margin-top":"-50px"});

        _datePicker._current(id,true);
    },
    _dateMin:function(){
        _datePicker._min("datepicker_date",function(t){
            return new Date(t-86400000*1).getTime();
        },_datePicker._showDate);
    },
    _dateAdd:function(){
        _datePicker._add("datepicker_date",function(t){
            return new Date(t+86400000*1).getTime();
        },_datePicker._showDate);
    },
    _hourMin:function(){
        _datePicker._min("datepicker_hour",function(t){
            return t==0?23:t-1;
        },_datePicker._showHour);
    },
    _hourAdd:function(){
        _datePicker._add("datepicker_hour",function(t){
            return t==23?0:t+1;
        },_datePicker._showHour);
    },
    _minuteMin:function(){
        _datePicker._min("datepicker_minute",function(t){
            return t==0?59:t-1;
        },_datePicker._showMinute);
    },
    _minuteAdd:function(){
        _datePicker._add("datepicker_minute",function(t){
            return t==59?0:t+1;
        },_datePicker._showMinute);
    },
    _itemInit:function(id,time,fun1,fun2){
        $("#"+id).html("");
        var _html = "";
        for(var i=0;i<5;i++){
            var _item = "<div class='datepicker_item' time='"+time+"'>"+(fun1)(time)+"</div>";
            if(i==0){
                _item = "<div class='datepicker_item' time='"+time+"' style='margin-top: -50px'>"+(fun1)(time)+"</div>";
            }
            time=(fun2)(time);
            _html+=_item;
        }
        $("#"+id).html(_html);
        _datePicker._current(id,true);
    },
    _notSupport:function(id){
        if(!_user._inMobile()){
            $("#"+id+"_input").show();
        }else{
            var _d=new Date();
            _d.setMonth(_d.getMonth()+3);
            $("#"+id).val(_d.getFullYear()+"-"+(_d.getMonth()+1)+"-"+_d.getDate()+" "+_d.getHours()+":"+_d.getMinutes());
        }
    },
    _init:function(id,date){
        _datePicker._id=id;
        date=date?date.replace(/-/g,"/"):"";
        var _d=Date.parse(date)?new Date(date):new Date(),
            _hour=_d.getHours()-2,
            _minute=_d.getMinutes()-2,
            _date=_d.getTime()-86400000*2;
        _hour=_hour<0?_hour+24:_hour;
        _minute=_minute<0?_minute+60:_minute;
        _datePicker._itemInit("datepicker_date",_date,_datePicker._showDate,function(t){
            return new Date(t+86400000*1).getTime();
        });
        _datePicker._itemInit("datepicker_hour",_hour,_datePicker._showHour,function(t){
            return t==23?0:t+1;
        });
        _datePicker._itemInit("datepicker_minute",_minute,_datePicker._showMinute,function(t){
            return t==59?0:t+1;
        });
    },
    _getValue:function(){
        var  _current_date = _datePicker._getCurrent("datepicker_date");
        var _current_hour = _datePicker._getCurrent("datepicker_hour");
        var _current_minute = _datePicker._getCurrent("datepicker_minute");

        var _d=new Date(parseInt($(_current_date).attr("time")));
        var _month =(_d.getMonth()+1)<10?"0"+(_d.getMonth()+1):(_d.getMonth()+1);
        var _day = _d.getDate()<10?"0"+_d.getDate():_d.getDate();
        var _date=_d.getFullYear()+"-"+_month+"-"+_day;

        var _hour=$(_current_hour).attr("time");
        var _minute=$(_current_minute).attr("time");
        if(_minute<10){_minute="0"+_minute;}
        if(_hour<10){_hour="0"+_hour;}
        return _date+" "+_hour+":"+_minute;
    },
    _onBlur:function(){
        _postTemp._set(_datePicker._id,$("#"+_datePicker._id).val());
    },
    _earilier:function(date){
        date=date.replace(/-/g,"/");
        if(!Date.parse(date)){return true;}
        return new Date(date).getTime()<new Date().getTime();
    },
    _show:function(id){
        _cover._show("cover2");
        $("#post_datepicker").show();
        _datePicker._init(id,$("#"+id).val());
        $("#cover2").bind("click","",_datePicker._hide);
       setTimeout(function(){$("#post_datepicker").css({"margin-bottom":"0"});},50);
    },
    _hide:function(){
        $("#post_datepicker").css({"margin-bottom":"-200px"});
        setTimeout(function(){_cover._hide("cover2");$("#post_datepicker").hide();},300);
    },
    _ok:function(){
        $("#"+_datePicker._id).val(_datePicker._getValue());
        _datePicker._onBlur();
        _datePicker._hide();
    }
};

/**选择框*/
var _checkbox={
    _check:function(id){
        _checkbox._setValue(id,(parseInt(_checkbox._getValue(id))+1)%2);
    },
    _getValue:function(id){
        return $("#"+id).attr("src").indexOf("checkbox-no2x")==-1?0:1;
    },
    _setValue:function(id,value,auto){
        with($("#"+id)){
            var _src = $("#"+id).attr("src");
            $("#"+id).attr("src",(value==0?_src.replace(/checkbox-no2x/,"checkbox2x"):_src.replace(/checkbox2x/,"checkbox-no2x")));
        }
        if(!auto){_postTemp._set(id,value);}
    }
};



/**只允许有邀请码的用户参加*/
var _postInvite={
    _id:"",
    _display:function(){
        if(_checkbox._getValue(_postInvite._id)==0){
             $("#"+_postInvite._id+"_code").show();
            _scroll._to(_._client().h);
        }else{
           $("#"+_postInvite._id+"_code").hide();
        }
    },
    _check:function(){
        _checkbox._check(_postInvite._id);
        _postInvite._display();
    },
    _init:function(id){
        _postInvite._id=id;
        var _value=_postTemp._get(_postInvite._id);
        if(_value===""){_value="1";}
        _checkbox._setValue(_postInvite._id,_value,true);
        _postInvite._display();
    }
};

/**报名项*/
var _postJoin={
    _id:"",
    _joinItemKey:"",
    _joinValueKey:"",
    _joinOrderKey:"",
    _initJoinArr:{1:"姓名",2:"手机",3:"单位",4:"职位",5:"行业",6:"备注"},
    _item:function(item){
        $("#post_"+_postJoin._id+"_join_item_"+item).attr("class","join_item_"+(_postJoin._selected(item)?"no":"static"));
        var _val =  _postJoin._getValue();
        _postTemp._set(_postJoin._joinItemKey,_val);
        if(item==2){
            var _phoneClass =  $("#post_"+_postJoin._id+"_join_item_"+item).attr("class");
           if(_phoneClass=="join_item_static"){
                  $("#form_phone_recom").show();
           }else{
                $("#form_phone_recom").hide();
           }
        }
        _hdbDragge._setValue();
    },
    _selected:function(item){
        var _itme_class=  $("#post_"+_postJoin._id+"_join_item_"+item).attr("class");
        return _itme_class.indexOf("_static")!=-1;
    },
    _getValue:function(){
        var _value="1";
        for(var i=2;i<=6;i++){
            if(_postJoin._selected(i)){_value+=","+i;}
        }
        return _value;
    },
    _getNewValue:function(){
        var _newValue = "";
        $("li[id^='li_post_join_item_new_']").each(function(){
             if($(this).attr("class").indexOf("or")>-1){
                 _newValue+=$(this).text()+"^";
             }
        });
        return _newValue;
    },
    _setValue:function(value,joinValue){
       var _joinItemOrder =  _postTemp._get(_postJoin._joinOrderKey);
       if(_joinItemOrder!=""){
            $(".post_form_join_item").html("");
              var _liNew = 1;
              var _joinArr = _joinItemOrder.split("^");
              for(var i= 0,_len=_joinArr.length;i<_len;i++){
                   var _joinHtml = '';
                    if(_joinArr[i]==""){break;}
                    var _item =_joinArr[i].split("#");
                    var _item01 = _item[0];
                    if(_item01.indexOf("lid_")>-1){
                        var _lid = _item01.substring(4,_item01.length);
                        if(_lid==1){
                            _joinHtml='<li class="join_item_static" lid="1"><div class="xuanX">姓名</div></li>';
                        }else{
                            _joinHtml='<li id="post_'+_postJoin._id+'_join_item_'+_lid+'" class="join_item_'+(_item[1]==1?"static":"no")+'" onclick="_postJoin._item(\''+_lid+'\')" ontouchstart="" lid="'+_lid+'"><div class="xuanX">'+_postJoin._initJoinArr[_lid]+'</div></li>';
                        }
                        $(".post_form_join_item").append(_joinHtml);
                    }else{
                        _joinHtml=_postJoin._initNewItem(_item[1],_liNew,_item[0]);
                        $(".post_form_join_item").append(_joinHtml);
                        $("#li_post_join_item_new_"+_liNew).bind("click",function(){var _index =$(this).attr("id").match(/\d+/g); _postJoin._clickNew(_postJoin._id+"_join_property_value",_index);}) ;
                        _liNew++;
                    }
             }
            $(".post_form_join_item").append('<li title="增加填写项" onclick="_postJoin._newItem(this);" id="post_join_item_add" class="join_item_no" ontouchstart=""><p><img src="'+_imgCdn+'/images3/post/join_item_add2x.png"></p></li>');
           var _cla =  $('#post_'+_postJoin._id+'_join_item_2').attr("class");
           if(_cla.indexOf("static")==-1){
               $("#form_phone_recom").hide();
           }else{
               $("#form_phone_recom").show();
           }
            return ;
       }

       if(value!=""){
            for(var i=2;i<=6;i++){
                $("#post_"+_postJoin._id+"_join_item_"+i).attr("class","join_item_"+((","+value+",").indexOf(","+i+",")!=-1?"static":"no"));
            }
            if($("#post_"+_postJoin._id+"_join_item_2").attr("class")=="join_item_static"){
                $("#form_phone_recom").show();
            }else{
                $("#form_phone_recom").hide();
            }
        }
        if(joinValue==""){
            return;
        }
        var _joinValueArr = joinValue.substring(0,joinValue.length-1).split("\^");

        var _len= _joinValueArr.length;
        for(var i= 0;i<_len;i++){
            var _ii =_joinValueArr[i].split("#");
            var _new_len = i+1;
            $("#post_join_item_add").before(_postJoin._initNewItem(_ii[1],_new_len,_ii[0]));
            $("#li_post_join_item_new_"+_new_len).bind("click",function(){var _index =$(this).attr("id").match(/\d+/g); _postJoin._clickNew(_postJoin._id+"_join_property_value",_index);}) ;
            $("#li_post_join_item_new_"+_new_len+" img").bind("click",function(event){event.stopPropagation();});
        }

        if(_len==10){
            $("#post_join_item_add").hide();
        }
    },
    _initNewItem:function(sel,newLen,val){
        var _html  = "<li lid=\"0\" class=\"join_item_no post_item_7 "+(sel==1?"or":"")+"\" id=\"li_post_join_item_new_"+newLen+"\">"
            +val
            + "<img src=\""+_imgCdn+"/images3/post_join_item_7@2x.png\" onclick=\"_postJoin._delNewItem("+newLen+")\">"
            + "</li>";
        return  _html;
    },
    _init:function(id){
        _postJoin._id=id;
        _postJoin._joinItemKey=id+"_post_join_item";
        _postJoin._joinValueKey=id+"_join_property_value";
        _postJoin._joinOrderKey=id+"_join_property_order";
        _postJoin._setValue(_postTemp._get(_postJoin._joinItemKey),_postTemp._get(_postJoin._joinValueKey));
    },
    _newItem:function(o){
        $(o).hide();
        var _new_len = $("li[id^='li_post_join_item_new_']").length+1;

        var _html =  "<li lid=\"0\" class=\"join_item_no post_item_7\" id=\"li_post_join_item_new_"+_new_len+"\">"
            + "<input type=\"text\"  id=\"post_join_item_new_"+_new_len+"\" onblur=\"_postJoin._setNewValue('"+_postJoin._id+"_join_property_value',$(this).val(),"+_new_len+")\" placeholder=\"请输入项目\" maxlength=\"10\" class=\"post_join_item_7_text\"/>"
                  + "</li>";

        $(o).before(_html);
        $("#post_join_item_new_"+_new_len).focus();
        $("#li_post_join_item_new_"+_new_len).bind("click",function(){var _index =$(this).attr("id").match(/\d+/g); _postJoin._clickNew(_postJoin._id+"_join_property_value",_index);}) ;
        $("#post_join_item_new_"+_new_len).bind("click",function(event){_postJoin._setNewValue(_postJoin._id+"_join_property_value",$(this).val(),_new_len);event.stopPropagation();});
        $("#post_join_item_new_"+_new_len).keyup(function () {//禁止输入英文字符<>"'
            var str = $(this).val();
            if (_._trim(str)=="")
                return;
            if (/[<>"']/g.test(str)) {
                $(this).val(str.substr(0, str.length - 1));
            }
        });
    },
    _clickNew:function(key,index){
        var _sel = 0;
        var _class = $("#li_post_join_item_new_"+index).attr("class");
        $("#li_post_join_item_new_"+index).attr("class", _class.indexOf("or")>-1?_class.replace("or",""):_class+" or");
        _sel = _class.indexOf("or")>-1?0:1;
       _postJoin._tempValue(key,$("#li_post_join_item_new_"+index).text(),index,_sel);
    },
    _setNewValue:function(key,value,index){
        if(value==""){
            $("#post_join_item_add").show();
            $("#li_post_join_item_new_"+index).remove();
            return;
        }else{
            if(index<10){
                $("#post_join_item_add").show();
            }
            $("#li_post_join_item_new_"+index).attr("class","join_item_no post_item_7 or");
            $("#li_post_join_item_new_"+index).html(value+"<img src=\""+_imgCdn+"/images3/post_join_item_7@2x.png\" onclick=\"_postJoin._delNewItem("+index+")\">");
            $("#li_post_join_item_new_"+index+" img").bind("click",function(event){ event.stopPropagation();});
        }
        _postJoin._tempValue(key,value,index,1);
    },
    _tempValue:function(key,value,index,sel){
        var _value = _postTemp._get(key);
        if(_value!=""){
            var _valueArr = _value.substring(0,_value.length-1).split("\^");
            var _arrIndex = index-1;
            _value = "";
            var _insert = true;
            for(var i= 0,len=_valueArr.length;i<len;i++){
                if(i==_arrIndex){
                    if(value!=""){
                        _value += value+"#"+sel+"^";
                    }
                    _insert = false;
                }else{
                    _value += _valueArr[i]+"^";
                }
            }
            if(_insert){
                _value+=value+"#"+sel+"^";
            }
        }else{
            if(value!=""){
                _value=value+"#"+sel+"^";
            }
        }
        _postTemp._set(key,_value);
        _hdbDragge._setValue();
    },
    _delNewItem:function(index){

        var _value = _postTemp._get(_postJoin._joinValueKey);

        var _valueArr = _value.substring(0,_value.length-1).split("\^");
        var _arrIndex = index-1;
        _value = "";
        for(var i= 0,len=_valueArr.length;i<len;i++){
            if(i!=_arrIndex){
                    _value += _valueArr[i]+"^";
            }
        }
        _postTemp._set(_postJoin._joinValueKey,_value);
        $("#li_post_join_item_new_"+index).remove();
        $("li[id^='li_post_join_item_new_']").each(function(i){
            $(this).attr("id","li_post_join_item_new_"+(i+1));
            $("#"+$(this).attr("id")+" img").unbind("click");
            $("#"+$(this).attr("id")+" img").attr("onclick","").click(eval(function(){_postJoin._delNewItem(i+1);}));
            $(this).unbind("click");
            $(this).bind("click",function(){var _index =$(this).attr("id").match(/\d+/g); _postJoin._clickNew(_postJoin._id+"_join_property_value",_index);}) ;
            $("#"+$(this).attr("id")+" img").bind("click",function(event){ event.stopPropagation();});
        });

        $("#post_join_item_add").show();
        _hdbDragge._setValue();
    }
};

var _hdbDragge={
    _flag:true,
      _init:function(){
          $("li[id^='post_"+_postJoin._id+"_join_item_']").attr("onclick","");
          $("li[id^='li_post_join_item_new_']").unbind();
          $("li[id^='li_post_join_item_new_'] img").hide();
          $("#a_post_order").html("完成");
          $("#a_post_order").unbind("click");
          $("#a_post_order").attr("onclick","").click(eval(function(){_hdbDragge._end();}));
          $("#post_join_item_add").remove();
          $(".post_form_join_item").dragsort({ dragBetween: true});
      },
    _end:function(){
        $("#a_post_order").html("排序");
        $(".post_form_join_item").dragsort("destroy");
        $("#a_post_order").unbind("click");
        $("#a_post_order").attr("onclick","").click(eval(function(){_hdbDragge._init();}));
        $("li[id^='post_"+_postJoin._id+"_join_item_']").each(function(){
            $(this).unbind("click");
            $(this).attr("onclick","").click(eval(function(){_postJoin._item($(this).attr("lid"));}));
            $(this).attr("id","post_"+_post._type+"_join_item_"+$(this).attr("lid"));
        });
        $("li[id^='li_post_join_item_new_']").each(function(i){
            $(this).attr("id","li_post_join_item_new_"+(i+1));
            $("#"+$(this).attr("id")+" img").unbind("click");
            $("#"+$(this).attr("id")+" img").attr("onclick","").click(eval(function(){_postJoin._delNewItem(i+1);}));
            $(this).bind("click",function(){var _index =$(this).attr("id").match(/\d+/g); _postJoin._clickNew(_postJoin._id+"_join_property_value",_index);}) ;
            $("#"+$(this).attr("id")+" img").bind("click",function(event){ event.stopPropagation();});
        });
        $(".post_form_join_item").append('<li title="增加填写项" onclick="_postJoin._newItem(this);" id="post_join_item_add" class="join_item_no" ontouchstart=""><p><img src="'+_imgCdn+'/images3/post/join_item_add2x.png"></p></li>');
        $("li[id^='li_post_join_item_new_'] img").show();
        _hdbDragge._setValue();
    },
    _setValue:function(){
        var  _joinOrder = "";
        $(".post_form_join_item li").each(function(){
            if($(this).attr("id")!=="post_join_item_add"){
                if($(this).attr("lid")!="0"){
                    var _sel = $(this).attr("class").indexOf("static")>-1?"1":"0";
                    _joinOrder+="lid_"+$(this).attr("lid")+"#"+_sel+"^";
                }else{
                    var _sel = $(this).attr("class").indexOf("or")>-1?"1":"0";
                    _joinOrder+=$(this).text()+"#"+_sel+"^";
                }
            }
        });
        _postTemp._set(_postJoin._joinOrderKey,_joinOrder);
    },
    _getValue:function(){
        var  _joinOrderVal = "";
        $(".post_form_join_item li").each(function(){
            if($(this).attr("id")!=="post_join_item_add"){
                if($(this).attr("class").indexOf("static")>-1||$(this).attr("class").indexOf("or")>-1){
                    _joinOrderVal+=$(this).text()+"^";
                }
            }
        });
        _hdbDragge._setValue();
        return  _joinOrderVal;
    }
};

/**绑定银行卡相关*/
var _bindBank={
    _id:"",
    _center:function(){
        var _top =  _._zero(_._client().bh-$("#"+_bindBank._id).outerHeight())/2+"px";
        var _left = _._zero(_._client().bw-$("#"+_bindBank._id).outerWidth())/2+"px";
        $("#"+_bindBank._id ).css({ "left": _left,"bottom":_top,"z-index":"3000","position":"fixed"});
    },
     _bdCard:function(id){
         _bindBank._id=id;
         _cover._show("cover2");
         _bindBank._center();
         $("#"+id).show();
         $("#cover2").bind("click",_bindBank._hide);
     },
    _hide:function(){
        $("#"+_bindBank._id).hide();
        _cover._hide("cover2");
    }
};

/**支付项*/
var _payItem={
    _id:"",
     _show:function(isupdate){
        var _thisNext=_post._type.replace(_post._type,function($1){
            return $1?($1.substring(0,1).toUpperCase() + $1.substring(1)):'';
        });
      
         var _name = _postTemp._get(_payItem._id+"_pay_item_name");
         if(_name.length>1){
                 var _src = $("#post_pay_more_img").attr("src");
                 $("#post_pay_more_img").attr("src",_src.replace("cost2x.png","cost2x-click.png"));
                 if(isupdate){
                	 $(".form_input_cost input").attr("readonly","");
                 }
                 $("div[id^='"+_payItem._id+"_pay_item_']").show();
                 $("#"+_payItem._id+"_post_option_cost_add").show();
         }
       
         if(_postTemp._get(_payItem._id+"_pay_show")=="1") {
             _payItem._bankAfter();
             return;
         }
         if(!_user._login()){_user._toLogin(_thisNext);return;}
       
     },
    _bankAfter:function(){
        var _src = $("#post_pay_more_img").attr("src");
        $("#post_pay_more_img").attr("src",_src.indexOf("cost2x-click.png")>-1?_src.replace("cost2x-click.png","cost2x.png"):_src.replace("cost2x.png","cost2x-click.png"));
        if(_src.indexOf("cost2x-click.png")>-1){
            $("div[id^='"+_payItem._id+"_pay_item_']").hide();
            $("#"+_payItem._id+"_post_option_cost_add").hide();
        }else{
            $("div[id^='"+_payItem._id+"_pay_item_']").show();
            $("#"+_payItem._id+"_post_option_cost_add").show();
        }

       if(_maxMoney._max==0){
            _maxMoney._init();
        }
       if (_post._id != "") {
    	   $("#"+_payItem._id+"_post_option_cost_add").hide();
       }
    },
    _checkBindOk:function(json,code){
         if(code!=200){return;}
        if(json.is_pay==1&&json.status=="2"){
            if(json.first==1){ $("#post_audit").html("");_attestOk._bankCard=json.bankCard;$("#span_max_money").html(json.max_money);_attestOk._show();}else{
                _payItem._toBindBank(json,code);
            }
        }
        else if(json.is_pay==1){
            _payItem._toBindBank(json,code);
            return;
        }else{
            if(json.status=="-1"){_g(_postApi._attest+"/"+_payItem._id);}
             //待审核
            else if(json.status=="1"){_g(_postApi._auditing+"/"+_payItem._id);}
            //未通过可审请
            else if(json.status=="3"||json.status=="4"){_g(_postApi._noAudit+"/"+_payItem._id);}
        }
    },
    _toBindBank:function(json,code){
        $("#post_audit").html("");
        //未绑定银行卡
        if(json.bankCard==1){
            _bindBank._bdCard("tc_bdCard");
        }else{
            _payItem._bankAfter();
        }
    },
    _setValue:function(key,value,index){
    	
    	 var _name="",_price="",_num="";
         $("input[id^='"+_payItem._id+"_pay_item_name_']").each(function(){
                 _name+= _._trim($(this).val().replace(/\^/gi,""))+"^";
         });
         $("input[id^='"+_payItem._id+"_pay_item_price_']").each(function(i){
                 _price+=_._trim($(this).val())+"^";
         });
         $("input[id^='"+_payItem._id+"_pay_item_num_']").each(function(i){
                 var _val = _._trim($(this).val());
                 _num=_val==""?_num+="0^":_num+=_val+"^";
         });
         var _name_arr = _name.split("^"), _price_arr = _price.split("^"),_num_arr = _num.split("^");
         var _name_true="",_price_true="",_num_true="";
         if(_name_arr.length>0){
             for(var i=0;i<_name_arr.length;i++){
             	var nv=_name_arr[i];
             	var pv=_price_arr[i];
             	var nmv=_num_arr[i];
             	if(nv!=""){
             		_name_true+="^"+nv;
             		_price_true+="^"+pv;
             		_num_true+="^"+nmv;
             	}
             }
             _name_true=_name_true.substring(1);
             _price_true=_price_true.substring(1);
             _num_true=_num_true.substring(1);
         }
         _postTemp._set(_payItem._id+"_pay_item_name",_name_true);
         _postTemp._set(_payItem._id+"_pay_item_price",_price_true);
         _postTemp._set(_payItem._id+"_pay_item_num",_num_true);
        _joinLimit._show();
    },
    _addItem:function(isHide,isPla){
        var _len = $("div[id^='"+_payItem._id+"_pay_item_']").length;
        var _index = _len+1;
        if(_index>=6){
            $("#"+_payItem._id+"_post_option_cost_add a").hide();
            return;
        }
        var _dis = "";
       if(isHide){
           _dis = "style=\"display: none\"";
       }
       var _html =" <div "+_dis+" class=\"cost_content\" id=\""+_payItem._id+"_pay_item_"+_index+"\">"
                    +" <div class=\"form_input_cost\">"
                    +"  <input type=\"text\" onblur=\"_payItem._setValue('"+_payItem._id+"_pay_item_name',$(this).val(),"+_index+");\" placeholder=\"费用名称"+_index+"\" maxlength=\"30\" class=\"input cost_name\" id=\""+_payItem._id+"_pay_item_name_"+_index+"\"> "
                    +" </div>"

                    +" <div class=\"form_input_cost\">"
                    +"  <input type=\"text\" onblur=\"_payItem._setValue('"+_payItem._id+"_pay_item_price',$(this).val(),"+_index+");\" placeholder=\"金额，免费请填0\" maxlength=\"30\" class=\"input\" id=\""+_payItem._id+"_pay_item_price_"+_index+"\">"
                    +" </div>"

                    +" <div class=\"form_input_cost\">"
                    +"  <input type=\"text\" onblur=\"_payItem._setValue('"+_payItem._id+"_pay_item_num',$(this).val(),"+_index+");\" placeholder=\"人数，不填则无限制\" maxlength=\"30\" class=\"input\" id=\""+_payItem._id+"_pay_item_num_"+_index+"\">"
                    +" </div>"
                    +"</div>";

        $("#"+_payItem._id+"_post_option_cost_add").before(_html);
        if(isPla){
            _placeholder._init(_payItem._id+"_pay_item_"+_index);
        }
        _payItem._keyup();
    },
    _check:function(){
        var _wrong = false;
        if($("#post_pay_more_img").attr("src").indexOf("cost2x-click.png")==-1){
            return _wrong;
        }
        $("input[id^='"+_payItem._id+"_pay_item_name_']").each(function(i){
            if(_payItem._checkName(i+1,true)){
                _wrong = true;
                return false;
            }
        });

       if(_wrong){
           return true;
       }
        $("input[id^='"+_payItem._id+"_pay_item_price_']").each(function(i){
            var _value=_._trim($(this).val());
            if(_payItem._checkPrice(i+1,true)){
                _wrong = true;
                return false;
            }
             if(_value!=""&&!_value.match(/^((\d*)(\.\d{1,2})?)$/)){
                 $(this).focus();
                _toast._show("支付金额只能输入数字");
                _wrong = true;
                 return false;
             }
        });

        if(_wrong){
            return true;
        }

        $("input[id^='"+_payItem._id+"_pay_item_num_']").each(function(){
              if($(this).val()!=""&&!$(this).val().match(/[1-9]/)){
                  $(this).focus();
                  _toast._show("人数限制只能输入大于0的数字");
                  _wrong = true;
                  return false;
              }
        });

        if(_wrong){
            return _wrong;
        }

        return _wrong;
    },
    _checkName:function(index,flag){
        var _obj =  $("#"+_payItem._id+"_pay_item_name_"+index);
        var _p = _._trim($("#"+_payItem._id+"_pay_item_price_"+index).val());
        var _n = _._trim($("#"+_payItem._id+"_pay_item_num_"+index).val());

        var _value=_._trim(_obj.val());
        if(_value==""){
            if(_p!=""||_n!=""){
                if(flag){_obj.focus();}
                _toast._show("请填写费用名称");
                return true;
            }
        }else{
            if(_._len(_value)>40){
                if(flag){_obj.focus();}
                _toast._show("费用名称请在20个字以内");
                return true;
            }
            var _wrong = false;
            $("input[id^='"+_payItem._id+"_pay_item_name_']").each(function(i){
                var _v=_._trim($(this).val());
                if(index!=(i+1)&&_v==_value){
                    if(flag){_obj.focus();}
                    _toast._show("第"+index+"项和第"+(i+1)+"项费用名称不能重复");
                    _wrong = true;
                    return  false;
                }
            });
            if(_wrong){ return true;}
        }
        return false;
    },
    _checkPrice:function(index,flag){
        var _obj =  $("#"+_payItem._id+"_pay_item_price_"+index);
        var _na = _._trim($("#"+_payItem._id+"_pay_item_name_"+index).val());
        var _nu = _._trim($("#"+_payItem._id+"_pay_item_num_"+index).val());

        var _value=_._trim(_obj.val());
        if(_value==""){
            if(_na!=""||_nu!=""){
                if(flag){_obj.focus();}
                _toast._show("请输入金额");
                return true;
            }
        }
        return false;
    },
    _keyup:function(){
        $("input[id^='"+_payItem._id+"_pay_item_price_']").keyup(function(){
            $(this).val($(this).val().replace(/[^(\d,\.)]/g,''));
            var _p=$(this).val();
            if(_p=="00"){$(this).val("0");return;}
            var _dlen = (parseInt(_maxMoney._max)+"").length;

            var _a = new RegExp("^\\d{1,"+_dlen+"}((\\.)|(\\.\\d{1,2}))?$");
            var _aa = new RegExp("\\d{1,"+_dlen+"}(\\.\\d{1,2})?");

            if(_a.test(_p)){
                $(this).val(_p);
            }else{
                if(parseInt(_p)>=_maxMoney._max){
                    $(this).val(_maxMoney._max);
                }else{
                    $(this).val(_p.match(_aa)[0]);
                }
            }
        });
        $("input[id^='"+_payItem._id+"_pay_item_num_']").keyup(function(){
            $(this).val($(this).val().replace(/[^(\d)]/g,''));
            var _p=$(this).val();
            if(parseInt(_p)>100000){
                $(this).val(100000);
            }
        });
    },
    _getValue:function(){
        var _payItemArr = ["","",""];
        if($("#post_pay_more_img").attr("src").indexOf("cost2x-click.png")==-1){
            return _payItemArr;
        }
        var _name="",_price="",_num="";
        $("input[id^='"+_payItem._id+"_pay_item_name_']").each(function(){
        	_name+= _._trim($(this).val().replace(/\^/gi,""))+"^";
        });
        $("input[id^='"+_payItem._id+"_pay_item_price_']").each(function(i){
                _price+=_._trim($(this).val())+"^";
        });
        $("input[id^='"+_payItem._id+"_pay_item_num_']").each(function(i){
                var _val = _._trim($(this).val());
                _num=_val==""?_num+="0^":_num+=_val+"^";
        });
        var _name_arr = _name.split("^");
        var _price_arr = _price.split("^");
        var _num_arr = _num.split("^");
        var _name_true="",_price_true="",_num_true="";
        if(_name_arr.length>0){
            for(var i=0;i<_name_arr.length;i++){
            	var nv=_name_arr[i];
            	var pv=_price_arr[i];
            	var nmv=_num_arr[i];
            	if(nv!=""){
            		_name_true+="^"+nv;
            		_price_true+="^"+pv;
            		_num_true+="^"+nmv;
            	}
            }
            _name_true=_name_true.substring(1);
            _price_true=_price_true.substring(1);
            _num_true=_num_true.substring(1);
        }
        _payItemArr[0]=_name_true;_payItemArr[1]=_price_true;_payItemArr[2]=_num_true;
        return _payItemArr;
    },
    _isPayItem:function(){
        var _nameArr = _postTemp._get(_payItem._id+"_pay_item_name").split("^");
        var _priceArr = _postTemp._get(_payItem._id+"_pay_item_price").split("^");
        var _flag = false;
        for(var i= 0,_len=_nameArr.length;i<_len;i++){
            if(i<_nameArr.length&&_nameArr[i]!=""&&i<_priceArr.length&&_priceArr[i]!=""){
                _flag = true;
                break;
            }
        }
        return _flag;
    },
    _init: function(id) {
    	   _payItem._id = id;
    	   var _name = _postTemp._get(_payItem._id + "_pay_item_name");
    	   var _price = _postTemp._get(_payItem._id + "_pay_item_price");
    	   var _num = _postTemp._get(_payItem._id + "_pay_item_num");

    	   var _audit = _t._get(_user._id + "_auditing");
    	   if (_audit == 1) {
    	     $("#post_audit").html("待审核");
    	   } else if (_audit == 2) {
    	     $("#post_audit").html("审核未通过");
    	   }
    	   _t._set(_user._id + "_auditing", "");

    	   if (_name != "" && _price != "") {
    		   _name=_name.lastIndexOf("\^")==(_name.length-1)?_name.substring(0,_name.length-1):_name;
    		   _price=_price.lastIndexOf("\^")==(_price.length-1)?_price.substring(0,_price.length-1):_price;
    	     var _nameArr = _name.split("\^");
    	     var _priceArr = _price.split("\^");
    	     var _numArr = _num.split("\^");

    	     if (_payItem._isPayItem()) {
    	       for (var i = 0, len = _nameArr.length; i < len; i++) {
    	         if (_nameArr[i] != "" || (i < _priceArr.length && _priceArr[i] != "")) {
    	           _payItem._addItem(false, false);
    	           $("#" + _payItem._id + "_pay_item_name_" + (i + 1)).val(_nameArr[i]);
    	           $("#" + _payItem._id + "_pay_item_price_" + (i + 1)).val(_priceArr[i]);
    	           if (_numArr[i] != "0") {
    	             $("#" + _payItem._id + "_pay_item_num_" + (i + 1)).val(_numArr[i]);
    	           }
    	         }
    	       }
    	       var isupdatem=_post._id != "";
    	       _payItem._show(isupdatem);
    	     }
    	   } else {
    	     _payItem._addItem(true, false);
    	   }
    	   _payItem._keyup();
    	 }
};
var _attestOk = {
	_bankCard:0,
    _center:function(){
        var _top =  _._zero(_._client().bh-$("#tc_checkOk").outerHeight())/2+"px";
        var _left = _._zero(_._client().bw -$("#tc_checkOk").outerWidth())/2+"px";
        $("#tc_checkOk").css({"left": _left,"top":_top,"z-index":"3000","position":"fixed"});
    },
    _show:function(){
        _cover._show("cover2");
        _attestOk._center();
        $("#tc_checkOk").show();
        $(window).bind("resize", _attestOk._center);
        $("#cover2").bind("click",_attestOk._hide);
    },
    _hide:function(){
        $("#tc_checkOk").hide();
        _cover._hide("cover2");
    },
    _yes:function(){
        _$(_postApi._attestYes,"",_attestOk._ok);
    },
    _ok:function(josn,code){
        if(code!=200){return;}
        _attestOk._hide();
        if(_attestOk._bankCard==1){
            _bindBank._bdCard("tc_bdCard");
        }else{
            _payItem._bankAfter();
        }
    }
};
/**更好设置*/
var _postMore={
    _show:function(auto){
        var _src = $("#post_form_more_img").attr("src");
        $("#post_form_more_img").attr("src",(_src.indexOf("more2x-click")>-1?_src.replace(/more2x-click/,"more2x"):_src.replace(/more2x/,"more2x-click")));
        if(_src.indexOf("more2x-click.png")>-1){
            $("#form_checkbox_recom,#post_form_more_detail,#form_anonymous").hide();
        }else{
            $("#form_checkbox_recom,#post_form_more_detail,#form_anonymous").show();
        }
        if(!auto){_scroll._to(_._client().h);}
    },
    _init:function(){
        if(_user._inMobile()){
            $("#post_form_more").hide();
            $("#form_checkbox_recom").show();
            return;
        }
        if(_postTemp._get(_postInvite._id)=="0" || _postTemp._get(_postJoin._joinItemKey)!=""
            ||_postTemp._get(_postJoin._joinOrderKey)!=""
            ||_postTemp._get(_postJoin._joinValueKey)!=""||_payItem._isPayItem()
            ||_postTemp._get("post_"+ _joinLimit._id+"_limit")!=""
            ||_postTemp._get(_payItem._id+"_pay_show")=="1"){
            if(_postTemp._get(_payItem._id+"_pay_show")=="1"){
                _postTemp._set(_payItem._id+"_pay_show","");
                _payItem._show();
                _postMore._show(true);
            }else{
                _postMore._show(true);
            }
        }
        if(_postTemp._get("post_vote_anonymous")=="0"){
            _postMore._show(true);
        }
    }
};

/*报名人数限制*/
var _joinLimit={
    _id:"",
    _init:function(id){
        _joinLimit._id = id;

        $(".limitNum .limit_L input").keyup(function(){
            $(this).val($(this).val().replace(/[^(\d)]/g,''));
            $(this).val($(this).val().replace(/^0/g,''));
        });
        $(".limitNum .limit_L input").blur(function(){
            if($(this).val()!=''){
                thisNum=$(this).val();
                if(thisNum<=500000){
                	$(this).next("p").html("允许"+thisNum+"人报名").show();
                    $(this).hide();
                    _postTemp._set("post_"+_joinLimit._id+"_limit",thisNum);
                }
            }else{
                _postTemp._set("post_"+_joinLimit._id+"_limit","");
            }
        });
        $(".limitNum .limit_L input").focus(function(){
            if($(this).val()!=''){
                $(this).next("p").hide();
                $(this).show();
            }
        });
        $(".limitNum .limit_L p").click(function(){
            if(_payItem._isPayItem()){return;};
            $(this).hide();
            var tNr=$(this).prev("input").val();
            $(this).prev("input").val('').show().focus().val(tNr);
        });
        _joinLimit._show();
    },
    _show:function(){
        if(_payItem._isPayItem()){
            var _limitPay = "";
            var _nameArr = _postTemp._get(_joinLimit._id+"_pay_item_name").split("^");
            var _priceArr = _postTemp._get(_joinLimit._id+"_pay_item_price").split("^");
            var _numArr = _postTemp._get(_joinLimit._id+"_pay_item_num").split("^");

            for(var i= 0,_len=_nameArr.length;i<_len;i++){
                if(i<_nameArr.length&&_nameArr[i]!=""&&i<_priceArr.length&&_priceArr[i]!=""){
                    if(i<_numArr.length){
                        if(_numArr[i]=="0"||_numArr[i]==""){_limitPay+="无限制/";}else{_limitPay+=_numArr[i]+"/";}
                    }else{
                        _limitPay+="无限制/";
                    }
                }
            }

            if(_limitPay!=""){ $(".limitNum .limit_L input").hide();$(".limitNum .limit_L p").show();$(".limitNum .limit_L p").html("允许"+_limitPay.substring(0,_limitPay.length-1)+"人报名");}

        }else{
            var _limit =  _postTemp._get("post_"+ _joinLimit._id+"_limit");
            if(_limit!=""&&_limit!="0"){
                $("#person_limit").val(_limit);
                thisNum=$(".limitNum .limit_L input").val();
                $(".limitNum .limit_L p").html("允许"+thisNum+"人报名").show();
                $(".limitNum .limit_L input").hide();
            }else{
                $(".limitNum .limit_L input").show();
                $(".limitNum .limit_L p").hide();
            }
            if(_limit>500000){
            	$(".limitNum .limit_L input").show();
            	$(".limitNum .limit_L input").val('');
            	$(".limitNum .limit_L p").hide();
            }
        }
    }
};

/**最大金额*/
var _maxMoney={
    _max:0,
    _init:function(){
        //_$(_postApi._maxMoney,"",_maxMoney._ok);
    	_maxMoney._max = 10000;
    },
    _ok:function(json,code){
        if(code!=200){return;}
        _maxMoney._max = json.max_money;
    }
};
var _postDetail=function(url){
    var _aa = $("<a href=\""+url+"\"></a>");
    $("body").append(_aa);
    _aa[0].click();
};

/*公众号二维码*/
var _moreGn = {
    _center:function(){
        var _top =  _._zero(_._client().bh-$("#moreGn").outerHeight())/2+"px";
        var _left = _._zero(_._client().bw -$("#moreGn").outerWidth())/2+"px";
        $("#moreGn").css({"left": _left,"top":_top,"z-index":"3000","position":"fixed"});
    },
    _show:function(){
        _cover._show("cover2");
        _moreGn._center();
        $("#moregn_ol_"+_post._type).show();
        $("#moreGn").show();
        $(window).bind("resize", _moreGn._center);
        $("#cover2").bind("click",_moreGn._hide);
    },
    _hide:function(){
        $("#moreGn").hide();
        _cover._hide("cover2");
    }
};

/*移动端城市选择***************************************************/
var _citySelect = { //城市筛选
  _id: "",
  _center: function() {
    var _top = _._zero(_._client().bh - $("#" + _citySelect._id).outerHeight()) / 2 + "px";
    var _left = _._zero(_._client().bw - $("#" + _citySelect._id).outerWidth()) / 2 + "px";
    $("#" + _citySelect._id).css({
      "left": _left,
      "top": _top,
      "z-index": "1001",
      "position": "fixed"
    });
  },
  _show: function(id) {
    _citySelect._id = id;
    $("#" + _citySelect._id).show();
    _cover._show("cover2");
    $("#cover2").bind("click", _citySelect._hide);
    _citySelect._center();
    $(window).bind("resize", _citySelect._center);
    _cover._show("cover2");
  },
  _hide: function() {
    _cover._hide("cover2");
    $("#" + _citySelect._id).hide();
  },
  _ok: function() {
    var sz = $("#attr_province" + _post._tempId).find("option:selected").val();
    var cz = $("#attr_city" + _post._tempId).find("option:selected").val();
    var qz = $("#attr_area" + _post._tempId).find("option:selected").val();
    if (sz != '') {
      if (cz == '') {
        _toast._show("请选择市");
        return;
      } else if (qz == '') {
        _toast._show("请选择区");
        return;
      }
    }
    if (sz == '' && cz == '' && qz == '') {
      //隐藏城市详细地址输入框
      $("#city_detail_place_" + _post._tempId).hide();
      $("#post_party_place_city_" + _post._tempId).val("");
      $("#post_party_place_site_" + _post._tempId).val("");
      $("#cacheCity").val("");
      _citySelect._hide();
      return;
    } else {
      //显示城市详细地址输入框
      $("#city_detail_place_" + _post._tempId).show();
    }
    var s = $("#attr_province" + _post._tempId).find("option:selected").text();
    var c = $("#attr_city" + _post._tempId).find("option:selected").text();
    var q = $("#attr_area" + _post._tempId).find("option:selected").text();

    var _tempId = _post._tempId;
    var _cacheTempId = _tempId;
    if (_post._id != "") {
      _cacheTempId += "_m";
    }
    var ca = '',
      show = '';
    if (s != '' && s != '直辖市' && s != '特别行政区' && s != '非中国地区' && s != '请选择省') {
      show = s + ' ';
    }
    if (c != '' && c != '非中国地区' && c != '请选择市') {
      show += c + ' ';
    }
    if (q != '' && q != '请选择区') {
      show += q;
    }
    if (s != '' && s != '请选择省' && c != '' && c != '请选择市' && q != '' && q != '请选择区') {
      ca = s + ' ' + c + ' ' + q;
    }
    $("#post_party_place_city_" + _tempId).val(show);
    _citySelect._hide();
    $("#cacheCity").val(ca);
    _t._set("post_party_place_city_" + _cacheTempId, ca);
    _t._set("attr_province" + _cacheTempId, $("#attr_province" + _tempId).val());
    _t._set("attr_city" + _cacheTempId, $("#attr_city" + _tempId).val());
    _t._set("attr_area" + _cacheTempId, $("#attr_area" + _tempId).val());
  }
};

/*发布活动MB*****************************************************/
var _partyPostMB = {
  _commArea: function(princeData, cityData, areaData, curlev, selid, selpid) {
    var pristr = "<option value=\"\" pid = \"\">请选择省</option>";
    var citystr = "<option value=\"\" pid = \"\">请选择市</option>";
    var areastr = "<option value=\"\" pid = \"\">请选择区</option>";
    var showpid = "",
      showcid = "";
    var selshowpid = "",
      selshowcid = "";
    for (var o in princeData) {
      var id = princeData[o].id;
      var pid = princeData[o].pid;
      var name = princeData[o].name;
      pristr += "<option value=\"" + id + "\" pid = \"" + pid + "\">" + name + "</option>";
      if (o == 0) {
        showpid = id;
      }
      if (selpid != "" && selpid != "-1" && id == selpid) {
        selshowpid = id;
      }
    }
    for (var o in cityData) {
      var id = cityData[o].id;
      var pid = cityData[o].pid;
      var name = cityData[o].name;
      if (selshowpid != "" && pid == selshowpid) {
        citystr += "<option value=\"" + id + "\" pid = \"" + pid + "\">" + name + "</option>";
      } else if (pid == showpid) {
        citystr += "<option value=\"" + id + "\" pid = \"" + pid + "\">" + name + "</option>";
      }
      if (o == 0) {
        showcid = id;
      }
      if (selid != "" && selid != "-1" && id == selid) {
        selshowcid = id;
      }
    }
    for (var o in areaData) {
      var id = areaData[o].id;
      var pid = areaData[o].pid;
      var name = areaData[o].name;
      if (selshowcid != "" && pid == selshowcid) {
        areastr += "<option value=\"" + id + "\" pid = \"" + pid + "\">" + name + "</option>";
      } else if (pid == showcid) {
        areastr += "<option value=\"" + id + "\" pid = \"" + pid + "\">" + name + "</option>";
      }
    }
    if (curlev == "2") {
      $("#attr_area" + _post._tempId + " option").remove();
      $("#attr_area" + _post._tempId).append(areastr);
      $("#attr_city" + _post._tempId + " option[value=" + selshowcid + "]").attr("selected", true);
    } else {
      $("#attr_province" + _post._tempId + " option").remove();
      $("#attr_city" + _post._tempId + " option").remove();
      $("#attr_area" + _post._tempId + " option").remove();
      $("#attr_province" + _post._tempId).append(pristr);
      $("#attr_city" + _post._tempId).append(citystr);
      $("#attr_area" + _post._tempId).append(areastr);
      if (selshowpid != "") {
        $("#attr_province" + _post._tempId + " option[value='" + selshowpid + "']").attr("selected", true);
      }
    }
  },
  _pitArea: function(curlev, selid, selpid) {
    var selpid = selpid;
    if (curlev == 2) {
      selpid = $("#attr_province" + _post._tempId).val();
    }
    $.ajax({
      type: "post",
      url: "/post/party?tempId=" + _post._tempId + "&curlev=" + curlev + "&selpid=" + selpid + "&selid=" + selid + "&hdb_from=WapPost",
      async: false,
      data: {
        "getPartyDetail": "getPartyDetail"
      },
      cache: false,
      dataType: "json",
      success: function(data) {
        if (data != null) {
          _partyPostMB._init(data, 200);
        }
      },
      error: function() {
        _loading._hide();
        _toast._show("网络错误，请重试");
      }
    });
  },
  _init: function(json, code) {
    if (json.prince != null) {
      var princeData = json.prince;
      var cityData = json.city;
      var areaData = json.area;
      var curlev = json.param.curlev;
      var selid = json.param.selid;
      var selpid = json.param.selpid;
      _partyPostMB._commArea(princeData, cityData, areaData, curlev, selid, selpid);
    }
  },
  _post: function(id) {
    if (!_user._login()) {
      _postBeforeLogin._mark("party", id || "0");
      _user._toLogin("Party");
      return;
    }
    var _title = _._trim($("#post_party_title_" + _post._tempId).val()),
      _content = $("#post_party_content_" + _post._tempId).val(),
      _startDate = "",
      _endDate = "",
      _recruitEndTime = "",
      _detailAddr = $("#post_party_place_site_" + _post._tempId).val(),
      _detailCity = $("#post_party_place_city_" + _post._tempId).val(),
      _tempId = _post._tempId,
      _private = _checkbox._getValue("post_party_private_" + _post._tempId);
    var _fetchArea = $("#cacheCity").val();
    if (_fetchArea != "") {
      _fetchArea = _fetchArea.split(" ").join("|");
    }
    if (_tempId == "100") {
      _recruitEndTime = $("#post_party_date_recruitEndtime_" + _post._tempId).val();
    } else {
      _startDate = $("#post_party_date_start_" + _post._tempId).val();
      _endDate = $("#post_party_date_end_" + _post._tempId).val();
    }
    var partyThem = "";
    if (_tempId == "103") {
      partyThem = "会议";
    } else if (_tempId == "104") {
      partyThem = "聚会";
    } else {
      partyThem = "活动";
    }
    if (_title == "") {
      _toast._show("请输入" + partyThem + "主题");
      return;
    }
    if (_content == "") {
      _toast._show("请输入" + partyThem + "详情");
      return;
    }
    if (_._len(_title) > 70) {
      _toast._show(partyThem + "主题请在35个字以内");
      return;
    }
    if (_content == "") {
      _toast._show("请输入" + partyThem + "详情");
      return;
    }
    var _len = _._len(_content);
    if (_len < 10) {
      _toast._show(partyThem + "详情写得太少了");
      return;
    }
    if (_len > 10000) {
      _toast._show(partyThem + "详情写得有点多了");
      return;
    }
    if (_startDate != "" && _endDate != "") {
      if (_datePicker._earilier(_startDate)) {
        _toast._show("开始时间应大于当前时间");
        return;
      }
    }
    var params = {
      "update_id": (id || ""),
      "title": _._encode(_title),
      "content": _._encode(_content),
      "private": _private,
      "start_date": _._encode(_startDate),
      "over_date": _._encode(_endDate),
      "template_id": _tempId,
      "location_area": _._encode(_fetchArea),
      "recruit_end_time": _._encode(_recruitEndTime),
      "location_text": _._encode(_detailAddr),
      "scene_id": _post._sceneId
    };
    _loading._show("请稍候");
    _$(_postApi._party, "update_id=" + (id || "") + "&title=" + _._encode(_title) + "&content=" + _._encode(_content) + "&private=" + _private +
      "&start_date=" + _._encode(_startDate) + "&over_date=" + _._encode(_endDate) + "&template_id=" + _tempId + "&location_area=" + _._encode(_fetchArea) +
      "&recruit_end_time=" + _._encode(_recruitEndTime) + "&location_text=" + _._encode(_detailAddr) + "&scene_id=" + _post._sceneId, _partyPostMB._ok);
  },
  _ok: function(json, code) {
    _loading._hide();
    if (code != 200) {
      return;
    }
    if (json.state.toString() != "0") {
      _toast._show(json.error, function() {
        _user._error(json.state, "post_party");
      });
      return;
    }
    _postBeforeLogin._mark("party", "");
    var _getTempId = _post._tempId;
    if (_getTempId == "104") {
      _checkbox._setValue("post_party_private_" + _getTempId, 1, true);
    } else {
      _checkbox._setValue("post_party_private_" + _getTempId, 0, true);
    }
    var _cacheTempId = _getTempId;
    if (_post._id != "") {
      _cacheTempId += "_m";
    }
    _t._set("post_party_title_" + _cacheTempId, "");
    _t._set("post_party_content_" + _cacheTempId, "");
    _t._set("post_party_private_" + _cacheTempId, "");
    _t._set("post_party_place_site_" + _cacheTempId, "");
    _t._set("post_party_place_city_" + _cacheTempId, "");
    _t._set("post_party_date_endtime_" + _cacheTempId, "");
    _t._set("post_party_date_start_" + _cacheTempId, "");
    _t._set("post_party_date_end_" + _cacheTempId, "");
    _t._set("attr_province" + _cacheTempId, "");
    _t._set("attr_city" + _cacheTempId, "");
    _t._set("attr_area" + _cacheTempId, "");
    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)) {
      _postDetail("/party/" + json.party_id + "-WapFind.html");
    } else {
      _g("/party/" + json.party_id + "-WapFind.html");
    }
  }
};
/*发布文章MB*****************************************************/
var _articlePostMB = {
  _post: function(id) {
    var PCArticle = arguments[1];
    if (!_user._login()) {	//验证用户是否登录
      _postBeforeLogin._mark("article", id || "0");	//标记没登录状态
      _user._toLogin('Article');	//跳转到登录页
      return;
    }
    var _title = _._trim($("#post_article_title").val()), _private = _checkbox._getValue("post_article_private"); //获取标题，内容，是否允许互动吧推荐
    
    var _content = $("#post_article_content").val();
    
    if (_title == "") {	//弹出标题不能为空提示
      _toast._show("请输入文章标题");
      return;
    }
    if (_._len(_title) > 70) {	//弹出标题过长提示
      _toast._show("标题请在35个字以内");
      return;
    }
    if (_content == "") {	//弹出文章内容不能为空提示
      _toast._show("请输入文章内容");
      return;
    }
    if (_user._inMobile()) {	//如果用户用手机发布文章验证
      var _len = _._len(_content);	//获取文章内容长度
      if (_len < 10) {	//弹出内容过短提示
        _toast._show("内容太短了");
        return;
      }
      if (_len > 20000) {	//弹出内容过长提示
        _toast._show("内容过长了，建议分多篇发");
        return;
      }
    } else {	//如果用户用电脑发布文章验证
      var _len = _._len(_content);

      if (_len < 10) {	//替换图片内容后，文字内容过短提示
        _toast._show("内容太短了");
        return;
      }
      if (_len > 20000) {	//替换图片内容后，文字内容过长提示
        _toast._show("内容过长了，建议分多篇发");
        return;
      }
    }
    _loading._show("请稍候");	//弹出加载框
    //异步请求调用添加文字接口
    var params = {"update_id" : (id || ""),"title" : _._encode(_title),"content" : _._encode(_content),"private" : _private,"scene_id" : _post._sceneId};

    _$(_postApi._article, "update_id=" + (id || "") + "&title=" + _._encode(_title) + "&content=" + _._encode(_content) + "&private=" + _private
    		+ "&scene_id=" + _post._sceneId, _article._ok);
  },
  _ok: function(json, code) {	//添加完文字后回调函数
    _loading._hide();	//隐藏加载框
    if (code != 200) {	//表明服务器非正常响应了客户端的请求
      return;
    }
    if (json.state.toString() != "0") { //请求执行状态：0执行成功，1执行失败 （执行失败处理）
      _toast._show(json.error, function() {	
        _user._error(json.state, "post_article");
      });	//弹出服务器错误提示并根据错误提示标记状态或者跳转到登录界面
      return;
    }
    _postBeforeLogin._mark("article", "");	//清除发布文章标识
    $("#post_article_title").val("");	//清除文章标题
    _checkbox._setValue("post_article_private", 0, true);	//将是否允许互动吧推荐设置为默认值 0公开，1私有

    $("#post_article_content").val("");	//清除富文本内容
    if (_post._id == "") {		//id为空
      _t._set("post_article_title", "");	//清除文章标题
      _t._set("post_article_content", "");	//清除文章内容
      _t._set("post_article_private", "");	//清除文章是否推荐状态
    }

    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)) {	//IE浏览器
    	_postDetail("/article/" + json.article_id + "-WapFind.html");
    } else {
     	_g("/article/" + json.article_id + "-WapFind.html");	//跳转到文章详情页面
    }
  }
};
  /*发布投票MB*****************************************************/
var _votePostMB = {
  _kind: function(type) {
    if (_post._id != "") {
      return;
    }
    var _kId = "1";
    if (type == 0) { //初始化
      if (_postTemp._get('post_vote_kind') != "") {
        _kId = _postTemp._get('post_vote_kind');
      }
      $("#post_vote_kind_select option[value='" + _kId + "']").attr("selected", "seleted");
    } else { //select选择值后
      _kId = $("#post_vote_kind_select option:selected").val();
    }
    var _k = 1;
    if (_kId != 1) {
      _k = 0;
    }
    $("#post_vote_kind").val(_k);
    $("#post_vote_count").val(_kId);
    _postTemp._set('post_vote_kind', _k);
    _postTemp._set('post_vote_count', _kId);
  },
  _kindPC: function(kId, type) {
    if (_post._id != "") {
      return;
    }
    var _kId = kId;
    if (type == 0) {
      if (_postTemp._get('post_vote_kind') != "") {
        _kId = _postTemp._get('post_vote_kind');
        if ($(".mnxlkPC a[value='" + _kId + "']").text() != '') {
          $(".mnxlkPC span").text($(".mnxlkPC a[value='" + _kId + "']").text());
        }
      }
    } else {
      _postTemp._set('post_vote_count', _kId);
      $(".mnxlkPC span").text($(".mnxlkPC a[value='" + _kId + "']").text());
    }
    var _k = 1;
    if (_kId != 1) {
      _k = 0;
    }
    $("#post_vote_kind").val(_k);
    $("#post_vote_count").val(_kId == 1 ? 0 : _kId);
    _postTemp._set('post_vote_kind', _kId);
  },
  _post: function(id) {
    if (!_user._login()) {
      _postBeforeLogin._mark("vote", id || "0");
      _user._toLogin('Vote');
      return;
    }
    var _title = _._trim($("#post_vote_title").val()),
      _content = $("#post_vote_content").val(),
      _kind = $("#post_vote_kind").val(),
      _count = $("#post_vote_count").val(),
      _options = "",
      _result = $("#post_vote_result").val(),
      _private = _checkbox._getValue("post_vote_private");
    if (_post._id == "") {
      _options = _optionPost._getOptions();
    }
    if (_title == "") {
      _toast._show("请输入投票标题");
      return;
    }
    if (_._len(_title) > 70) {
      _toast._show("标题请在35个字以内");
      return;
    }
    if (_._len(_content) > 20000) {
      _toast._show("投票详情写得有点多了");
      return;
    }
    if (_post._id == "") {
      if (_options.indexOf("^") == -1) {
        _toast._show("至少需要输入2个投票选项");
        return;
      }
      var _index = _optionPost._checkLength() + 1;
      if (_index > 0) {
        _toast._show("第" + _index + "选项写多了，请在25个字以内");
        return;
      }
    }
    if (_._len(_result) > 1500) {
      _toast._show("投票结果说明写得有点多了");
      return;
    }
    var params = {
      "update_id": (id || ""),
      "kind": _kind,
      "count": _count,
      "title": _._encode(_title),
      "describe": _._encode(_content),
      "option": _._encode(_options),
      "result": _._encode(_result),
      "private": _private,
      "scene_id": _post._sceneId
    };
    _loading._show("请稍候");
    _$(_postApi._vote, "update_id=" + (_post._id || "") + "&kind=" + _kind + "&count=" + _count + "&title=" + _._encode(_title) + "&describe=" +
      _._encode(_content) + "&option=" + _._encode(_options) + "&result=" + _._encode(_result) + "&private=" + _private + "&scene_id=" + _post._sceneId, _votePostMB._ok);
  },
  _ok: function(json, code) {
    _loading._hide();
    if (code != 200) {
      return;
    }
    if (json.state.toString() != "0") {
      _toast._show(json.error, function() {
        _user._error(json.state, "post_vote");
      });
      return;
    }
    _postBeforeLogin._mark("vote", "");
    $("#post_vote_title").val("");
    $("#post_vote_content").val("");
    _votePostMB._kind("1", true);
    _optionPost._clearOptions();
    $("#post_vote_result").val("");
    _checkbox._setValue("post_vote_private", 0, true);
    if (_post._id == "") {
      _t._set("post_vote_title", "");
      _t._set("post_vote_content", "");
      _t._set("post_vote_kind", "");
      _t._set("post_vote_option", "");
      _t._set("post_vote_result", "");
      _t._set("post_vote_private", "");
      _t._set("post_vote_count", "");
    }
    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)) {
      _postDetail("/vote/" + json.vote_id + "-WapFind.html");
    } else {
      _g("/vote/" + json.vote_id + "-WapFind.html");
    }
  }
};
/*投票选项设置*/
var _optionPost = {
  _count: 0,
  _list: null,
  _addItem: function(value) {
    if (_optionPost._count == 50) {
      _toast._show("最多只能添加50项");
      return;
    }
    var _item_class = _optionPost._count == 0 ? "form_input" : "form_input  form_input_union";
    var _item = "<li class=\"post_vote_option_li\"><span class=\"post_vote_option_s\">选项" + (_optionPost._count + 1) + "：</span>" +
      "<p class=\"post_vote_option_p\"><input type=\"text\" maxlength=\"25\" onblur=\"_optionPost._onBlur('" + _optionPost._count + "')\" " +
      " id=\"post_vote_option_" + (_optionPost._count + 1) + "\" value=\"" + (value == "^" ? "" : value) + "\" /></p></li>";

    $("#post_vote_option").append(_item);
    if (value == "^") {
      $("#post_vote_option_" + (_optionPost._count + 1)).focus();
    }
    $("#post_vote_option_" + _optionPost._count).keyup(function() {
      var str = $(this).val();
      if (_._trim(str) == "")
        return;
      if (/[<>"']/g.test(str)) {
        $(this).val(str.substr(0, str.length - 1));
      }
    });
    _optionPost._count++;
  },
  _add: function() {
    if (_post._id != "") {
      return;
    }
    _optionPost._addItem("^");
    var f = $(".form_input").length;
  },
  _getOptions: function() {
    var _result = "";
    _optionPost._list = $("#post_vote_option input");
    for (var i = 0, _len = _optionPost._list.length; i < _len; i++) {
      var _one = _optionPost._list[i];
      _result += $(_one).val().replace(/\^/g, "") + "^";
    }
    return _result.replace(/\^{2,}/g, "^").replace(/^\^*/g, "").replace(/\^*$/g, "");
  },
  _clearOptions: function() {
    _optionPost._list = $("#post_vote_option input");
    for (var i = 0, _len = _optionPost._list.length; i < _len; i++) {
      var _one = _optionPost._list[i];
      $(_one).val("");
    }
  },
  _onBlur: function(index) {
    _postTemp._set("post_vote_option", _optionPost._getOptions());
    _optionPost._selectItem();
  },
  _selectItem: function(index) {
    var _opLen = _optionPost._getOptions().split("^").length;
    var _html = '<option value="1">单选</option><option value="0">多选(无限制)</option><option value="2">多选(最多选2项)</option>';
    for (var i = 3; i <= _opLen; i++) {
      _html += '<option value="' + i + '">多选(最多选' + i + '项)</option>';
    }
    $("#post_vote_kind_select").html(_html);
    var _oCount = _postTemp._get('post_vote_count') == "" ? "1" : _postTemp._get('post_vote_count');
    $("#post_vote_kind_select option[value='" + _oCount + "']").attr("selected", "seleted");
  },
  _selectItemPC: function(index) {
    var _opLen = _optionPost._getOptions().split("^").length;
    var _html = '<span>单选</span><a href="javascript:void(0);" value="1" onclick="_votePostMB._kindPC(1,1);">单选</a><a href="javascript:void(0);" value="0" onclick="_votePostMB._kindPC(0,1);">多选(无限制)</a><a href="javascript:void(0);" value="2" onclick="_votePostMB._kindPC(2,1);">多选(最多选2项)</a>';
    for (var i = 3; i <= _opLen; i++) {
      _html += '<a href="javascript:void(0);" value="' + i + '" onclick="_votePostMB._kindPC(' + i + ',1);">多选(最多选' + i + '项)</a>';
    }
    $(".mnxlkPC").html(_html);
    var _oCount = _postTemp._get('post_vote_count');
    var _val = $(".mnxlkPC a[value='" + _oCount + "']").attr("value");
    if (_val !== undefined) {
      $(".mnxlkPC span").text($(".mnxlkPC a[value='" + _oCount + "']").text());
    } else {
      $(".mnxlkPC span").text($(".mnxlkPC a[value='0']").text());
      _postTemp._set('post_vote_count', '0');
      $("#post_vote_count").val("0");
    }
  },
  _checkLength: function() {
    _optionPost._list = $("#post_vote_option input");
    for (var i = 0, _len = _optionPost._list.length; i < _len; i++) {
      var _one = _optionPost._list[i];
      if (_._len($(_one).val()) > 50) {
        return i;
      }
    }
    return -1;
  },
  _init: function(temp) {
    if (_post._id != "") {
      $("#post_vote_option_add").hide();
      $("#post_vote_kind_select").attr("disabled", "disabled");
    }
    $("#post_vote_option").html("");
    if (temp == "" || temp.indexOf("^") == -1) {
      temp += "^^";
    } else if (temp.match(/(.*\^.*){2,}/) == null) {
      temp += "^";
    };
    var _list = temp.split("^");
    for (var i = 0, _len = _list.length; i < _len; i++) {
      if (_post._id != "") {
        if (_list[i] != "") {
          _optionPost._addItem(_list[i]);
        }
      } else {
        _optionPost._addItem(_list[i]);
      }
    }
    _optionPost._list = $("#post_vote_option input");
    _optionPost._selectItem();
    if (window.location.href.indexOf('vote?id=') != -1) {
      if ($("#post_vote_option").children(':last').children('input').attr('value') == '') {
        $("#post_vote_option").children(':last').hide();
      }
      $("#form_anonymous").attr({
        "onclick": "",
        "title": "此处不可修改"
      });
    }
  }
};

function postJs(){
	var y = $(window).height();
	$("#post_form").css("min-height",y+"px");
	$(".textarea").width($("#post_form").width()-20);
}

$(document).ready(function(){
    postJs();
    $(".moreGn").show();
  //移动端初始化设置
if (_post._type == "article") { //移动端发布文章初始化
  if ($("#template_title").val() != undefined) { //初始化缓存文章标题和文章内容（编辑）
    _t._set("post_article_title", $("#template_title").val());
    _t._set("post_article_content", $("#template_content").val());
  }
  if (_post._id != "") { //初始化缓存文章标题，内容，是否允许互动吧推荐（编辑）
    _t._set("post_article_title_m", _._htmlencode($('#post_article_title_t').html()));
    _t._set("post_article_content_m", $('#post_article_content_t').html());
    _t._set("post_article_private_m", _post._isPrivate);
  }
  $("#post_article_title").val(_postTemp._get("post_article_title")); //设置页面文章标题
  $("#post_article_content").val(_postTemp._get("post_article_content")); //设置页面文章标题
  _checkbox._setValue("post_article_private", _postTemp._get("post_article_private"), true);
  _placeholder._init("post_form"); //初始化表单可输入文字
  $("#post_article_title").val(_._htmlencodeReturn($("#post_article_title").val())); //初始化文章标题
} else if (_post._type == "party") { //移动端发布活动初始化
  var _shareTitle = _post._pageTitle.split("-")[0];
  dataForShare.title = _shareTitle + ",快速召集好友来参加，互动吧-最大的活动发布平台";
  var _getTempId = _post._tempId;
  var _cacheTempId = _getTempId;
  if ($("#template_title").val() != undefined) {
    _t._set("post_party_title_" + _getTempId, $("#template_title").val());
    _t._set("post_party_content_" + _getTempId, $("#template_content").val());
  }
  if (_post._id != "") {
    _cacheTempId += "_m";
    _t._set("post_party_title_" + _cacheTempId, _post._title);
    _t._set("post_party_content_" + _cacheTempId, _post._content);
    _t._set("post_party_date_recruitEndtime_" + _cacheTempId, _post._recruitEndtime);
    var sdate = _post._startDate,
      edate = _post._endDate;
    if (sdate != "") {
      sdate = sdate.replace(",", " ");
    }
    if (edate != "") {
      edate = edate.replace(",", " ");
    }
    _t._set("post_party_date_start_" + _cacheTempId, sdate);
    _t._set("post_party_date_end_" + _cacheTempId, edate);
    var _shenstr = _post._attrProvince;
    var _shistr = _post._attrCity;
    var _qustr = _post._attrArea;
    if (_shenstr != "") {
      _shenstr = _shenstr.replace(/,/ig, "");
    }
    if (_shistr != "") {
      _shistr = _shistr.replace(/,/ig, "");
    }
    if (_qustr != "") {
      _qustr = _qustr.replace(/,/ig, "");
    }
    _t._set("attr_province" + _cacheTempId, _shenstr);
    _t._set("attr_city" + _cacheTempId, _shistr);
    _t._set("attr_area" + _cacheTempId, _qustr);
    _t._set("post_party_place_site_" + _cacheTempId, _post._detailArea);
    _t._set("post_party_place_city_" + _cacheTempId, _post._showCityinfo);
  }
  $("#post_party_title_" + _getTempId).val(_postTemp._get("post_party_title_" + _getTempId));
  $("#post_party_content_" + _getTempId).val(_postTemp._get("post_party_content_" + _getTempId));
  $("#post_party_date_start_" + _getTempId).val(_postTemp._get("post_party_date_start_" + _getTempId));
  $("#post_party_date_end_" + _getTempId).val(_postTemp._get("post_party_date_end_" + _getTempId));
  $("#post_party_date_recruitEndtime_" + _getTempId).val(_postTemp._get("post_party_date_recruitEndtime_" + _getTempId));
  $("#post_party_place_site_" + _getTempId).val(_postTemp._get("post_party_place_site_" + _getTempId));
  var _locarea = _postTemp._get("post_party_place_city_" + _getTempId);
  if (_locarea != "") {
    _locarea = _locarea.split(" ");
    var s = "",
      c = "",
      a = "";
    if (_locarea.length == 3) {
      s = _locarea[0];
      c = _locarea[1];
      a = _locarea[2];
    } else {
      c = _locarea[0];
      a = _locarea[1];
    }
    if (s != '直辖市' && s != '特别行政区' && s != '非中国地区') {
      s += ' ';
    } else {
      s = "";
    }
    if (c != '非中国地区') {
      c += ' ';
    } else {
      c = "";
    }
    $("#post_party_place_city_" + _getTempId).val(s + c + a);
    $("#cacheCity").val(s + c + a);
  }
  var selpid = _postTemp._get("attr_province" + _getTempId);
  var selid = _postTemp._get("attr_city" + _getTempId);
  $.ajax({
    type: "post",
    url: "/post/party?tempId=" + _getTempId + "&selpid=" + selpid + "&selid=" + selid + "&hdb_from=WapPost",
    async: false,
    data: {
      "getPartyDetail": "getPartyDetail"
    },
    cache: false,
    dataType: "json",
    success: function(data) {
      if (data != null) {
        _partyPostMB._init(data, 200);
      }
    },
    error: function() {
      _loading._hide();
      _toast._show("网络错误，请重试");
    }
  });
  var areaid = _postTemp._get("attr_area" + _getTempId);
  $("#attr_province" + _getTempId + " option[value='" + selpid + "']").attr("selected", true);
  $("#attr_city" + _getTempId + " option[value='" + selid + "']").attr("selected", true);
  $("#attr_area" + _getTempId + " option[value='" + areaid + "']").attr("selected", true);
  var ifPrivate = _postTemp._get("post_party_private_" + _getTempId);
  if (ifPrivate != "") {
    _checkbox._setValue("post_party_private_" + _getTempId, ifPrivate, true);
  } else {
    if (_getTempId == "104") {
      _checkbox._setValue("post_party_private_" + _getTempId, 1, true);
    } else {
      _checkbox._setValue("post_party_private_" + _getTempId, 0, true);
    }
  }
  var _cityinfo = $("#post_party_place_city_" + _post._tempId).val();
  if (_cityinfo == "") {
    $("#city_detail_place_" + _post._tempId).hide();
  }
  _placeholder._init("post_form");
} else if (_post._type == "vote") { //移动端发布投票初始化
  if ($("#template_title").val() != undefined) {
    _t._set("post_vote_title", $("#template_title").val());
    _t._set("post_vote_content", $("#template_content").val());
    _t._set("post_vote_option", $("#template_text").val());
    _t._set("post_vote_result", "");
  }
  if (_post._id != "") {
    _t._set("post_vote_title_m", _._htmlencode($('#post_vote_title_t').html()));
    _t._set("post_vote_content_m", $('#post_vote_content_t').html());
    _t._set("post_vote_option_m", $('#post_vote_option_t').html());
    _t._set("post_vote_result_m", $('#post_vote_result_t').html());
    _t._set("post_vote_kind_m", _post._kind);
    _t._set("post_vote_private_m", _post._isPrivate);
    _t._set("post_vote_count_m", _post._count);
  }
  $("#post_vote_title").val(_postTemp._get("post_vote_title"));
  $("#post_vote_content").val(_postTemp._get("post_vote_content"));
  $("#post_vote_result").val(_postTemp._get("post_vote_result"));
  $("#post_vote_title").val(_._htmlencodeReturn($("#post_vote_title").val()));
  $("#post_vote_result").val(_._htmlencodeReturn($("#post_vote_result").val()));
  _postTemp._set('post_vote_kind', "");
  _optionPost._init(_postTemp._get("post_vote_option"));
  _checkbox._setValue("post_vote_private", _postTemp._get("post_vote_private"), true);
  var cacheCount = _postTemp._get("post_vote_count") == "" ? 1 : _postTemp._get("post_vote_count");
  if (_post._id != "") {
    $("#post_vote_kind").val(cacheCount != 1 ? 0 : 1);
    $("#post_vote_count").val(cacheCount);
  } else {
    _votePostMB._kind(cacheCount);
  }
  _placeholder._init("post_form");
  if (_user._inMobile()) {
    $(".xlK_btn").css({
      "display": "none"
    });
    var w = $("body").width();
    $("#post_vote_kind_select").width(w - 100);
  }
} else if (_post._type == "post") {
  $(".type_Pic").height($(".type_Pic").width());
  _post_alert();
}
});




