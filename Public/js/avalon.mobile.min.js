(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("Avalon requires a window with a document")}return factory(w)}}else{factory(global)}}(typeof window!=="undefined"?window:this,function(window,noGlobal){var expose=Date.now();var DOC=window.document;var head=DOC.head;head.insertAdjacentHTML("afterBegin",'<avalon ms-skip class="avalonHide"><style id="avalonStyle">.avalonHide{ display: none!important }</style></avalon>');var ifGroup=head.firstChild;function log(){if(avalon.config.debug){console.log.apply(console,arguments)}}function createMap(){return Object.create(null)}var subscribers="$"+expose;var nullObject={};var rword=/[^, ]+/g;var rw20g=/\w+/g;var rsvg=/^\[object SVG\w*Element\]$/;var rwindow=/^\[object (?:Window|DOMWindow|global)\]$/;var oproto=Object.prototype;var ohasOwn=oproto.hasOwnProperty;var serialize=oproto.toString;var ap=Array.prototype;var aslice=ap.slice;var W3C=window.dispatchEvent;var root=DOC.documentElement;var avalonFragment=DOC.createDocumentFragment();var cinerator=DOC.createElement("div");var class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(name){class2type["[object "+name+"]"]=name.toLowerCase()});function scpCompile(array){return Function.apply(noop,array)}function noop(){}function oneObject(array,val){if(typeof array==="string"){array=array.match(rword)||[]}var result={},value=val!==void 0?val:1;for(var i=0,n=array.length;i<n;i++){result[array[i]]=value}return result}var generateID=function(prefix){prefix=prefix||"avalon";return String(Math.random()+Math.random()).replace(/\d\.\d{4}/,prefix)};function IE(){if(window.VBArray){var mode=document.documentMode;return mode?mode:window.XMLHttpRequest?7:6}else{return NaN}}var IEVersion=IE();avalon=function(el){return new avalon.init(el)};avalon.nextTick=new function(){var tickImmediate=window.setImmediate;var tickObserver=window.MutationObserver;if(tickImmediate){return tickImmediate.bind(window)}var queue=[];function callback(){var n=queue.length;for(var i=0;i<n;i++){queue[i]()}queue=queue.slice(n)}if(tickObserver){var node=document.createTextNode("avalon");new tickObserver(callback).observe(node,{characterData:true});var bool=false;return function(fn){queue.push(fn);bool=!bool;node.data=bool}}return function(fn){setTimeout(fn,4)}};avalon.init=function(el){this[0]=this.element=el};avalon.fn=avalon.prototype=avalon.init.prototype;avalon.type=function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[serialize.call(obj)]||"object":typeof obj};var isFunction=function(fn){return serialize.call(fn)==="[object Function]"};avalon.isFunction=isFunction;avalon.isWindow=function(obj){return rwindow.test(serialize.call(obj))};avalon.isPlainObject=function(obj){return serialize.call(obj)==="[object Object]"&&Object.getPrototypeOf(obj)===oproto};avalon.mix=avalon.fn.mix=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i++}if(typeof target!=="object"&&!isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(avalon.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&avalon.isPlainObject(src)?src:{}}target[name]=avalon.mix(deep,clone,copy)}else{if(copy!==void 0){target[name]=copy}}}}}return target};function _number(a,len){a=Math.floor(a)||0;return a<0?Math.max(len+a,0):Math.min(a,len)}avalon.mix({rword:rword,subscribers:subscribers,version:1.55,ui:{},log:log,slice:function(nodes,start,end){return aslice.call(nodes,start,end)},noop:noop,error:function(str,e){throw new (e||Error)(str)},oneObject:oneObject,range:function(start,end,step){step||(step=1);if(end==null){end=start||0;start=0}var index=-1,length=Math.max(0,Math.ceil((end-start)/step)),result=new Array(length);while(++index<length){result[index]=start;start+=step}return result},eventHooks:{},bind:function(el,type,fn,phase){var hooks=avalon.eventHooks;var hook=hooks[type];if(typeof hook==="object"){type=hook.type||type;phase=hook.phase||!!phase;fn=hook.fn?hook.fn(el,fn):fn}el.addEventListener(type,fn,phase);return fn},unbind:function(el,type,fn,phase){var hooks=avalon.eventHooks;var hook=hooks[type];var callback=fn||noop;if(typeof hook==="object"){type=hook.type||type;phase=hook.phase||!!phase}el.removeEventListener(type,callback,phase)},css:function(node,name,value){if(node instanceof avalon){node=node[0]}var prop=/[_-]/.test(name)?camelize(name):name,fn;name=avalon.cssName(prop)||prop;if(value===void 0||typeof value==="boolean"){fn=cssHooks[prop+":get"]||cssHooks["@:get"];if(name==="background"){name="backgroundColor"
}var val=fn(node,name);return value===true?parseFloat(val)||0:val}else{if(value===""){node.style[name]=""}else{if(value==null||value!==value){return}if(isFinite(value)&&!avalon.cssNumber[prop]){value+="px"}fn=cssHooks[prop+":set"]||cssHooks["@:set"];fn(node,name,value)}}},each:function(obj,fn){if(obj){var i=0;if(isArrayLike(obj)){for(var n=obj.length;i<n;i++){if(fn(i,obj[i])===false){break}}}else{for(i in obj){if(obj.hasOwnProperty(i)&&fn(i,obj[i])===false){break}}}}},getWidgetData:function(elem,prefix){var raw=avalon(elem).data();var result={};for(var i in raw){if(i.indexOf(prefix)===0){result[i.replace(prefix,"").replace(/\w/,function(a){return a.toLowerCase()})]=raw[i]}}return result},Array:{ensure:function(target,item){if(target.indexOf(item)===-1){return target.push(item)}},removeAt:function(target,index){return !!target.splice(index,1).length},remove:function(target,item){var index=target.indexOf(item);if(~index){return avalon.Array.removeAt(target,index)}return false}}});var bindingHandlers=avalon.bindingHandlers={};var bindingExecutors=avalon.bindingExecutors={};var directives=avalon.directives={};avalon.directive=function(name,obj){bindingHandlers[name]=obj.init=(obj.init||noop);bindingExecutors[name]=obj.update=(obj.update||noop);return directives[name]=obj};function isArrayLike(obj){if(obj&&typeof obj==="object"){var n=obj.length,str=serialize.call(obj);if(/(Array|List|Collection|Map|Arguments)\]$/.test(str)){return true}else{if(str==="[object Object]"&&n===(n>>>0)){return true}}}return false}var Cache=new function(){function LRU(maxLength){this.size=0;this.limit=maxLength;this.head=this.tail=void 0;this._keymap={}}var p=LRU.prototype;p.put=function(key,value){var entry={key:key,value:value};this._keymap[key]=entry;if(this.tail){this.tail.newer=entry;entry.older=this.tail}else{this.head=entry}this.tail=entry;if(this.size===this.limit){this.shift()}else{this.size++}return value};p.shift=function(){var entry=this.head;if(entry){this.head=this.head.newer;this.head.older=entry.newer=entry.older=this._keymap[entry.key]=void 0;delete this._keymap[entry.key]}};p.get=function(key){var entry=this._keymap[key];if(entry===void 0){return}if(entry===this.tail){return entry.value}if(entry.newer){if(entry===this.head){this.head=entry.newer}entry.newer.older=entry.older}if(entry.older){entry.older.newer=entry.newer}entry.newer=void 0;entry.older=this.tail;if(this.tail){this.tail.newer=entry}this.tail=entry;return entry.value};return LRU};if(!DOC.contains){Node.prototype.contains=function(arg){return !!(this.compareDocumentPosition(arg)&16)}}avalon.contains=function(root,el){try{while((el=el.parentNode)){if(el===root){return true}}return false}catch(e){return false}};if(window.SVGElement){var svgns="http://www.w3.org/2000/svg";var svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />';if(!rsvg.test(svg.firstChild)){function enumerateNode(node,targetNode){if(node&&node.childNodes){var nodes=node.childNodes;for(var i=0,el;el=nodes[i++];){if(el.tagName){var svg=DOC.createElementNS(svgns,el.tagName.toLowerCase());ap.forEach.call(el.attributes,function(attr){svg.setAttribute(attr.name,attr.value)});enumerateNode(el,svg);targetNode.appendChild(svg)}}}}Object.defineProperties(SVGElement.prototype,{"outerHTML":{enumerable:true,configurable:true,get:function(){return new XMLSerializer().serializeToString(this)},set:function(html){var tagName=this.tagName.toLowerCase(),par=this.parentNode,frag=avalon.parseHTML(html);if(tagName==="svg"){par.insertBefore(frag,this)}else{var newFrag=DOC.createDocumentFragment();enumerateNode(frag,newFrag);par.insertBefore(newFrag,this)}par.removeChild(this)}},"innerHTML":{enumerable:true,configurable:true,get:function(){var s=this.outerHTML;var ropen=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i");var rclose=new RegExp("</"+this.nodeName+">$","i");return s.replace(ropen,"").replace(rclose,"")},set:function(html){if(avalon.clearHTML){avalon.clearHTML(this);var frag=avalon.parseHTML(html);enumerateNode(frag,this)}}}})}}var eventHooks=avalon.eventHooks;if(!("onmouseenter" in root)){avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(origType,fixType){eventHooks[origType]={type:fixType,fn:function(elem,fn){return function(e){var t=e.relatedTarget;if(!t||(t!==elem&&!(elem.compareDocumentPosition(t)&16))){delete e.type;e.type=origType;return fn.call(elem,e)}}}}})}avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(construct,fixType){if(window[construct]&&!eventHooks.animationend){eventHooks.animationend={type:fixType}}});if(DOC.onmousewheel===void 0){eventHooks.mousewheel={type:"wheel",fn:function(elem,fn){return function(e){e.wheelDeltaY=e.wheelDelta=e.deltaY>0?-120:120;e.wheelDeltaX=0;Object.defineProperty(e,"type",{value:"mousewheel"});fn.call(elem,e)}}}}function kernel(settings){for(var p in settings){if(!ohasOwn.call(settings,p)){continue}var val=settings[p];if(typeof kernel.plugins[p]==="function"){kernel.plugins[p](val)
}else{if(typeof kernel[p]==="object"){avalon.mix(kernel[p],val)}else{kernel[p]=val}}}return this}var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g;function escapeRegExp(target){return(target+"").replace(rregexp,"\\$&")}var plugins={interpolate:function(array){openTag=array[0];closeTag=array[1];if(openTag===closeTag){throw new SyntaxError("openTag!==closeTag");var test=openTag+"test"+closeTag;cinerator.innerHTML=test;if(cinerator.innerHTML!==test&&cinerator.innerHTML.indexOf("&lt;")>-1){throw new SyntaxError("此定界符不合法")}cinerator.innerHTML=""}kernel.openTag=openTag;kernel.closeTag=closeTag;var o=escapeRegExp(openTag),c=escapeRegExp(closeTag);rexpr=new RegExp(o+"(.*?)"+c);rexprg=new RegExp(o+"(.*?)"+c,"g");rbind=new RegExp(o+".*?"+c+"|\\sms-")}};kernel.async=true;kernel.debug=false;kernel.plugins=plugins;kernel.plugins["interpolate"](["{{","}}"]);kernel.paths={};kernel.shim={};kernel.maxRepeatSize=100;avalon.config=kernel;function $watch(expr,binding){var $events=this.$events||(this.$events={});var queue=$events[expr]||($events[expr]=[]);if(typeof binding==="function"){var backup=binding;backup.uniqueNumber=Math.random();binding={element:root,type:"user-watcher",handler:noop,vmodels:[this],expr:expr,uniqueNumber:backup.uniqueNumber};binding.wildcard=/\*/.test(expr)}if(!binding.update){if(/\w\.*\B/.test(expr)){binding.getter=noop;var host=this;binding.update=function(){var args=this.fireArgs||[];if(args[2]){binding.handler.apply(host,args)}delete this.fireArgs};queue.sync=true;avalon.Array.ensure(queue,binding)}else{avalon.injectBinding(binding)}if(backup){binding.handler=backup}}else{if(!binding.oneTime){avalon.Array.ensure(queue,binding)}}return function(){binding.update=binding.getter=binding.handler=noop;binding.element=DOC.createElement("a")}}function $emit(key,args){var event=this.$events;if(event&&event[key]){if(args){args[2]=key}var arr=event[key];notifySubscribers(arr,args);var parent=this.$up;if(parent){if(this.$pathname){$emit.call(parent,this.$pathname+"."+key,args)}$emit.call(parent,"*."+key,args)}}else{parent=this.$up;if(this.$ups){for(var i in this.$ups){$emit.call(this.$ups[i],i+"."+key,args)}return}if(parent){var p=this.$pathname;if(p===""){p="*"}var path=p+"."+key;arr=path.split(".");if(arr.indexOf("*")===-1){$emit.call(parent,path,args);arr[1]="*";$emit.call(parent,arr.join("."),args)}else{$emit.call(parent,path,args)}}}}function collectDependency(el,key){do{if(el.$watch){var e=el.$events||(el.$events={});var array=e[key]||(e[key]=[]);dependencyDetection.collectDependency(array);return}el=el.$up;if(el){key=el.$pathname+"."+key}else{break}}while(true)}function notifySubscribers(subs,args){if(!subs){return}if(new Date()-beginTime>444&&typeof subs[0]==="object"){rejectDisposeQueue()}var users=[],renders=[];for(var i=0,sub;sub=subs[i++];){if(sub.type==="user-watcher"){users.push(sub)}else{renders.push(sub)}}if(kernel.async){buffer.render();for(i=0;sub=renders[i++];){if(sub.update){var uuid=getUid(sub);if(!buffer.queue[uuid]){buffer.queue[uuid]=1;buffer.queue.push(sub)}}}}else{for(i=0;sub=renders[i++];){if(sub.update){sub.update()}}}for(i=0;sub=users[i++];){if(args&&args[2]===sub.expr||sub.wildcard){sub.fireArgs=args}sub.update()}}var VMODELS=avalon.vmodels={};avalon.define=function(source){var $id=source.$id;if(!$id){log("warning: vm必须指定$id")}var vmodel=modelFactory(source);vmodel.$id=$id;return VMODELS[$id]=vmodel};var $$skipArray=oneObject("$id,$watch,$fire,$events,$model,$skipArray,$active,$pathname,$up,$ups,$track,$accessors");function modelFactory(source,options){options=options||{};options.watch=true;return observeObject(source,options)}function Component(){}function observeObject(source,options){if(!source||(source.$id&&source.$accessors)||(source.nodeName&&source.nodeType>0)){return source}options=options||nullObject;var force=options.force||nullObject;var old=options.old;var oldAccessors=old&&old.$accessors||nullObject;var $vmodel=new Component();var accessors={};var hasOwn={};var skip=[];var simple=[];var $skipArray={};if(source.$skipArray){$skipArray=oneObject(source.$skipArray);delete source.$skipArray}var computed=source.$computed;if(computed){delete source.$computed;for(var name in computed){hasOwn[name]=true;(function(key,value){var old;accessors[key]={get:function(){return old=value.get.call(this)},set:function(x){if(typeof value.set==="function"){var older=old;value.set.call(this,x);var newer=this[key];if(this.$fire&&(newer!==older)){this.$fire(key,newer,older)}}},enumerable:true,configurable:true}})(name,computed[name])}}for(name in source){var value=source[name];if(!$$skipArray[name]){hasOwn[name]=true}if(typeof value==="function"||(value&&value.nodeName&&value.nodeType>0)||(!force[name]&&(name.charAt(0)==="$"||$$skipArray[name]||$skipArray[name]))){skip.push(name)}else{if(isComputed(value)){log("warning:计算属性建议放在$computed对象中统一定义");(function(key,value){var old;accessors[key]={get:function(){return old=value.get.call(this)},set:function(x){if(typeof value.set==="function"){var older=old;
    value.set.call(this,x);var newer=this[key];if(this.$fire&&(newer!==older)){this.$fire(key,newer,older)}}},enumerable:true,configurable:true}})(name,value)}else{simple.push(name);if(oldAccessors[name]){accessors[name]=oldAccessors[name]}else{accessors[name]=makeGetSet(name,value)}}}}accessors["$model"]=$modelDescriptor;$vmodel=Object.defineProperties($vmodel,accessors,source);function trackBy(name){return hasOwn[name]===true}skip.forEach(function(name){$vmodel[name]=source[name]});hideProperty($vmodel,"$ups",null);hideProperty($vmodel,"$id","anonymous");hideProperty($vmodel,"$up",old?old.$up:null);hideProperty($vmodel,"$track",Object.keys(hasOwn));hideProperty($vmodel,"$active",false);hideProperty($vmodel,"$pathname",old?old.$pathname:"");hideProperty($vmodel,"$accessors",accessors);hideProperty($vmodel,"hasOwnProperty",trackBy);if(options.watch){hideProperty($vmodel,"$watch",function(){return $watch.apply($vmodel,arguments)});hideProperty($vmodel,"$fire",function(path,a){if(path.indexOf("all!")===0){var ee=path.slice(4);for(var i in avalon.vmodels){var v=avalon.vmodels[i];v.$fire&&v.$fire.apply(v,[ee,a])}}else{$emit.call($vmodel,path,[a])}})}simple.forEach(function(name){var oldVal=old&&old[name];var val=$vmodel[name]=source[name];if(val&&typeof val==="object"){val.$up=$vmodel;val.$pathname=name}$emit.call($vmodel,name,[val,oldVal])});for(name in computed){value=$vmodel[name]}$vmodel.$active=true;return $vmodel}function isComputed(val){if(val&&typeof val==="object"){for(var i in val){if(i!=="get"&&i!=="set"){return false}}return typeof val.get==="function"}}function makeGetSet(key,value){var childVm,value=NaN;return{get:function(){if(this.$active){collectDependency(this,key)}return value},set:function(newVal){if(value===newVal){return}var oldValue=value;childVm=observe(newVal,value);if(childVm){value=childVm}else{childVm=void 0;value=newVal}if(Object(childVm)===childVm){childVm.$pathname=key;childVm.$up=this}if(this.$active){$emit.call(this,key,[value,oldValue])}},enumerable:true,configurable:true}}function observe(obj,old,hasReturn,watch){if(Array.isArray(obj)){return observeArray(obj,old,watch)}else{if(avalon.isPlainObject(obj)){if(old&&typeof old==="object"){var keys=Object.keys(obj);var keys2=Object.keys(old);if(keys.join(";")===keys2.join(";")){for(var i in obj){if(obj.hasOwnProperty(i)){old[i]=obj[i]}}return old}old.$active=false}return observeObject(obj,{old:old,watch:watch})}}if(hasReturn){return obj}}function observeArray(array,old,watch){if(old){var args=[0,old.length].concat(array);old.splice.apply(old,args);return old}else{for(var i in newProto){array[i]=newProto[i]}hideProperty(array,"$up",null);hideProperty(array,"$pathname","");hideProperty(array,"$track",createTrack(array.length));array._=observeObject({length:NaN},{watch:true});array._.length=array.length;array._.$watch("length",function(a,b){$emit.call(array.$up,array.$pathname+".length",[a,b])});if(watch){hideProperty(array,"$watch",function(){return $watch.apply(array,arguments)})}Object.defineProperty(array,"$model",$modelDescriptor);for(var j=0,n=array.length;j<n;j++){var el=array[j]=observe(array[j],0,1,1);if(Object(el)===el){el.$up=array}}return array}}function hideProperty(host,name,value){Object.defineProperty(host,name,{value:value,writable:true,enumerable:false,configurable:true})}function toJson(val){var xtype=avalon.type(val);if(xtype==="array"){var array=[];for(var i=0;i<val.length;i++){array[i]=toJson(val[i])}return array}else{if(xtype==="object"){var obj={};for(i in val){if(val.hasOwnProperty(i)){var value=val[i];obj[i]=value&&value.nodeType?value:toJson(value)}}return obj}}return val}var $modelDescriptor={get:function(){return toJson(this)},set:noop,enumerable:false,configurable:true};var arrayMethods=["push","pop","shift","unshift","splice"];var arrayProto=Array.prototype;var newProto={notify:function(){$emit.call(this.$up,this.$pathname)},set:function(index,val){if(((index>>>0)===index)&&this[index]!==val){if(index>this.length){throw Error(index+"set方法的第一个参数不能大于原数组长度")}$emit.call(this.$up,this.$pathname+".*",[val,this[index]]);this.splice(index,1,val)}},contains:function(el){return this.indexOf(el)!==-1},ensure:function(el){if(!this.contains(el)){this.push(el)}return this},pushArray:function(arr){return this.push.apply(this,arr)},remove:function(el){return this.removeAt(this.indexOf(el))},removeAt:function(index){if((index>>>0)===index){return this.splice(index,1)}return[]},size:function(){return this._.length},removeAll:function(all){if(Array.isArray(all)){for(var i=this.length-1;i>=0;i--){if(all.indexOf(this[i])!==-1){_splice.call(this.$track,i,1);_splice.call(this,i,1)}}}else{if(typeof all==="function"){for(i=this.length-1;i>=0;i--){var el=this[i];if(all(el,i)){_splice.call(this.$track,i,1);_splice.call(this,i,1)}}}else{_splice.call(this.$track,0,this.length);_splice.call(this,0,this.length)}}if(!W3C){this.$model=toJson(this)}this.notify();this._.length=this.length},clear:function(){return this.removeAll()}};var _splice=arrayProto.splice;
    arrayMethods.forEach(function(method){var original=arrayProto[method];newProto[method]=function(){var args=[];for(var i=0,n=arguments.length;i<n;i++){args[i]=observe(arguments[i],0,1,1)}var result=original.apply(this,args);addTrack(this.$track,method,args);if(!W3C){this.$model=toJson(this)}this.notify();this._.length=this.length;return result}});"sort,reverse".replace(rword,function(method){newProto[method]=function(){var oldArray=this.concat();var newArray=this;var mask=Math.random();var indexes=[];var hasSort=false;arrayProto[method].apply(newArray,arguments);for(var i=0,n=oldArray.length;i<n;i++){var neo=newArray[i];var old=oldArray[i];if(neo===old){indexes.push(i)}else{var index=oldArray.indexOf(neo);indexes.push(index);oldArray[index]=mask;hasSort=true}}if(hasSort){sortByIndex(this.$track,indexes);if(!W3C){this.$model=toJson(this)}this.notify()}return this}});function sortByIndex(array,indexes){var map={};for(var i=0,n=indexes.length;i<n;i++){map[i]=array[i];var j=indexes[i];if(j in map){array[i]=map[j];delete map[j]}else{array[i]=array[j]}}}function createTrack(n){var ret=[];for(var i=0;i<n;i++){ret[i]=generateID("$proxy$each")}return ret}function addTrack(track,method,args){switch(method){case"push":case"unshift":args=createTrack(args.length);break;case"splice":if(args.length>2){var del=args[1];var add=args.length-2;args=[args[0],args[1]].concat(createTrack(args.length-2))}break}Array.prototype[method].apply(track,args)}var dependencyDetection=(function(){var outerFrames=[];var currentFrame;return{begin:function(binding){outerFrames.push(currentFrame);currentFrame=binding},end:function(){currentFrame=outerFrames.pop()},collectDependency:function(array){if(currentFrame){currentFrame.callback(array)}}}})();var roneval=/^on$/;function returnRandom(){return new Date()-0}avalon.injectBinding=function(binding){binding.handler=binding.handler||directives[binding.type].update||noop;binding.update=function(){var begin=false;if(!binding.getter){begin=true;dependencyDetection.begin({callback:function(array){injectDependency(array,binding)}});binding.getter=parseExpr(binding.expr,binding.vmodels,binding);binding.observers.forEach(function(a){a.v.$watch(a.p,binding)});delete binding.observers}try{var args=binding.fireArgs,a,b;delete binding.fireArgs;if(!args){if(binding.type==="on"){a=binding.getter+""}else{a=binding.getter.apply(0,binding.args)}}else{a=args[0];b=args[1]}b=typeof b==="undefined"?binding.oldValue:b;if(binding._filters){a=filters.$filter.apply(0,[a].concat(binding._filters))}if(binding.signature){var xtype=avalon.type(a);if(xtype!=="array"&&xtype!=="object"){throw Error("warning:"+binding.expr+"只能是对象或数组")}binding.xtype=xtype;var vtrack=getProxyIds(binding.proxies||[],xtype);var mtrack=a.$track||(xtype==="array"?createTrack(a.length):Object.keys(a));binding.track=mtrack;if(vtrack!==mtrack.join(";")){binding.handler(a,b);binding.oldValue=1}}else{if(Array.isArray(a)?a.length!==(b&&b.length):false){binding.handler(a,b);binding.oldValue=a.concat()}else{if(!("oldValue" in binding)||a!==b){binding.handler(a,b);binding.oldValue=a}}}}catch(e){delete binding.getter;log("warning:exception throwed in [avalon.injectBinding] ",e);var node=binding.element;if(node&&node.nodeType===3){node.nodeValue=openTag+(binding.oneTime?"::":"")+binding.expr+closeTag}}finally{begin&&dependencyDetection.end()}};binding.update()};function injectDependency(list,binding){if(binding.oneTime){return}if(list&&avalon.Array.ensure(list,binding)&&binding.element){injectDisposeQueue(binding,list);if(new Date()-beginTime>444){rejectDisposeQueue()}}}function getProxyIds(a,isArray){var ret=[];for(var i=0,el;el=a[i++];){ret.push(isArray?el.$id:el.$key)}return ret.join(";")}var disposeCount=0;var disposeQueue=avalon.$$subscribers=[];var beginTime=new Date();var oldInfo={};function getUid(data){if(!data.uniqueNumber){var elem=data.element;if(elem){if(elem.nodeType!==1){data.uniqueNumber=data.type+"-"+getUid(elem.parentNode)+"-"+(++disposeCount)}else{data.uniqueNumber=data.name+"-"+getUid(elem)}}else{data.uniqueNumber=++disposeCount}}return data.uniqueNumber}function injectDisposeQueue(data,list){var lists=data.lists||(data.lists=[]);var uuid=getUid(data);avalon.Array.ensure(lists,list);list.$uuid=list.$uuid||generateID();if(!disposeQueue[uuid]){disposeQueue[uuid]=1;disposeQueue.push(data)}}function rejectDisposeQueue(data){var i=disposeQueue.length;var n=i;var allTypes=[];var iffishTypes={};var newInfo={};while(data=disposeQueue[--i]){var type=data.type;if(newInfo[type]){newInfo[type]++}else{newInfo[type]=1;allTypes.push(type)}}var diff=false;allTypes.forEach(function(type){if(oldInfo[type]!==newInfo[type]){iffishTypes[type]=1;diff=true}});i=n;if(diff){while(data=disposeQueue[--i]){if(data.element===null){disposeQueue.splice(i,1);continue}if(iffishTypes[data.type]&&shouldDispose(data.element)){disposeQueue.splice(i,1);delete disposeQueue[data.uniqueNumber];var lists=data.lists;for(var k=0,list;list=lists[k++];){avalon.Array.remove(lists,list);avalon.Array.remove(list,data)
    }disposeData(data)}}}oldInfo=newInfo;beginTime=new Date()}function disposeData(data){delete disposeQueue[data.uniqueNumber];data.element=null;data.rollback&&data.rollback();for(var key in data){data[key]=null}}function shouldDispose(el){try{var fireError=el.parentNode.nodeType}catch(e){return true}if(el.ifRemove){if(!root.contains(el.ifRemove)&&(ifGroup===el.parentNode)){el.parentNode&&el.parentNode.removeChild(el);return true}}return el.msRetain?0:(el.nodeType===1?!root.contains(el):!avalon.contains(root,el))}var tagHooks=new function(){avalon.mix(this,{option:DOC.createElement("select"),thead:DOC.createElement("table"),td:DOC.createElement("tr"),area:DOC.createElement("map"),tr:DOC.createElement("tbody"),col:DOC.createElement("colgroup"),legend:DOC.createElement("fieldset"),_default:DOC.createElement("div"),"g":DOC.createElementNS("http://www.w3.org/2000/svg","svg")});this.optgroup=this.option;this.tbody=this.tfoot=this.colgroup=this.caption=this.thead;this.th=this.td};String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(tag){tagHooks[tag]=tagHooks.g});var rtagName=/<([\w:]+)/;var rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig;var scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]);var script=DOC.createElement("script");var rhtml=/<|&#?\w+;/;avalon.parseHTML=function(html){var fragment=avalonFragment.cloneNode(false);if(typeof html!=="string"){return fragment}if(!rhtml.test(html)){fragment.appendChild(DOC.createTextNode(html));return fragment}html=html.replace(rxhtml,"<$1></$2>").trim();var tag=(rtagName.exec(html)||["",""])[1].toLowerCase(),wrapper=tagHooks[tag]||tagHooks._default,firstChild;wrapper.innerHTML=html;var els=wrapper.getElementsByTagName("script");if(els.length){for(var i=0,el;el=els[i++];){if(scriptTypes[el.type]){var neo=script.cloneNode(false);ap.forEach.call(el.attributes,function(attr){neo.setAttribute(attr.name,attr.value)});neo.text=el.text;el.parentNode.replaceChild(neo,el)}}}while(firstChild=wrapper.firstChild){fragment.appendChild(firstChild)}return fragment};avalon.innerHTML=function(node,html){var a=this.parseHTML(html);this.clearHTML(node).appendChild(a)};avalon.clearHTML=function(node){node.textContent="";while(node.firstChild){node.removeChild(node.firstChild)}return node};function hyphen(target){return target.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(target){if(target.indexOf("-")<0&&target.indexOf("_")<0){return target}return target.replace(/[-_][^-_]/g,function(match){return match.charAt(1).toUpperCase()})}"add,remove".replace(rword,function(method){avalon.fn[method+"Class"]=function(cls){var el=this[0];if(cls&&typeof cls==="string"&&el&&el.nodeType===1){cls.replace(/\S+/g,function(c){el.classList[method](c)})}return this}});avalon.fn.mix({hasClass:function(cls){var el=this[0]||{};return el.nodeType===1&&el.classList.contains(cls)},toggleClass:function(value,stateVal){var className,i=0;var classNames=String(value).split(/\s+/);var isBool=typeof stateVal==="boolean";while((className=classNames[i++])){var state=isBool?stateVal:!this.hasClass(className);this[state?"addClass":"removeClass"](className)}return this},attr:function(name,value){if(arguments.length===2){this[0].setAttribute(name,value);return this}else{return this[0].getAttribute(name)}},data:function(name,value){name="data-"+hyphen(name||"");switch(arguments.length){case 2:this.attr(name,value);return this;case 1:var val=this.attr(name);return parseData(val);case 0:var ret={};ap.forEach.call(this[0].attributes,function(attr){if(attr){name=attr.name;if(!name.indexOf("data-")){name=camelize(name.slice(5));ret[name]=parseData(attr.value)}}});return ret}},removeData:function(name){name="data-"+hyphen(name);this[0].removeAttribute(name);return this},css:function(name,value){if(avalon.isPlainObject(name)){for(var i in name){avalon.css(this,i,name[i])}}else{var ret=avalon.css(this,name,value)}return ret!==void 0?ret:this},position:function(){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(!elem){return}if(this.css("position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(offsetParent[0].tagName!=="HTML"){parentOffset=offsetParent.offset()}parentOffset.top+=avalon.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=avalon.css(offsetParent[0],"borderLeftWidth",true);parentOffset.top-=offsetParent.scrollTop();parentOffset.left-=offsetParent.scrollLeft()}return{top:offset.top-parentOffset.top-avalon.css(elem,"marginTop",true),left:offset.left-parentOffset.left-avalon.css(elem,"marginLeft",true)}},offsetParent:function(){var offsetParent=this[0].offsetParent;while(offsetParent&&avalon.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}return avalon(offsetParent||root)},bind:function(type,fn,phase){if(this[0]){return avalon.bind(this[0],type,fn,phase)
    }},unbind:function(type,fn,phase){if(this[0]){avalon.unbind(this[0],type,fn,phase)}return this},val:function(value){var node=this[0];if(node&&node.nodeType===1){var get=arguments.length===0;var access=get?":get":":set";var fn=valHooks[getValType(node)+access];if(fn){var val=fn(node,value)}else{if(get){return(node.value||"").replace(/\r/g,"")}else{node.value=value}}}return get?val:this}});if(root.dataset){avalon.fn.data=function(name,val){name=name&&camelize(name);var dataset=this[0].dataset;switch(arguments.length){case 2:dataset[name]=val;return this;case 1:val=dataset[name];return parseData(val);case 0:var ret=createMap();for(name in dataset){ret[name]=parseData(dataset[name])}return ret}}}var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;avalon.parseJSON=JSON.parse;function parseData(data){try{if(typeof data==="object"){return data}data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}return data}avalon.fireDom=function(elem,type,opts){var hackEvent=DOC.createEvent("Events");hackEvent.initEvent(type,true,true);avalon.mix(hackEvent,opts);elem.dispatchEvent(hackEvent)};avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){avalon.fn[method]=function(val){var node=this[0]||{},win=getWindow(node),top=method==="scrollTop";if(!arguments.length){return win?win[prop]:node[method]}else{if(win){win.scrollTo(!top?val:win[prop],top?val:win[prop])}else{node[method]=val}}}});function getWindow(node){return node.window&&node.document?node:node.nodeType===9?node.defaultView:false}var cssHooks=avalon.cssHooks=createMap();var prefixes=["","-webkit-","-moz-","-ms-"];var cssMap={"float":"cssFloat"};avalon.cssNumber=oneObject("animationIterationCount,animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom");avalon.cssName=function(name,host,camelCase){if(cssMap[name]){return cssMap[name]}host=host||root.style;for(var i=0,n=prefixes.length;i<n;i++){camelCase=camelize(prefixes[i]+name);if(camelCase in host){return(cssMap[name]=camelCase)}}return null};cssHooks["@:set"]=function(node,name,value){node.style[name]=value};cssHooks["@:get"]=function(node,name){if(!node||!node.style){throw new Error("getComputedStyle要求传入一个节点 "+node)}var ret,computed=getComputedStyle(node);if(computed){ret=name==="filter"?computed.getPropertyValue(name):computed[name];if(ret===""){ret=node.style[name]}}return ret};cssHooks["opacity:get"]=function(node){var ret=cssHooks["@:get"](node,"opacity");return ret===""?"1":ret};"top,left".replace(rword,function(name){cssHooks[name+":get"]=function(node){var computed=cssHooks["@:get"](node,name);return/px$/.test(computed)?computed:avalon(node).position()[name]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"};var rdisplayswap=/^(none|table(?!-c[ea]).+)/;function showHidden(node,array){if(node.offsetWidth<=0){var styles=getComputedStyle(node,null);if(rdisplayswap.test(styles["display"])){var obj={node:node};for(var name in cssShow){obj[name]=styles[name];node.style[name]=cssShow[name]}array.push(obj)}var parent=node.parentNode;if(parent&&parent.nodeType===1){showHidden(parent,array)}}}"Width,Height".replace(rword,function(name){var method=name.toLowerCase(),clientProp="client"+name,scrollProp="scroll"+name,offsetProp="offset"+name;cssHooks[method+":get"]=function(node,which,override){var boxSizing=-4;if(typeof override==="number"){boxSizing=override}which=name==="Width"?["Left","Right"]:["Top","Bottom"];var ret=node[offsetProp];if(boxSizing===2){return ret+avalon.css(node,"margin"+which[0],true)+avalon.css(node,"margin"+which[1],true)}if(boxSizing<0){ret=ret-avalon.css(node,"border"+which[0]+"Width",true)-avalon.css(node,"border"+which[1]+"Width",true)}if(boxSizing===-4){ret=ret-avalon.css(node,"padding"+which[0],true)-avalon.css(node,"padding"+which[1],true)}return ret};cssHooks[method+"&get"]=function(node){var hidden=[];showHidden(node,hidden);var val=cssHooks[method+":get"](node);for(var i=0,obj;obj=hidden[i++];){node=obj.node;for(var n in obj){if(typeof obj[n]==="string"){node.style[n]=obj[n]}}}return val};avalon.fn[method]=function(value){var node=this[0];if(arguments.length===0){if(node.setTimeout){return node["inner"+name]}if(node.nodeType===9){var doc=node.documentElement;return Math.max(node.body[scrollProp],doc[scrollProp],node.body[offsetProp],doc[offsetProp],doc[clientProp])}return cssHooks[method+"&get"](node)}else{return this.css(method,value)}};avalon.fn["inner"+name]=function(){return cssHooks[method+":get"](this[0],void 0,-2)};avalon.fn["outer"+name]=function(includeMargin){return cssHooks[method+":get"](this[0],void 0,includeMargin===true?2:0)}});avalon.fn.offset=function(){var node=this[0];try{var rect=node.getBoundingClientRect();if(rect.width||rect.height||node.getClientRects().length){var doc=node.ownerDocument;var root=doc.documentElement;var win=doc.defaultView;return{top:rect.top+win.pageYOffset-root.clientTop,left:rect.left+win.pageXOffset-root.clientLeft}
    }}catch(e){return{left:0,top:0}}};function getValType(elem){var ret=elem.tagName.toLowerCase();return ret==="input"&&/checkbox|radio/.test(elem.type)?"checked":ret}var valHooks={"select:get":function(node,value){var option,options=node.options,index=node.selectedIndex,one=node.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&!option.disabled){value=option.value;if(one){return value}values.push(value)}}return values},"select:set":function(node,values,optionSet){values=[].concat(values);for(var i=0,el;el=node.options[i++];){if((el.selected=values.indexOf(el.value)>-1)){optionSet=true}}if(!optionSet){node.selectedIndex=-1}}};var keyMap={};var keys=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(",");keys.replace(/\w+/g,function(a){keyMap[a]=true});var ridentStart=/[a-z_$]/i;var rwhiteSpace=/[\s\uFEFF\xA0]/;function getIdent(input,lastIndex){var result=[];var subroutine=!!lastIndex;lastIndex=lastIndex||0;var state="unknown";var variable="";for(var i=0;i<input.length;i++){var c=input.charAt(i);if(c==="'"||c==='"'){if(state==="unknown"){state=c}else{if(state===c){state="unknown"}}}else{if(c==="\\"){if(state==="'"||state==='"'){i++}}else{if(ridentStart.test(c)){if(state==="unknown"){state="variable";variable=c}else{if(state==="maybePath"){variable=result.pop();variable+="."+c;state="variable"}else{if(state==="variable"){variable+=c}}}}else{if(/\w/.test(c)){if(state==="variable"){variable+=c}}else{if(c==="."){if(state==="variable"){if(variable){result.push(variable);variable="";state="maybePath"}}}else{if(c==="["){if(state==="variable"||state==="maybePath"){if(variable){result.push(variable);variable=""}var lastLength=result.length;var last=result[lastLength-1];var innerResult=getIdent(input.slice(i),i);if(innerResult.length){result[lastLength-1]=last+".*";result=innerResult.concat(result)}else{var content=input.slice(i+1,innerResult.i);try{var text=(scpCompile(["return "+content]))();result[lastLength-1]=last+"."+text}catch(e){}}state="maybePath";i=innerResult.i}}else{if(c==="]"){if(subroutine){result.i=i+lastIndex;addVar(result,variable);return result}}else{if(rwhiteSpace.test(c)&&c!=="\r"&&c!=="\n"){if(state==="variable"){if(addVar(result,variable)){state="maybePath"}variable=""}}else{addVar(result,variable);state="unknown";variable=""}}}}}}}}}addVar(result,variable);return result}function addVar(array,element){if(element&&!keyMap[element]){array.push(element);return true}}function addAssign(vars,vmodel,name,binding){var ret=[],prefix=" = "+name+".";for(var i=vars.length,prop;prop=vars[--i];){var arr=prop.split("."),a;var first=arr[0];while(a=arr.shift()){if(vmodel.hasOwnProperty(a)){ret.push(first+prefix+first);binding.observers.push({v:vmodel,p:prop});vars.splice(i,1)}}}return ret}var rproxy=/(\$proxy\$[a-z]+)\d+$/;var variablePool=new Cache(218);var evaluatorPool=new Cache(128);function getVars(expr){expr=expr.trim();var ret=variablePool.get(expr);if(ret){return ret.concat()}var array=getIdent(expr);var uniq={};var result=[];for(var i=0,el;el=array[i++];){if(!uniq[el]){uniq[el]=1;result.push(el)}}return variablePool.put(expr,result).concat()}function parseExpr(expr,vmodels,binding){var filters=binding.filters;if(typeof filters==="string"&&filters.trim()&&!binding._filters){binding._filters=parseFilter(filters.trim())}var vars=getVars(expr);var expose=new Date()-0;var assigns=[];var names=[];var args=[];binding.observers=[];for(var i=0,sn=vmodels.length;i<sn;i++){if(vars.length){var name="vm"+expose+"_"+i;names.push(name);args.push(vmodels[i]);assigns.push.apply(assigns,addAssign(vars,vmodels[i],name,binding))}}binding.args=args;var dataType=binding.type;var exprId=vmodels.map(function(el){return String(el.$id).replace(rproxy,"$1")})+expr+dataType;var getter=evaluatorPool.get(exprId);if(getter){if(dataType==="duplex"){var setter=evaluatorPool.get(exprId+"setter");binding.setter=setter.apply(setter,binding.args)}return binding.getter=getter}if(!assigns.length){assigns.push("fix"+expose)}if(dataType==="duplex"){var nameOne={};assigns.forEach(function(a){var arr=a.split("=");nameOne[arr[0].trim()]=arr[1].trim()});expr=expr.replace(/[\$\w]+/,function(a){return nameOne[a]?nameOne[a]:a});var fn2=scpCompile(names.concat("'use strict';"+"return function(vvv){"+expr+" = vvv\n}\n"));evaluatorPool.put(exprId+"setter",fn2);binding.setter=fn2.apply(fn2,binding.args)}if(dataType==="on"){if(expr.indexOf("(")===-1){expr+=".call(this, $event)"}else{expr=expr.replace("(",".call(this,")}names.push("$event");expr="\nreturn "+expr+";";
        var lastIndex=expr.lastIndexOf("\nreturn");var header=expr.slice(0,lastIndex);var footer=expr.slice(lastIndex);expr=header+"\n"+footer}else{expr="\nreturn "+expr+";"}getter=scpCompile(names.concat("'use strict';\nvar "+assigns.join(",\n")+expr));return evaluatorPool.put(exprId,getter)}function normalizeExpr(code){var hasExpr=rexpr.test(code);if(hasExpr){var array=scanExpr(code);if(array.length===1){return array[0].expr}return array.map(function(el){return el.type?"("+el.expr+")":quote(el.expr)}).join(" + ")}else{return code}}avalon.normalizeExpr=normalizeExpr;avalon.parseExprProxy=parseExpr;var rthimRightParentheses=/\)\s*$/;var rthimOtherParentheses=/\)\s*\|/g;var rquoteFilterName=/\|\s*([$\w]+)/g;var rpatchBracket=/"\s*\["/g;var rthimLeftParentheses=/"\s*\(/g;function parseFilter(filters){filters=filters.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(a,b){return"["+quote(b)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]";return scpCompile(["return ["+filters+"]"])()}var quote=JSON.stringify;avalon.scan=function(elem,vmodel){elem=elem||root;var vmodels=vmodel?[].concat(vmodel):[];scanTag(elem,vmodels)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase());function checkScan(elem,callback,innerHTML){var id=setTimeout(function(){var currHTML=elem.innerHTML;clearTimeout(id);if(currHTML===innerHTML){callback()}else{checkScan(elem,callback,currHTML)}})}function createSignalTower(elem,vmodel){var id=elem.getAttribute("avalonctrl")||vmodel.$id;elem.setAttribute("avalonctrl",id);if(vmodel.$events){vmodel.$events.expr=elem.tagName+'[avalonctrl="'+id+'"]'}}var getBindingCallback=function(elem,name,vmodels){var callback=elem.getAttribute(name);if(callback){for(var i=0,vm;vm=vmodels[i++];){if(vm.hasOwnProperty(callback)&&typeof vm[callback]==="function"){return vm[callback]}}}};function executeBindings(bindings,vmodels){for(var i=0,binding;binding=bindings[i++];){binding.vmodels=vmodels;directives[binding.type].init(binding);avalon.injectBinding(binding);if(binding.getter&&binding.element.nodeType===1){binding.element.removeAttribute(binding.name)}}bindings.length=0}var mergeTextNodes=IEVersion&&window.MutationObserver?function(elem){var node=elem.firstChild,text;while(node){var aaa=node.nextSibling;if(node.nodeType===3){if(text){text.nodeValue+=node.nodeValue;elem.removeChild(node)}else{text=node}}else{text=null}node=aaa}}:0;var roneTime=/^\s*::/;var rmsAttr=/ms-(\w+)-?(.*)/;var events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit");var obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled,href,src");function bindingSorter(a,b){return a.priority-b.priority}var rnoCollect=/^(ms-\S+|data-\S+|on[a-z]+|id|style|class)$/;var ronattr=/^on\-[\w-]+$/;function getOptionsFromTag(elem,vmodels){var attributes=elem.attributes;var ret={};for(var i=0,attr;attr=attributes[i++];){var name=attr.name;if(attr.specified&&!rnoCollect.test(name)){var camelizeName=camelize(attr.name);if(/^on\-[\w-]+$/.test(name)){ret[camelizeName]=getBindingCallback(elem,name,vmodels)}else{ret[camelizeName]=parseData(attr.value)}}}return ret}function scanAttr(elem,vmodels,match){var scanNode=true;if(vmodels.length){var attributes=elem.attributes;var bindings=[];var uniq={};for(var i=0,attr;attr=attributes[i++];){var name=attr.name;if(uniq[name]){continue}uniq[name]=1;if(attr.specified){if(match=name.match(rmsAttr)){var type=match[1];var param=match[2]||"";var value=attr.value;if(events[type]){param=type;type="on"}else{if(obsoleteAttrs[type]){param=type;type="attr";name="ms-"+type+"-"+param;log("warning!请改用"+name+"代替"+attr.name+"!")}}if(directives[type]){var newValue=value.replace(roneTime,"");var oneTime=value!==newValue;var binding={type:type,param:param,element:elem,name:name,expr:newValue,oneTime:oneTime,priority:(directives[type].priority||type.charCodeAt(0)*10)+(Number(param.replace(/\D/g,""))||0)};if(type==="html"||type==="text"){var filters=getToken(value).filters;binding.expr=binding.expr.replace(filters,"");binding.filters=filters.replace(rhasHtml,function(){binding.type="html";binding.group=1;return""}).trim()}else{if(type==="duplex"){var hasDuplex=name}else{if(name==="ms-if-loop"){binding.priority+=100}else{if(name==="ms-attr-value"){var hasAttrValue=name}}}}bindings.push(binding)}}}}if(bindings.length){bindings.sort(bindingSorter);if(hasDuplex&&hasAttrValue&&elem.type==="text"){log("warning!一个控件不能同时定义ms-attr-value与"+hasDuplex)}for(i=0;binding=bindings[i];i++){type=binding.type;if(rnoscanAttrBinding.test(type)){return executeBindings(bindings.slice(0,i+1),vmodels)}else{if(scanNode){scanNode=!rnoscanNodeBinding.test(type)}}}executeBindings(bindings,vmodels)}}if(scanNode&&!stopScan[elem.tagName]){mergeTextNodes&&mergeTextNodes(elem);
        scanNodeList(elem,vmodels)}}var rnoscanAttrBinding=/^if|widget|repeat$/;var rnoscanNodeBinding=/^each|with|html|include$/;function scanNodeList(parent,vmodels){var nodes=avalon.slice(parent.childNodes);scanNodeArray(nodes,vmodels)}function scanNodeArray(nodes,vmodels){for(var i=0,node;node=nodes[i++];){switch(node.nodeType){case 1:var elem=node;if(!elem.msResolved&&elem.parentNode&&elem.parentNode.nodeType===1){var library=isWidget(elem);if(library){var widget=elem.localName?elem.localName.replace(library+":",""):elem.nodeName;var fullName=library+":"+camelize(widget);componentQueue.push({library:library,element:elem,fullName:fullName,widget:widget,vmodels:vmodels,name:"widget"});if(avalon.components[fullName]){(function(name){setTimeout(function(){avalon.component(name)})})(fullName)}}}scanTag(node,vmodels);if(node.msHasEvent){avalon.fireDom(node,"datasetchanged",{bubble:node.msHasEvent})}break;case 3:if(rexpr.test(node.nodeValue)){scanText(node,vmodels,i)}break}}}function scanTag(elem,vmodels,node){var a=elem.getAttribute("ms-skip");var b=elem.getAttributeNode("ms-important");var c=elem.getAttributeNode("ms-controller");if(typeof a==="string"){return}else{if(node=b||c){var newVmodel=avalon.vmodels[node.value];if(!newVmodel){return}vmodels=node===b?[newVmodel]:[newVmodel].concat(vmodels);elem.removeAttribute(node.name);elem.classList.remove(node.name);createSignalTower(elem,newVmodel)}}scanAttr(elem,vmodels)}var rhasHtml=/\|\s*html(?:\b|$)/,r11a=/\|\|/g,rlt=/&lt;/g,rgt=/&gt;/g,rstringLiteral=/(['"])(\\\1|.)+?\1/g;function getToken(value){if(value.indexOf("|")>0){var scapegoat=value.replace(rstringLiteral,function(_){return Array(_.length+1).join("1")});var index=scapegoat.replace(r11a,"\u1122\u3344").indexOf("|");if(index>-1){return{type:"text",filters:value.slice(index).trim(),expr:value.slice(0,index)}}}return{type:"text",expr:value,filters:""}}function scanExpr(str){var tokens=[],value,start=0,stop;do{stop=str.indexOf(openTag,start);if(stop===-1){break}value=str.slice(start,stop);if(value){tokens.push({expr:value})}start=stop+openTag.length;stop=str.indexOf(closeTag,start);if(stop===-1){break}value=str.slice(start,stop);if(value){tokens.push(getToken(value,start))}start=stop+closeTag.length}while(1);value=str.slice(start);if(value){tokens.push({expr:value})}return tokens}function scanText(textNode,vmodels,index){var bindings=[],tokens=scanExpr(textNode.data);if(tokens.length){for(var i=0,token;token=tokens[i++];){var node=DOC.createTextNode(token.expr);if(token.type){token.expr=token.expr.replace(roneTime,function(){token.oneTime=true;return""});token.element=node;token.filters=token.filters.replace(rhasHtml,function(){token.type="html";return""});token.pos=index*1000+i;bindings.push(token)}avalonFragment.appendChild(node)}textNode.parentNode.replaceChild(avalonFragment,textNode);if(bindings.length){executeBindings(bindings,vmodels)}}}var Buffer=function(){this.queue=[]};Buffer.prototype={render:function(isAnimate){if(!this.locked){this.locked=isAnimate?root.offsetHeight+10:1;var me=this;avalon.nextTick(function(){me.flush()})}},flush:function(){for(var i=0,sub;sub=this.queue[i++];){sub.update&&sub.update()}this.locked=0;this.queue=[]}};var buffer=new Buffer();var componentQueue=[];var widgetList=[];var componentHooks={$construct:function(){return avalon.mix.apply(null,arguments)},$ready:noop,$init:noop,$dispose:noop,$container:null,$childReady:noop,$replace:false,$extend:null,$$template:function(str){return str}};avalon.components={};avalon.component=function(name,opts){if(opts){avalon.components[name]=avalon.mix({},componentHooks,opts)}for(var i=0,obj;obj=componentQueue[i];i++){if(name===obj.fullName){componentQueue.splice(i,1);i--;(function(host,hooks,elem,widget){if(!avalon.contains(DOC,elem)){avalon.Array.remove(componentQueue,host);return}var dependencies=1;var library=host.library;var global=avalon.libraries[library]||componentHooks;if(elem.getAttribute("ms-attr-identifier")){return}var elemOpts=getOptionsFromTag(elem,host.vmodels);var vmOpts=getOptionsFromVM(host.vmodels,elemOpts.config||host.widget);var $id=elemOpts.$id||elemOpts.identifier||generateID(widget);delete elemOpts.config;delete elemOpts.$id;delete elemOpts.identifier;var componentDefinition={};var parentHooks=avalon.components[hooks.$extend];if(parentHooks){avalon.mix(true,componentDefinition,parentHooks);componentDefinition=parentHooks.$construct.call(elem,componentDefinition,{},{})}else{avalon.mix(true,componentDefinition,hooks)}componentDefinition=avalon.components[name].$construct.call(elem,componentDefinition,vmOpts,elemOpts);componentDefinition.$refs={};componentDefinition.$id=$id;var keepSlot=componentDefinition.$slot;var keepReplace=componentDefinition.$replace;var keepContainer=componentDefinition.$container;var keepTemplate=componentDefinition.$template;delete componentDefinition.$slot;delete componentDefinition.$replace;delete componentDefinition.$container;delete componentDefinition.$construct;var vmodel=avalon.define(componentDefinition)||{};
        elem.msResolved=1;vmodel.$init(vmodel,elem);global.$init(vmodel,elem);var nodes=elem.childNodes;var slots={},snode;for(var s=0,el;el=nodes[s++];){var type=el.nodeType===1&&el.getAttribute("slot")||keepSlot;if(type){if(slots[type]){slots[type].push(el)}else{slots[type]=[el]}}}if(vmodel.$$template){avalon.clearHTML(elem);elem.innerHTML=vmodel.$$template(keepTemplate)}for(s in slots){if(vmodel.hasOwnProperty(s)){var ss=slots[s];if(ss.length){var fragment=avalonFragment.cloneNode(true);for(var ns=0;snode=ss[ns++];){fragment.appendChild(snode)}vmodel[s]=fragment}slots[s]=null}}slots=null;var child=elem.children[0]||elem.firstChild;if(keepReplace){elem.parentNode.replaceChild(child,elem);child.msResolved=1;var cssText=elem.style.cssText;var className=elem.className;elem=host.element=child;elem.style.cssText=cssText;if(className){avalon(elem).addClass(className)}}if(keepContainer){keepContainer.appendChild(elem)}avalon.fireDom(elem,"datasetchanged",{library:library,vm:vmodel,childReady:1});var children=0;var removeFn=avalon.bind(elem,"datasetchanged",function(e){if(e.childReady&&e.library===library){dependencies+=e.childReady;if(vmodel!==e.vm){vmodel.$refs[e.vm.$id]=e.vm;if(e.childReady===-1){children++;vmodel.$childReady(vmodel,elem,e)}e.stopPropagation()}}if(dependencies===0){var id1=setTimeout(function(){clearTimeout(id1);vmodel.$ready(vmodel,elem,host.vmodels);global.$ready(vmodel,elem,host.vmodels)},children?Math.max(children*17,100):17);avalon.unbind(elem,"datasetchanged",removeFn);host.rollback=function(){try{vmodel.$dispose(vmodel,elem);global.$dispose(vmodel,elem)}catch(e){}delete avalon.vmodels[vmodel.$id]};injectDisposeQueue(host,widgetList);if(window.chrome){elem.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(rejectDisposeQueue)})}}});scanTag(elem,[vmodel].concat(host.vmodels));avalon.vmodels[vmodel.$id]=vmodel;if(!elem.childNodes.length){avalon.fireDom(elem,"datasetchanged",{library:library,vm:vmodel,childReady:-1})}else{var id2=setTimeout(function(){clearTimeout(id2);avalon.fireDom(elem,"datasetchanged",{library:library,vm:vmodel,childReady:-1})},17)}})(obj,avalon.components[name],obj.element,obj.widget)}}};function getOptionsFromVM(vmodels,pre){if(pre){for(var i=0,v;v=vmodels[i++];){if(v.hasOwnProperty(pre)&&typeof v[pre]==="object"){var vmOptions=v[pre];return vmOptions.$model||vmOptions;break}}}return{}}avalon.libraries=[];avalon.library=function(name,opts){if(DOC.namespaces){DOC.namespaces.add(name,"http://www.w3.org/1999/xhtml")}avalon.libraries[name]=avalon.mix({$init:noop,$ready:noop,$dispose:noop},opts||{})};avalon.library("ms");function isWidget(el){if(el.scopeName&&el.scopeName!=="HTML"){return el.scopeName}var fullName=el.nodeName.toLowerCase();var index=fullName.indexOf(":");if(index>0){return fullName.slice(0,index)}}var bools=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(",");var boolMap={};bools.replace(rword,function(name){boolMap[name.toLowerCase()]=name});var propMap={"accept-charset":"acceptCharset","char":"ch","charoff":"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"};var anomaly=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");anomaly.replace(rword,function(name){propMap[name.toLowerCase()]=name});var attrDir=avalon.directive("attr",{init:function(binding){binding.expr=normalizeExpr(binding.expr.trim());if(binding.type==="include"){var elem=binding.element;effectBinding(elem,binding);binding.includeRendered=getBindingCallback(elem,"data-include-rendered",binding.vmodels);binding.includeLoaded=getBindingCallback(elem,"data-include-loaded",binding.vmodels);var outer=binding.includeReplace=!!avalon(elem).data("includeReplace");if(avalon(elem).data("includeCache")){binding.templateCache={}}binding.start=DOC.createComment("ms-include");binding.end=DOC.createComment("ms-include-end");if(outer){binding.element=binding.end;binding._element=elem;elem.parentNode.insertBefore(binding.start,elem);elem.parentNode.insertBefore(binding.end,elem.nextSibling)}else{elem.insertBefore(binding.start,elem.firstChild);elem.appendChild(binding.end)}}},update:function(val){var elem=this.element;var attrName=this.param;if(attrName==="href"||attrName==="src"){if(typeof val==="string"&&!root.hasAttribute){val=val.replace(/&amp;/g,"&")}elem[attrName]=val;if(window.chrome&&elem.tagName==="EMBED"){var parent=elem.parentNode;var comment=document.createComment("ms-src");parent.replaceChild(comment,elem);parent.replaceChild(elem,comment)}}else{var toRemove=(val===false)||(val===null)||(val===void 0);if(!W3C&&propMap[attrName]){attrName=propMap[attrName]}var bool=boolMap[attrName];if(typeof elem[bool]==="boolean"){elem[bool]=!!val;if(!val){toRemove=true
    }}if(toRemove){return elem.removeAttribute(attrName)}var isInnate=rsvg.test(elem)?false:(DOC.namespaces&&isVML(elem))?true:attrName in elem.cloneNode(false);if(isInnate){elem[attrName]=val+""}else{elem.setAttribute(attrName,val)}}}});"title,alt,src,value,css,include,href".replace(rword,function(name){directives[name]=attrDir});avalon.directive("class",{init:function(binding){var oldStyle=binding.param;var method=binding.type;if(!oldStyle||isFinite(oldStyle)){binding.param="";directives.effect.init(binding)}else{log("ms-"+method+'-xxx="yyy"这种用法已经过时,请使用ms-'+method+'="xxx:yyy"');binding.expr="["+quote(oldStyle)+","+binding.expr+"]";binding.oldStyle=oldStyle}if(method==="hover"||method==="active"){if(!binding.hasBindEvent){var elem=binding.element;var $elem=avalon(elem);var activate="mouseenter";var abandon="mouseleave";if(method==="active"){elem.tabIndex=elem.tabIndex||-1;activate="mousedown";abandon="mouseup";var fn0=$elem.bind("mouseleave",function(){binding.toggleClass&&$elem.removeClass(binding.newClass)})}}var fn1=$elem.bind(activate,function(){binding.toggleClass&&$elem.addClass(binding.newClass)});var fn2=$elem.bind(abandon,function(){binding.toggleClass&&$elem.removeClass(binding.newClass)});binding.rollback=function(){$elem.unbind("mouseleave",fn0);$elem.unbind(activate,fn1);$elem.unbind(abandon,fn2)};binding.hasBindEvent=true}},update:function(arr){var binding=this;var $elem=avalon(this.element);binding.newClass=arr[0];binding.toggleClass=!!arr[1];if(binding.oldClass&&binding.newClass!==binding.oldClass){$elem.removeClass(binding.oldClass)}binding.oldClass=binding.newClass;if(binding.type==="class"){if(binding.oldStyle){$elem.toggleClass(binding.oldStyle,!!arr[1])}else{$elem.toggleClass(binding.newClass,binding.toggleClass)}}}});"hover,active".replace(rword,function(name){directives[name]=directives["class"]});avalon.directive("css",{init:directives.attr.init,update:function(val){avalon(this.element).css(this.param,val)}});avalon.directive("data",{priority:100,update:function(val){var elem=this.element;var key="data-"+this.param;if(val&&typeof val==="object"){elem[key]=val}else{elem.setAttribute(key,String(val))}}});var rduplexType=/^(?:checkbox|radio)$/;var rduplexParam=/^(?:radio|checked)$/;var rnoduplexInput=/^(file|button|reset|submit|checkbox|radio|range)$/;var duplexBinding=avalon.directive("duplex",{priority:2000,init:function(binding,hasCast){var elem=binding.element;var vmodels=binding.vmodels;binding.changed=getBindingCallback(elem,"data-duplex-changed",vmodels)||noop;var params=[];var casting=oneObject("string,number,boolean,checked");if(elem.type==="radio"&&binding.param===""){binding.param="checked"}binding.param.replace(rw20g,function(name){if(rduplexType.test(elem.type)&&rduplexParam.test(name)){if(name==="radio"){log("ms-duplex-radio已经更名为ms-duplex-checked")}name="checked";binding.isChecked=true;binding.xtype="radio"}if(name==="bool"){name="boolean";log("ms-duplex-bool已经更名为ms-duplex-boolean")}else{if(name==="text"){name="string";log("ms-duplex-text已经更名为ms-duplex-string")}}if(casting[name]){hasCast=true}avalon.Array.ensure(params,name)});if(!hasCast){params.push("string")}binding.param=params.join("-");if(!binding.xtype){binding.xtype=elem.tagName==="SELECT"?"select":elem.type==="checkbox"?"checkbox":elem.type==="radio"?"radio":/^change/.test(elem.getAttribute("data-duplex-event"))?"change":"input"}binding.bound=function(type,callback){elem.addEventListener(type,callback,false);var old=binding.rollback;binding.rollback=function(){elem.avalonSetter=null;avalon.unbind(elem,type,callback);old&&old()}};var composing=false;function callback(value){binding.changed.call(this,value,binding)}function compositionStart(){composing=true}function compositionEnd(){composing=false}var updateVModel=function(e){var val=elem.value;if(composing||val===binding.oldValue||binding.pipe===null){return}var lastValue=binding.pipe(val,binding,"get");binding.setter(lastValue);callback.call(elem,lastValue)};switch(binding.xtype){case"radio":binding.bound("click",function(){var lastValue=binding.pipe(elem.value,binding,"get");binding.setter(lastValue);callback.call(elem,lastValue)});break;case"checkbox":binding.bound("change",function(){var method=elem.checked?"ensure":"remove";var array=binding.getter.apply(0,binding.vmodels);if(!Array.isArray(array)){log("ms-duplex应用于checkbox上要对应一个数组");array=[array]}var val=binding.pipe(elem.value,binding,"get");avalon.Array[method](array,val);callback.call(elem,array)});break;case"change":binding.bound("change",updateVModel);break;case"input":if(!IEVersion){binding.bound("input",updateVModel);binding.bound("compositionstart",compositionStart);binding.bound("compositionend",compositionEnd);binding.bound("DOMAutoComplete",updateVModel)}else{binding.bound("input",updateVModel)}break;case"select":binding.bound("change",function(){var val=avalon(elem).val();if(Array.isArray(val)){val=val.map(function(v){return binding.pipe(v,binding,"get")})}else{val=binding.pipe(val,binding,"get")}if(val+""!==binding.oldValue){try{binding.setter(val)
    }catch(ex){log(ex)}}});binding.bound("datasetchanged",function(e){if(e.bubble==="selectDuplex"){var value=binding._value;var curValue=Array.isArray(value)?value.map(String):value+"";avalon(elem).val(curValue);elem.oldValue=curValue+"";callback.call(elem,curValue)}});break}if(binding.xtype==="input"&&!rnoduplexInput.test(elem.type)){if(elem.type!=="hidden"){var beforeFocus;binding.bound("focus",function(){elem.msFocus=true;beforeFocus=elem.value});binding.bound("blur",function(){elem.msFocus=false;if(IEVersion&&beforeFocus!==elem.value){elem.value=beforeFocus;avalon.fireDom(elem,"change")}})}elem.avalonSetter=updateVModel;watchValueInTimer(function(){if(root.contains(elem)){if(!elem.msFocus&&binding.oldValue!==elem.value){updateVModel()}}else{if(!elem.msRetain){return false}}})}},update:function(value){var elem=this.element,binding=this,curValue;if(!this.init){for(var i in avalon.vmodels){var v=avalon.vmodels[i];v.$fire("avalon-ms-duplex-init",binding)}var cpipe=binding.pipe||(binding.pipe=pipe);cpipe(null,binding,"init");this.init=1}switch(this.xtype){case"input":case"change":curValue=this.pipe(value,this,"set");if(curValue!==this.oldValue){var fixCaret=false;if(elem.msFocus){try{var start=elem.selectionStart;var end=elem.selectionEnd;if(start===end){var pos=start;fixCaret=true}}catch(e){}}elem.value=this.oldValue=curValue;if(fixCaret){elem.selectionStart=elem.selectionEnd=pos}}break;case"radio":curValue=binding.isChecked?!!value:value+""===elem.value;elem.checked=curValue;break;case"checkbox":var array=[].concat(value);curValue=this.pipe(elem.value,this,"get");elem.checked=array.indexOf(curValue)>-1;break;case"select":binding._value=value;if(!elem.msHasEvent){elem.msHasEvent="selectDuplex"}else{avalon.fireDom(elem,"datasetchanged",{bubble:elem.msHasEvent})}break}}});function fixNull(val){return val==null?"":val}avalon.duplexHooks={checked:{get:function(val,binding){return !binding.oldValue}},string:{get:function(val){return val},set:fixNull},"boolean":{get:function(val){return val==="true"},set:fixNull},number:{get:function(val,binding){var number=parseFloat(val);if(-val===-number){return number}var arr=/strong|medium|weak/.exec(binding.element.getAttribute("data-duplex-number"))||["medium"];switch(arr[0]){case"strong":return 0;case"medium":return val===""?"":0;case"weak":return val}},set:fixNull}};function pipe(val,binding,action,e){binding.param.replace(rw20g,function(name){var hook=avalon.duplexHooks[name];if(hook&&typeof hook[action]==="function"){val=hook[action](val,binding)}});return val}var TimerID,ribbon=[];avalon.tick=function(fn){if(ribbon.push(fn)===1){TimerID=setInterval(ticker,60)}};function ticker(){for(var n=ribbon.length-1;n>=0;n--){var el=ribbon[n];if(el()===false){ribbon.splice(n,1)}}if(!ribbon.length){clearInterval(TimerID)}}var watchValueInTimer=noop;new function(){try{var setters={};var aproto=HTMLInputElement.prototype;var bproto=HTMLTextAreaElement.prototype;function newSetter(value){setters[this.tagName].call(this,value);if(!this.msFocus&&this.avalonSetter){this.avalonSetter()}}var inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto);setters["INPUT"]=Object.getOwnPropertyDescriptor(aproto,"value").set;Object.defineProperty(aproto,"value",{set:newSetter});setters["TEXTAREA"]=Object.getOwnPropertyDescriptor(bproto,"value").set;Object.defineProperty(bproto,"value",{set:newSetter})}catch(e){watchValueInTimer=avalon.tick}};avalon.directive("effect",{priority:5,init:function(binding){var text=binding.expr,className,rightExpr;var colonIndex=text.replace(rexprg,function(a){return a.replace(/./g,"0")}).indexOf(":");if(colonIndex===-1){className=text;rightExpr=true}else{className=text.slice(0,colonIndex);rightExpr=text.slice(colonIndex+1)}if(!rexpr.test(text)){className=quote(className)}else{className=normalizeExpr(className)}binding.expr="["+className+","+rightExpr+"]"},update:function(arr){var name=arr[0];var elem=this.element;if(elem.getAttribute("data-effect-name")===name){return}else{elem.removeAttribute("data-effect-driver")}var inlineStyles=elem.style;var computedStyles=window.getComputedStyle?window.getComputedStyle(elem):null;var useAni=false;if(computedStyles&&(supportTransition||supportAnimation)){var duration=inlineStyles[transitionDuration]||computedStyles[transitionDuration];if(duration&&duration!=="0s"){elem.setAttribute("data-effect-driver","t");useAni=true}if(!useAni){duration=inlineStyles[animationDuration]||computedStyles[animationDuration];if(duration&&duration!=="0s"){elem.setAttribute("data-effect-driver","a");useAni=true}}}if(!useAni){if(avalon.effects[name]){elem.setAttribute("data-effect-driver","j");useAni=true}}if(useAni){elem.setAttribute("data-effect-name",name)}}});avalon.effects={};avalon.effect=function(name,callbacks){avalon.effects[name]=callbacks};var supportTransition=false;var supportAnimation=false;var transitionEndEvent;var animationEndEvent;var transitionDuration=avalon.cssName("transition-duration");var animationDuration=avalon.cssName("animation-duration");
    new function(){var checker={"TransitionEvent":"transitionend","WebKitTransitionEvent":"webkitTransitionEnd","OTransitionEvent":"oTransitionEnd","otransitionEvent":"otransitionEnd"};var tran;for(var name in checker){if(window[name]){tran=checker[name];break}try{var a=document.createEvent(name);tran=checker[name];break}catch(e){}}if(typeof tran==="string"){supportTransition=true;transitionEndEvent=tran}checker={"AnimationEvent":"animationend","WebKitAnimationEvent":"webkitAnimationEnd"};var ani;for(name in checker){if(window[name]){ani=checker[name];break}}if(typeof ani==="string"){supportTransition=true;animationEndEvent=ani}}();var effectPool=[];function effectFactory(el,opts){if(!el||el.nodeType!==1){return null}if(opts){var name=opts.effectName;var driver=opts.effectDriver}else{name=el.getAttribute("data-effect-name");driver=el.getAttribute("data-effect-driver")}if(!name||!driver){return null}var instance=effectPool.pop()||new Effect();instance.el=el;instance.driver=driver;instance.useCss=driver!=="j";if(instance.useCss){opts&&avalon(el).addClass(opts.effectClass);instance.cssEvent=driver==="t"?transitionEndEvent:animationEndEvent}instance.name=name;instance.callbacks=avalon.effects[name]||{};return instance}function effectBinding(elem,binding){var name=elem.getAttribute("data-effect-name");if(name){binding.effectName=name;binding.effectDriver=elem.getAttribute("data-effect-driver");var stagger=+elem.getAttribute("data-effect-stagger");binding.effectLeaveStagger=+elem.getAttribute("data-effect-leave-stagger")||stagger;binding.effectEnterStagger=+elem.getAttribute("data-effect-enter-stagger")||stagger;binding.effectClass=elem.className||NaN}}function upperFirstChar(str){return str.replace(/^[\S]/g,function(m){return m.toUpperCase()})}var effectBuffer=new Buffer();function Effect(){}Effect.prototype={contrustor:Effect,enterClass:function(){return getEffectClass(this,"enter")},leaveClass:function(){return getEffectClass(this,"leave")},actionFun:function(name,before,after){if(document.hidden){return}var me=this;var el=me.el;var isLeave=name==="leave";name=isLeave?"leave":"enter";var oppositeName=isLeave?"enter":"leave";callEffectHook(me,"abort"+upperFirstChar(oppositeName));callEffectHook(me,"before"+upperFirstChar(name));if(!isLeave){before(el)}var cssCallback=function(cancel){el.removeEventListener(me.cssEvent,me.cssCallback);if(isLeave){before(el);avalon(el).removeClass(me.cssClass)}else{if(me.driver==="a"){avalon(el).removeClass(me.cssClass)}}if(cancel!==true){callEffectHook(me,"after"+upperFirstChar(name));after&&after(el)}me.dispose()};if(me.useCss){if(me.cssCallback){me.cssCallback(true)}me.cssClass=getEffectClass(me,name);me.cssCallback=cssCallback;me.update=function(){el.addEventListener(me.cssEvent,me.cssCallback);if(!isLeave&&me.driver==="t"){avalon(el).removeClass(me.cssClass)}};avalon(el).addClass(me.cssClass);effectBuffer.render(true);effectBuffer.queue.push(me)}else{callEffectHook(me,name,cssCallback)}},enter:function(before,after){this.actionFun.apply(this,["enter"].concat(avalon.slice(arguments)))},leave:function(before,after){this.actionFun.apply(this,["leave"].concat(avalon.slice(arguments)))},dispose:function(){this.update=this.cssCallback=null;if(effectPool.unshift(this)>100){effectPool.pop()}}};function getEffectClass(instance,type){var a=instance.callbacks[type+"Class"];if(typeof a==="string"){return a}if(typeof a==="function"){return a()}return instance.name+"-"+type}function callEffectHook(effect,name,cb){var hook=effect.callbacks[name];if(hook){hook.call(effect,effect.el,cb)}}var applyEffect=function(el,dir){var args=aslice.call(arguments,0);if(typeof args[2]!=="function"){args.splice(2,0,noop)}if(typeof args[3]!=="function"){args.splice(3,0,noop)}var before=args[2];var after=args[3];var opts=args[4];var effect=effectFactory(el,opts);if(!effect){before();after();return false}else{var method=dir?"enter":"leave";effect[method](before,after)}};avalon.mix(avalon.effect,{apply:applyEffect,append:function(el,parent,after,opts){return applyEffect(el,1,function(){parent.appendChild(el)},after,opts)},before:function(el,target,after,opts){return applyEffect(el,1,function(){target.parentNode.insertBefore(el,target)},after,opts)},remove:function(el,parent,after,opts){return applyEffect(el,0,function(){if(el.parentNode===parent){parent.removeChild(el)}},after,opts)}});avalon.directive("html",{update:function(val){var binding=this;var elem=this.element;var isHtmlFilter=elem.nodeType!==1;var parent=isHtmlFilter?elem.parentNode:elem;if(!parent){return}val=val==null?"":val;if(elem.nodeType===3){var signature=generateID("html");parent.insertBefore(DOC.createComment(signature),elem);binding.element=DOC.createComment(signature+":end");parent.replaceChild(binding.element,elem);elem=binding.element}if(typeof val!=="object"){var fragment=avalon.parseHTML(String(val))}else{if(val.nodeType===11){fragment=val}else{if(val.nodeType===1||val.item){var nodes=val.nodeType===1?val.childNodes:val.item;fragment=avalonFragment.cloneNode(true);
        while(nodes[0]){fragment.appendChild(nodes[0])}}}}nodes=avalon.slice(fragment.childNodes);if(isHtmlFilter){var endValue=elem.nodeValue.slice(0,-4);while(true){var node=elem.previousSibling;if(!node||node.nodeType===8&&node.nodeValue===endValue){break}else{parent.removeChild(node)}}parent.insertBefore(fragment,elem)}else{avalon.clearHTML(elem).appendChild(fragment)}scanNodeArray(nodes,binding.vmodels)}});avalon.directive("if",{priority:10,update:function(val){var binding=this;var elem=this.element;var stamp=binding.stamp=+new Date();var par;var after=function(){if(stamp!==binding.stamp){return}binding.recoverNode=null};if(binding.recoverNode){binding.recoverNode()}try{if(!elem.parentNode){return}par=elem.parentNode}catch(e){return}if(val){function alway(){if(elem.getAttribute(binding.name)){elem.removeAttribute(binding.name);scanAttr(elem,binding.vmodels)}binding.rollback=null}if(elem.nodeType===8){var keep=binding.keep;var hasEffect=avalon.effect.apply(keep,1,function(){if(stamp!==binding.stamp){return}elem.parentNode.replaceChild(keep,elem);elem=binding.element=keep;if(keep.getAttribute("_required")){elem.required=true;elem.removeAttribute("_required")}if(elem.querySelectorAll){avalon.each(elem.querySelectorAll("[_required=true]"),function(el){el.required=true;el.removeAttribute("_required")})}alway()},after);hasEffect=hasEffect===false}if(!hasEffect){alway()}}else{if(elem.nodeType===1){if(elem.required===true){elem.required=false;elem.setAttribute("_required","true")}try{avalon.each(elem.querySelectorAll(":required"),function(el){elem.required=false;el.setAttribute("_required","true")})}catch(e){}var node=binding.element=DOC.createComment("ms-if"),pos=elem.nextSibling;binding.recoverNode=function(){binding.recoverNode=null;if(node.parentNode!==par){par.insertBefore(node,pos);binding.keep=elem}};avalon.effect.apply(elem,0,function(){binding.recoverNode=null;if(stamp!==binding.stamp){return}elem.parentNode.replaceChild(node,elem);binding.keep=elem;ifGroup.appendChild(elem);binding.rollback=function(){if(elem.parentNode===ifGroup){ifGroup.removeChild(elem)}}},after)}}}});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img;var rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im;var getXHR=function(){return new window.XMLHttpRequest()};var templatePool=avalon.templateCache={};function getTemplateContainer(binding,id,text){var div=binding.templateCache&&binding.templateCache[id];if(div){var dom=DOC.createDocumentFragment(),firstChild;while(firstChild=div.firstChild){dom.appendChild(firstChild)}return dom}return avalon.parseHTML(text)}function nodesToFrag(nodes){var frag=DOC.createDocumentFragment();for(var i=0,len=nodes.length;i<len;i++){frag.appendChild(nodes[i])}return frag}avalon.directive("include",{init:directives.attr.init,update:function(val){var binding=this;var elem=this.element;var vmodels=binding.vmodels;var rendered=binding.includeRendered;var effectClass=binding.effectName&&binding.effectClass;var templateCache=binding.templateCache;var outer=binding.includeReplace;var loaded=binding.includeLoaded;var target=outer?elem.parentNode:elem;var _ele=binding._element;binding.recoverNodes=binding.recoverNodes||avalon.noop;var scanTemplate=function(text){var _stamp=binding._stamp=+(new Date());if(loaded){var newText=loaded.apply(target,[text].concat(vmodels));if(typeof newText==="string"){text=newText}}if(rendered){checkScan(target,function(){rendered.call(target)},NaN)}var lastID=binding.includeLastID||"_default";binding.includeLastID=val;var leaveEl=templateCache&&templateCache[lastID]||DOC.createElement(elem.tagName||binding._element.tagName);if(effectClass){leaveEl.className=effectClass;target.insertBefore(leaveEl,binding.start)}(templateCache||{})[lastID]=leaveEl;var fragOnDom=binding.recoverNodes();if(fragOnDom){target.insertBefore(fragOnDom,binding.end)}while(true){var node=binding.start.nextSibling;if(node&&node!==leaveEl&&node!==binding.end){leaveEl.appendChild(node)}else{break}}avalon.effect.remove(leaveEl,target,function(){if(templateCache){if(_stamp===binding._stamp){ifGroup.appendChild(leaveEl)}}},binding);var enterEl=target,before=avalon.noop,after=avalon.noop;var fragment=getTemplateContainer(binding,val,text);var nodes=avalon.slice(fragment.childNodes);if(outer&&effectClass){enterEl=_ele;enterEl.innerHTML="";enterEl.setAttribute("ms-skip","true");target.insertBefore(enterEl,binding.end.nextSibling);before=function(){enterEl.insertBefore(fragment,null)};after=function(){binding.recoverNodes=avalon.noop;if(_stamp===binding._stamp){fragment=nodesToFrag(nodes);target.insertBefore(fragment,binding.end);scanNodeArray(nodes,vmodels)}if(enterEl.parentNode===target){target.removeChild(enterEl)}};binding.recoverNodes=function(){binding.recoverNodes=avalon.noop;return nodesToFrag(nodes)}}else{before=function(){target.insertBefore(fragment,binding.end);scanNodeArray(nodes,vmodels)}}avalon.effect.apply(enterEl,"enter",before,after)};if(binding.param==="src"){if(typeof templatePool[val]==="string"){avalon.nextTick(function(){scanTemplate(templatePool[val])
    })}else{if(Array.isArray(templatePool[val])){templatePool[val].push(scanTemplate)}else{var xhr=getXHR();xhr.onload=function(){var text=xhr.responseText;for(var f=0,fn;fn=templatePool[val][f++];){fn(text)}templatePool[val]=text};xhr.onerror=function(){log("ms-include load ["+val+"] error")};templatePool[val]=[scanTemplate];xhr.open("GET",val,true);if("withCredentials" in xhr){xhr.withCredentials=true}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send(null)}}}else{var el=val&&val.nodeType===1?val:DOC.getElementById(val);if(el){avalon.nextTick(function(){scanTemplate(el.value||el.innerText||el.innerHTML)})}}}});var rdash=/\(([^)]*)\)/;var onDir=avalon.directive("on",{priority:3000,init:function(binding){var value=binding.expr;binding.type="on";var eventType=binding.param.replace(/-\d+$/,"");if(typeof onDir[eventType+"Hook"]==="function"){onDir[eventType+"Hook"](binding)}if(value.indexOf("(")>0&&value.indexOf(")")>-1){var matched=(value.match(rdash)||["",""])[1].trim();if(matched===""||matched==="$event"){value=value.replace(rdash,"")}}binding.expr=value},update:function(callback){var binding=this;var elem=this.element;callback=function(e){var fn=binding.getter||noop;return fn.apply(this,binding.args.concat(e))};var eventType=binding.param.replace(/-\d+$/,"");if(eventType==="scan"){callback.call(elem,{type:eventType})}else{if(typeof binding.specialBind==="function"){binding.specialBind(elem,callback)}else{var removeFn=avalon.bind(elem,eventType,callback)}}binding.rollback=function(){if(typeof binding.specialUnbind==="function"){binding.specialUnbind()}else{avalon.unbind(elem,eventType,removeFn)}}}});avalon.directive("repeat",{priority:90,init:function(binding){var type=binding.type;binding.cache={};binding.enterCount=0;var elem=binding.element;if(elem.nodeType===1){elem.removeAttribute(binding.name);effectBinding(elem,binding);binding.param=binding.param||"el";binding.sortedCallback=getBindingCallback(elem,"data-with-sorted",binding.vmodels);var rendered=getBindingCallback(elem,"data-"+type+"-rendered",binding.vmodels);var signature=generateID(type);var start=DOC.createComment(signature+":start");var end=binding.element=DOC.createComment(signature+":end");binding.signature=signature;binding.start=start;binding.template=avalonFragment.cloneNode(false);if(type==="repeat"){var parent=elem.parentNode;parent.replaceChild(end,elem);parent.insertBefore(start,end);binding.template.appendChild(elem)}else{while(elem.firstChild){binding.template.appendChild(elem.firstChild)}elem.appendChild(start);elem.appendChild(end);parent=elem}binding.element=end;if(rendered){var removeFn=avalon.bind(parent,"datasetchanged",function(){rendered.apply(parent,parent.args);avalon.unbind(parent,"datasetchanged",removeFn);parent.msRendered=rendered})}}},update:function(value,oldValue){var binding=this;var xtype=this.xtype;this.enterCount+=1;var init=!oldValue;if(init){binding.$outer={};var check0="$key";var check1="$val";if(xtype==="array"){check0="$first";check1="$last"}for(var i=0,v;v=binding.vmodels[i++];){if(v.hasOwnProperty(check0)&&v.hasOwnProperty(check1)){binding.$outer=v;break}}}var track=this.track;if(binding.sortedCallback){var keys2=binding.sortedCallback.call(parent,track);if(keys2&&Array.isArray(keys2)){track=keys2}}var action="move";binding.$repeat=value;var fragments=[];var transation=init&&avalonFragment.cloneNode(false);var proxies=[];var param=this.param;var retain=avalon.mix({},this.cache);var elem=this.element;var length=track.length;var parent=elem.parentNode;for(i=0;i<length;i++){var keyOrId=track[i];var proxy=retain[keyOrId];if(!proxy){proxy=getProxyVM(this);proxy.$up=null;if(xtype==="array"){action="add";proxy.$id=keyOrId;var valueItem=value[i];proxy[param]=valueItem;if(Object(valueItem)===valueItem){valueItem.$ups=valueItem.$ups||{};valueItem.$ups[param]=proxy}}else{action="append";proxy.$key=keyOrId;proxy.$val=value[keyOrId]}this.cache[keyOrId]=proxy;var node=proxy.$anchor||(proxy.$anchor=elem.cloneNode(false));node.nodeValue=this.signature;shimController(binding,transation,proxy,fragments,init&&!binding.effectDriver);decorateProxy(proxy,binding,xtype)}else{fragments.push({});retain[keyOrId]=true}if(this.enterCount===1){proxy.$active=false;proxy.$oldIndex=proxy.$index;proxy.$active=true;proxy.$index=i}if(xtype==="array"){proxy.$first=i===0;proxy.$last=i===length-1}else{proxy.$val=toJson(value[keyOrId])}proxies.push(proxy)}this.proxies=proxies;if(init&&!binding.effectDriver){parent.insertBefore(transation,elem);fragments.forEach(function(fragment){scanNodeArray(fragment.nodes||[],fragment.vmodels);fragment.nodes=fragment.vmodels=null})}else{var staggerIndex=binding.staggerIndex=0;for(keyOrId in retain){if(retain[keyOrId]!==true){action="del";removeItem(retain[keyOrId].$anchor,binding);proxyRecycler(this.cache,keyOrId,param);retain[keyOrId]=null}}for(i=0;i<length;i++){proxy=proxies[i];keyOrId=xtype==="array"?proxy.$id:proxy.$key;var pre=proxies[i-1];var preEl=pre?pre.$anchor:binding.start;if(!retain[keyOrId]){(function(fragment,preElement){var nodes=fragment.nodes;
        var vmodels=fragment.vmodels;if(nodes){staggerIndex=mayStaggerAnimate(binding.effectEnterStagger,function(){parent.insertBefore(fragment.content,preElement.nextSibling);scanNodeArray(nodes,vmodels);animateRepeat(nodes,1,binding)},staggerIndex)}fragment.nodes=fragment.vmodels=null})(fragments[i],preEl)}else{if(proxy.$index!==proxy.$oldIndex){(function(proxy2,preElement){staggerIndex=mayStaggerAnimate(binding.effectEnterStagger,function(){var curNode=removeItem(proxy2.$anchor);var inserted=avalon.slice(curNode.childNodes);parent.insertBefore(curNode,preElement.nextSibling);animateRepeat(inserted,1,binding)},staggerIndex)})(proxy,preEl)}}}}if(!value.$track){for(keyOrId in this.cache){proxyRecycler(this.cache,keyOrId,param)}}(function(args){parent.args=args;if(parent.msRendered){parent.msRendered.apply(parent,args)}})(kernel.newWatch?arguments:[action]);var id=setTimeout(function(){clearTimeout(id);avalon.fireDom(parent,"datasetchanged",{bubble:parent.msHasEvent})});this.enterCount-=1}});"with,each".replace(rword,function(name){directives[name]=avalon.mix({},directives.repeat,{priority:1400})});function animateRepeat(nodes,isEnter,binding){for(var i=0,node;node=nodes[i++];){if(node.className===binding.effectClass){avalon.effect.apply(node,isEnter,noop,noop,binding)}}}function mayStaggerAnimate(staggerTime,callback,index){if(staggerTime){setTimeout(callback,(++index)*staggerTime)}else{callback()}return index}function removeItem(node,binding){var fragment=avalonFragment.cloneNode(false);var last=node;var breakText=last.nodeValue;var staggerIndex=binding&&Math.max(+binding.staggerIndex,0);var nodes=avalon.slice(last.parentNode.childNodes);var index=nodes.indexOf(last);while(true){var pre=nodes[--index];if(!pre||String(pre.nodeValue).indexOf(breakText)===0){break}if(binding&&(pre.className===binding.effectClass)){node=pre;(function(cur){binding.staggerIndex=mayStaggerAnimate(binding.effectLeaveStagger,function(){avalon.effect.apply(cur,0,noop,function(){fragment.appendChild(cur)},binding)},staggerIndex)})(pre)}else{fragment.insertBefore(pre,fragment.firstChild)}}fragment.appendChild(last);return fragment}function shimController(data,transation,proxy,fragments,init){var content=data.template.cloneNode(true);var nodes=avalon.slice(content.childNodes);content.appendChild(proxy.$anchor);init&&transation.appendChild(content);var nv=[proxy].concat(data.vmodels);var fragment={nodes:nodes,vmodels:nv,content:content};fragments.push(fragment)}function getProxyVM(binding){var agent=binding.xtype==="object"?withProxyAgent:eachProxyAgent;var proxy=agent(binding);var node=proxy.$anchor||(proxy.$anchor=binding.element.cloneNode(false));node.nodeValue=binding.signature;proxy.$outer=binding.$outer;return proxy}var eachProxyPool=[];function eachProxyAgent(data,proxy){var itemName=data.param||"el";for(var i=0,n=eachProxyPool.length;i<n;i++){var candidate=eachProxyPool[i];if(candidate&&candidate.hasOwnProperty(itemName)){eachProxyPool.splice(i,1);proxy=candidate;break}}if(!proxy){proxy=eachProxyFactory(itemName)}return proxy}function eachProxyFactory(itemName){var source={$outer:{},$index:0,$oldIndex:0,$anchor:null,$first:false,$last:false,$remove:avalon.noop};source[itemName]=NaN;var force={$last:1,$first:1,$index:1};force[itemName]=1;var proxy=modelFactory(source,{force:force});proxy.$id=generateID("$proxy$each");return proxy}function decorateProxy(proxy,binding,type){if(type==="array"){proxy.$remove=function(){binding.$repeat.removeAt(proxy.$index)};var param=binding.param;proxy.$watch(param,function(a){var index=proxy.$index;binding.$repeat[index]=a})}else{proxy.$watch("$val",function fn(a){binding.$repeat[proxy.$key]=a})}}var withProxyPool=[];function withProxyAgent(){return withProxyPool.pop()||withProxyFactory()}function withProxyFactory(){var proxy=modelFactory({$key:"",$val:NaN,$index:0,$oldIndex:0,$outer:{},$anchor:null},{force:{$key:1,$val:1,$index:1}});proxy.$id=generateID("$proxy$with");return proxy}function proxyRecycler(cache,key,param){var proxy=cache[key];if(proxy){var proxyPool=proxy.$id.indexOf("$proxy$each")===0?eachProxyPool:withProxyPool;proxy.$outer={};for(var i in proxy.$events){var a=proxy.$events[i];if(Array.isArray(a)){a.length=0;if(i===param){proxy[param]=NaN}else{if(i==="$val"){proxy.$val=NaN}}}}if(proxyPool.unshift(proxy)>kernel.maxRepeatSize){proxyPool.pop()}delete cache[key]}}avalon.directive("text",{update:function(val){var elem=this.element;val=val==null?"":val;if(elem.nodeType===3){try{elem.data=val}catch(e){}}else{elem.textContent=val}}});function parseDisplay(nodeName,val){var key="_"+nodeName;if(!parseDisplay[key]){var node=DOC.createElement(nodeName);root.appendChild(node);if(W3C){val=getComputedStyle(node,null).display}else{val=node.currentStyle.display}root.removeChild(node);parseDisplay[key]=val}return parseDisplay[key]}avalon.parseDisplay=parseDisplay;avalon.directive("visible",{init:function(binding){effectBinding(binding.element,binding)},update:function(val){var binding=this,elem=this.element,stamp;
        var noEffect=!this.effectName;if(!this.stamp){stamp=this.stamp=+new Date;if(val){elem.style.display=binding.display||"";if(avalon(elem).css("display")==="none"){elem.style.display=binding.display=parseDisplay(elem.nodeName)}}else{elem.style.display="none"}return}stamp=this.stamp=+new Date;if(val){avalon.effect.apply(elem,1,function(){if(stamp!==binding.stamp){return}var driver=elem.getAttribute("data-effect-driver")||"a";if(noEffect){elem.style.display=binding.display||""}if(driver==="a"||driver==="t"){if(avalon(elem).css("display")==="none"){elem.style.display=binding.display||parseDisplay(elem.nodeName)}}})}else{avalon.effect.apply(elem,0,function(){if(stamp!==binding.stamp){return}elem.style.display="none"})}}});var rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim;var ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g;var ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig;var rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig};var rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;var rnoalphanumeric=/([^\#-~| |!])/g;function numberFormat(number,decimals,point,thousands){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?3:Math.abs(decimals),sep=thousands||",",dec=point||".",s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+(Math.round(n*k)/k).toFixed(prec)};s=(prec?toFixedFix(n,prec):""+Math.round(n)).split(".");if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)}if((s[1]||"").length<prec){s[1]=s[1]||"";s[1]+=new Array(prec-s[1].length+1).join("0")}return s.join(dec)}var filters=avalon.filters={uppercase:function(str){return str.toUpperCase()},lowercase:function(str){return str.toLowerCase()},truncate:function(str,length,truncation){length=length||30;truncation=typeof truncation==="string"?truncation:"...";return str.length>length?str.slice(0,length-truncation.length)+truncation:String(str)},$filter:function(val){for(var i=1,n=arguments.length;i<n;i++){var array=arguments[i];var fn=avalon.filters[array[0]];if(typeof fn==="function"){var arr=[val].concat(array.slice(1));val=fn.apply(null,arr)}}return val},camelize:camelize,sanitize:function(str){return str.replace(rscripts,"").replace(ropen,function(a,b){var match=a.toLowerCase().match(/<(\w+)\s/);if(match){var reg=rsanitize[match[1]];if(reg){a=a.replace(reg,function(s,name,value){var quote=value.charAt(0);return name+"="+quote+"javascript:void(0)"+quote})}}return a.replace(ron," ").replace(/\s+/g," ")})},escape:function(str){return String(str).replace(/&/g,"&amp;").replace(rsurrogate,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return"&#"+(((hi-55296)*1024)+(low-56320)+65536)+";"}).replace(rnoalphanumeric,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(amount,symbol,fractionSize){return(symbol||"\uFFE5")+numberFormat(amount,isFinite(fractionSize)?fractionSize:2)},number:numberFormat};new function(){function toInt(str){return parseInt(str,10)||0}function padNumber(num,digits,trim){var neg="";if(num<0){neg="-";num=-num}num=""+num;while(num.length<digits){num="0"+num}if(trim){num=num.substr(num.length-digits)}return neg+num}function dateGetter(name,size,offset,trim){return function(date){var value=date["get"+name]();if(offset>0||value>-offset){value+=offset}if(value===0&&offset===-12){value=12}return padNumber(value,size,trim)}}function dateStrGetter(name,shortForm){return function(date,formats){var value=date["get"+name]();var get=(shortForm?("SHORT"+name):name).toUpperCase();return formats[get][value]}}function timeZoneGetter(date){var zone=-1*date.getTimezoneOffset();var paddedZone=(zone>=0)?"+":"";paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2);return paddedZone}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}var DATE_FORMATS={yyyy:dateGetter("FullYear",4),yy:dateGetter("FullYear",2,0,true),y:dateGetter("FullYear",1),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",true),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",true),a:ampmGetter,Z:timeZoneGetter};var rdateFormat=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/;var raspnetjson=/^\/Date\((\d+)\)\/$/;filters.date=function(date,format){var locate=filters.date.locate,text="",parts=[],fn,match;format=format||"mediumDate";format=locate[format]||format;if(typeof date==="string"){if(/^\d+$/.test(date)){date=toInt(date)}else{if(raspnetjson.test(date)){date=+RegExp.$1
    }else{var trimDate=date.trim();var dateArray=[0,0,0,0,0,0,0];var oDate=new Date(0);trimDate=trimDate.replace(/^(\d+)\D(\d+)\D(\d+)/,function(_,a,b,c){var array=c.length===4?[c,a,b]:[a,b,c];dateArray[0]=toInt(array[0]);dateArray[1]=toInt(array[1])-1;dateArray[2]=toInt(array[2]);return""});var dateSetter=oDate.setFullYear;var timeSetter=oDate.setHours;trimDate=trimDate.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(_,a,b,c,d){dateArray[3]=toInt(a);dateArray[4]=toInt(b);dateArray[5]=toInt(c);if(d){dateArray[6]=Math.round(parseFloat("0."+d)*1000)}return""});var tzHour=0;var tzMin=0;trimDate=trimDate.replace(/Z|([+-])(\d\d):?(\d\d)/,function(z,symbol,c,d){dateSetter=oDate.setUTCFullYear;timeSetter=oDate.setUTCHours;if(symbol){tzHour=toInt(symbol+c);tzMin=toInt(symbol+d)}return""});dateArray[3]-=tzHour;dateArray[4]-=tzMin;dateSetter.apply(oDate,dateArray.slice(0,3));timeSetter.apply(oDate,dateArray.slice(3));date=oDate}}}if(typeof date==="number"){date=new Date(date)}if(avalon.type(date)!=="date"){return}while(format){match=rdateFormat.exec(format);if(match){parts=parts.concat(match.slice(1));format=parts.pop()}else{parts.push(format);format=null}}parts.forEach(function(value){fn=DATE_FORMATS[value];text+=fn?fn(date,locate):value.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return text};var locate={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{"0":"周日","1":"周一","2":"周二","3":"周三","4":"周四","5":"周五","6":"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};locate.SHORTMONTH=locate.MONTH;filters.date.locate=locate};var modules=avalon.modules={"domReady!":{exports:avalon,state:3},"avalon":{exports:avalon,state:4}};modules.exports=modules.avalon;var otherRequire=window.require;var otherDefine=window.define;var innerRequire;plugins.loader=function(builtin){var flag=innerRequire&&builtin;window.require=flag?innerRequire:otherRequire;window.define=flag?innerRequire.define:otherDefine};new function(){var loadings=[];var factorys=[];var rjsext=/\.js$/i;function makeRequest(name,config){var res="js";name=name.replace(/^(\w+)\!/,function(a,b){res=b;return""});if(res==="ready"){log("debug: ready!已经被废弃，请使用domReady!");res="domReady"}var query="";name=name.replace(rquery,function(a){query=a;return""});var suffix="."+res;var ext=/js|css/.test(suffix)?suffix:"";name=name.replace(/\.[a-z0-9]+$/g,function(a){if(a===suffix){ext=a;return""}else{return a}});var req=avalon.mix({query:query,ext:ext,res:res,name:name,toUrl:toUrl},config);req.toUrl(name);return req}function fireRequest(req){var name=req.name;var res=req.res;var module=modules[name];var urlNoQuery=name&&req.urlNoQuery;if(module&&module.state>=1){return name}module=modules[urlNoQuery];if(module&&module.state>=3){innerRequire(module.deps||[],module.factory,urlNoQuery);return urlNoQuery}if(name&&!module){module=modules[urlNoQuery]={id:urlNoQuery,state:1};var wrap=function(obj){resources[res]=obj;obj.load(name,req,function(a){if(arguments.length&&a!==void 0){module.exports=a}module.state=4;checkDeps()})};if(!resources[res]){innerRequire([res],wrap)}else{wrap(resources[res])}}return name?urlNoQuery:res+"!"}var requireQueue=[];var isUserFirstRequire=false;innerRequire=avalon.require=function(array,factory,parentUrl,defineConfig){if(!isUserFirstRequire){requireQueue.push(avalon.slice(arguments));if(arguments.length<=2){isUserFirstRequire=true;var queue=requireQueue.splice(0,requireQueue.length),args;while(args=queue.shift()){innerRequire.apply(null,args)}}return}if(!Array.isArray(array)){avalon.error("require方法的第一个参数应为数组 "+array)}var deps=[];var uniq=createMap();var id=parentUrl||"callback"+setTimeout("1");defineConfig=defineConfig||createMap();defineConfig.baseUrl=kernel.baseUrl;var isBuilt=!!defineConfig.built;if(parentUrl){defineConfig.parentUrl=parentUrl.substr(0,parentUrl.lastIndexOf("/"));defineConfig.mapUrl=parentUrl.replace(rjsext,"")}if(isBuilt){var req=makeRequest(defineConfig.defineName,defineConfig);id=req.urlNoQuery}else{array.forEach(function(name){var req=makeRequest(name,defineConfig);var url=fireRequest(req);if(url){if(!uniq[url]){deps.push(url);uniq[url]="司徒正美"}}})}var module=modules[id];if(!module||module.state!==4){modules[id]={id:id,deps:isBuilt?array.concat():deps,factory:factory||noop,state:3}}if(!module){loadings.push(id)}checkDeps()};innerRequire.define=function(name,deps,factory){if(typeof name!=="string"){factory=deps;deps=name;name="anonymous"}if(!Array.isArray(deps)){factory=deps;deps=[]}var config={built:!isUserFirstRequire,defineName:name};var args=[deps,factory,config];factory.require=function(url){args.splice(2,0,url);if(modules[url]){modules[url].state=3;var isCycle=false;try{isCycle=checkCycle(modules[url].deps,url)}catch(e){}if(isCycle){avalon.error(url+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+url+"模块")
    }}delete factory.require;innerRequire.apply(null,args)};var url=config.built?"unknown":getCurrentScript();if(url){var module=modules[url];if(module){module.state=2}factory.require(url)}else{factorys.push(factory)}};innerRequire.config=kernel;innerRequire.define.amd=modules;var allpaths=kernel["orig.paths"]=createMap();var allmaps=kernel["orig.map"]=createMap();var allpackages=kernel["packages"]=[];var allargs=kernel["orig.args"]=createMap();avalon.mix(plugins,{paths:function(hash){avalon.mix(allpaths,hash);kernel.paths=makeIndexArray(allpaths)},map:function(hash){avalon.mix(allmaps,hash);var list=makeIndexArray(allmaps,1,1);avalon.each(list,function(_,item){item.val=makeIndexArray(item.val)});kernel.map=list},packages:function(array){array=array.concat(allpackages);var uniq=createMap();var ret=[];for(var i=0,pkg;pkg=array[i++];){pkg=typeof pkg==="string"?{name:pkg}:pkg;var name=pkg.name;if(!uniq[name]){var url=joinPath(pkg.location||name,pkg.main||"main");url=url.replace(rjsext,"");ret.push(pkg);uniq[name]=pkg.location=url;pkg.reg=makeMatcher(name)}}kernel.packages=ret.sort()},urlArgs:function(hash){if(typeof hash==="string"){hash={"*":hash}}avalon.mix(allargs,hash);kernel.urlArgs=makeIndexArray(allargs,1)},baseUrl:function(url){if(!isAbsUrl(url)){var baseElement=head.getElementsByTagName("base")[0];if(baseElement){head.removeChild(baseElement)}var node=DOC.createElement("a");node.href=url;url=node.href;if(baseElement){head.insertBefore(baseElement,head.firstChild)}}if(url.length>3){kernel.baseUrl=url}},shim:function(obj){for(var i in obj){var value=obj[i];if(Array.isArray(value)){value=obj[i]={deps:value}}if(!value.exportsFn&&(value.exports||value.init)){value.exportsFn=makeExports(value)}}kernel.shim=obj}});function checkCycle(deps,nick){for(var i=0,id;id=deps[i++];){if(modules[id].state!==4&&(id===nick||checkCycle(modules[id].deps,nick))){return true}}}function checkFail(node,onError){var id=trimQuery(node.src);node.onload=node.onerror=null;if(onError){setTimeout(function(){head.removeChild(node);node=null});log("debug: 加载 "+id+" 失败"+onError+" "+(!modules[id].state))}else{return true}}function checkDeps(){loop:for(var i=loadings.length,id;id=loadings[--i];){var obj=modules[id],deps=obj.deps;if(!deps){continue}for(var j=0,key;key=deps[j];j++){if(Object(modules[key]).state!==4){continue loop}}if(obj.state!==4){loadings.splice(i,1);fireFactory(obj.id,obj.deps,obj.factory);checkDeps()}}}function loadJS(url,id,callback){var node=DOC.createElement("script");node.className=subscribers;node.onload=function(){var factory=factorys.pop();factory&&factory.require(id);if(callback){callback()}log("debug: 已成功加载 "+url);id&&loadings.push(id);checkDeps()};node.onerror=function(){checkFail(node,true)};head.insertBefore(node,head.firstChild);node.src=url;log("debug: 正准备加载 "+url)}var resources=innerRequire.plugins={domReady:{load:noop},js:{load:function(name,req,onLoad){var url=req.url;var id=req.urlNoQuery;var shim=kernel.shim[name.replace(rjsext,"")];if(shim){innerRequire(shim.deps||[],function(){var args=avalon.slice(arguments);loadJS(url,id,function(){onLoad(shim.exportsFn?shim.exportsFn.apply(0,args):void 0)})})}else{loadJS(url,id)}}},css:{load:function(name,req,onLoad){var url=req.url;head.insertAdjacentHTML("afterBegin",'<link rel="stylesheet" href="'+url+'">');log("debug: 已成功加载 "+url);onLoad()}},text:{load:function(name,req,onLoad){var url=req.url;var xhr=getXHR();xhr.onload=function(){var status=xhr.status;if(status>399&&status<600){avalon.error(url+" 对应资源不存在或没有开启 CORS")}else{log("debug: 已成功加载 "+url);onLoad(xhr.responseText)}};var time="_="+(new Date()-0);var _url=url.indexOf("?")===-1?url+"?"+time:url+"&"+time;xhr.open("GET",_url,true);if("withCredentials" in xhr){xhr.withCredentials=true}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send();log("debug: 正准备加载 "+url)}}};innerRequire.checkDeps=checkDeps;var rquery=/(\?[^#]*)$/;function trimQuery(url){return(url||"").replace(rquery,"")}function isAbsUrl(path){return/^(?:[a-z]+:)?\/\//i.test(String(path))}function getCurrentScript(){var stack;try{a.b.c()}catch(e){stack=e.stack}if(stack){stack=stack.split(/[@ ]/g).pop();stack=stack[0]==="("?stack.slice(1,-1):stack.replace(/\s/,"");return trimQuery(stack.replace(/(:\d+)?:\d+$/i,""))}var nodes=head.getElementsByTagName("script");for(var i=nodes.length,node;node=nodes[--i];){if(node.className===subscribers&&node.readyState==="interactive"){var url=node.src;return node.className=trimQuery(url)}}}var rcallback=/^callback\d+$/;function fireFactory(id,deps,factory){var module=Object(modules[id]);module.state=4;for(var i=0,array=[],d;d=deps[i++];){if(d==="exports"){var obj=module.exports||(module.exports=createMap());array.push(obj)}else{array.push(modules[d].exports)}}try{var ret=factory.apply(window,array)}catch(e){log("执行["+id+"]模块的factory抛错： ",e)}if(ret!==void 0){module.exports=ret}if(rcallback.test(id)){delete modules[id]}delete module.factory;return ret}function toUrl(id){if(id.indexOf(this.res+"!")===0){id=id.slice(this.res.length+1)
    }var url=id;var usePath=0;var baseUrl=this.baseUrl;var rootUrl=this.parentUrl||baseUrl;eachIndexArray(id,kernel.paths,function(value,key){url=url.replace(key,value);usePath=1});if(!usePath){eachIndexArray(id,kernel.packages,function(value,key,item){url=url.replace(item.name,item.location)})}if(this.mapUrl){eachIndexArray(this.mapUrl,kernel.map,function(array){eachIndexArray(url,array,function(mdValue,mdKey){url=url.replace(mdKey,mdValue);rootUrl=baseUrl})})}var ext=this.ext;if(ext&&usePath&&url.slice(-ext.length)===ext){url=url.slice(0,-ext.length)}if(!isAbsUrl(url)){rootUrl=this.built||/^\w/.test(url)?baseUrl:rootUrl;url=joinPath(rootUrl,url)}var urlNoQuery=url+ext;url=urlNoQuery+this.query;urlNoQuery=url.replace(rquery,function(a){this.query=a;return""});eachIndexArray(id,kernel.urlArgs,function(value){url+=(url.indexOf("?")===-1?"?":"&")+value});this.url=url;return this.urlNoQuery=urlNoQuery}function makeIndexArray(hash,useStar,part){var index=hash2array(hash,useStar,part);index.sort(descSorterByName);return index}function makeMatcher(prefix){return new RegExp("^"+prefix+"(/|$)")}function makeExports(value){return function(){var ret;if(value.init){ret=value.init.apply(window,arguments)}return ret||(value.exports&&getGlobal(value.exports))}}function hash2array(hash,useStar,part){var array=[];for(var key in hash){var item={name:key,val:hash[key]};array.push(item);item.reg=key==="*"&&useStar?/^/:makeMatcher(key);if(part&&key!=="*"){item.reg=new RegExp("/"+key.replace(/^\//,"")+"(/|$)")}}return array}function eachIndexArray(moduleID,array,matcher){array=array||[];for(var i=0,el;el=array[i++];){if(el.reg.test(moduleID)){matcher(el.val,el.name,el);return false}}}function descSorterByName(a,b){var aaa=a.name;var bbb=b.name;if(bbb==="*"){return -1}if(aaa==="*"){return 1}return bbb.length-aaa.length}var rdeuce=/\/\w+\/\.\./;function joinPath(a,b){if(a.charAt(a.length-1)!=="/"){a+="/"}if(b.slice(0,2)==="./"){return a+b.slice(2)}if(b.slice(0,2)===".."){a+=b;while(rdeuce.test(a)){a=a.replace(rdeuce,"")}return a}if(b.slice(0,1)==="/"){return a+b.slice(1)}return a+b}function getGlobal(value){if(!value){return value}var g=window;value.split(".").forEach(function(part){g=g[part]});return g}var mainNode=DOC.scripts[DOC.scripts.length-1];var dataMain=mainNode.getAttribute("data-main");if(dataMain){plugins.baseUrl(dataMain);var href=kernel.baseUrl;kernel.baseUrl=href.slice(0,href.lastIndexOf("/")+1);loadJS(href.replace(rjsext,"")+".js")}else{var loaderUrl=trimQuery(mainNode.src);kernel.baseUrl=loaderUrl.slice(0,loaderUrl.lastIndexOf("/")+1)}};var readyList=[],isReady;var fireReady=function(fn){isReady=true;var require=avalon.require;if(require&&require.checkDeps){modules["domReady!"].state=4;require.checkDeps()}while(fn=readyList.shift()){fn(avalon)}};if(DOC.readyState==="complete"){setTimeout(fireReady)}else{DOC.addEventListener("DOMContentLoaded",fireReady)}window.addEventListener("load",fireReady);avalon.ready=function(fn){if(!isReady){readyList.push(fn)}else{fn(avalon)}};avalon.config({loader:true});avalon.ready(function(){avalon.scan(DOC.body)});var ua=navigator.userAgent.toLowerCase();function iOSversion(){if(/iPad|iPhone|iPod/i.test(ua)&&!window.MSStream){if("backdropFilter" in document.documentElement.style){return 9}if(!!window.indexedDB){return 8}if(!!window.SpeechSynthesisUtterance){return 7}if(!!window.webkitAudioContext){return 6}if(!!window.matchMedia){return 5}if(!!window.history&&"pushState" in window.history){return 4}return 3}return NaN}var deviceIsAndroid=ua.indexOf("android")>0;var deviceIsIOS=iOSversion();var Recognizer=avalon.gestureHooks={pointers:{},start:function(event,callback){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];var pointer={startTouch:mixLocations({},touch),startTime:Date.now(),status:"tapping",element:event.target};Recognizer.pointers[touch.identifier]=pointer;callback(pointer,touch)}},move:function(event,callback){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];var pointer=Recognizer.pointers[touch.identifier];if(!pointer){return}if(!("lastTouch" in pointer)){pointer.lastTouch=pointer.startTouch;pointer.lastTime=pointer.startTime;pointer.deltaX=pointer.deltaY=pointer.duration=pointer.distance=0}var time=Date.now()-pointer.lastTime;if(time>0){var RECORD_DURATION=70;if(time>RECORD_DURATION){time=RECORD_DURATION}if(pointer.duration+time>RECORD_DURATION){pointer.duration=RECORD_DURATION-time}pointer.duration+=time;pointer.lastTouch=mixLocations({},touch);pointer.lastTime=Date.now();pointer.deltaX=touch.clientX-pointer.startTouch.clientX;pointer.deltaY=touch.clientY-pointer.startTouch.clientY;var x=pointer.deltaX*pointer.deltaX;var y=pointer.deltaY*pointer.deltaY;pointer.distance=Math.sqrt(x+y);pointer.isVertical=x<y;callback(pointer,touch)}}},end:function(event,callback){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i],id=touch.identifier,pointer=Recognizer.pointers[id];if(!pointer){continue
    }callback(pointer,touch);delete Recognizer.pointers[id]}},fire:function(elem,type,props){if(elem){var event=document.createEvent("Events");event.initEvent(type,true,true);avalon.mix(event,props);elem.dispatchEvent(event)}},add:function(name,recognizer){function move(event){recognizer.touchmove(event)}function end(event){recognizer.touchend(event);document.removeEventListener("touchmove",move);document.removeEventListener("touchend",end);document.removeEventListener("touchcancel",cancel)}function cancel(event){recognizer.touchcancel(event);document.removeEventListener("touchmove",move);document.removeEventListener("touchend",end);document.removeEventListener("touchcancel",cancel)}recognizer.events.forEach(function(eventName){avalon.eventHooks[eventName]={fn:function(el,fn){if(!el["touch-"+name]){el["touch-"+name]="1";el.addEventListener("touchstart",function(event){recognizer.touchstart(event);document.addEventListener("touchmove",move);document.addEventListener("touchend",end);document.addEventListener("touchcancel",cancel)})}return fn}}})}};var locations=["screenX","screenY","clientX","clientY","pageX","pageY"];function mixLocations(target,source){if(source){locations.forEach(function(key){target[key]=source[key]})}return target}var supportPointer=!!navigator.pointerEnabled||!!navigator.msPointerEnabled;if(supportPointer){root.style.msTouchAction=root.style.touchAction="none"}var tapRecognizer={events:["tap"],touchBoundary:10,tapDelay:200,needClick:function(target){switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled){return true}break;case"input":if((deviceIsIOS&&target.type==="file")||target.disabled){return true}break;case"label":case"iframe":case"video":return true}return false},needFocus:function(target){switch(target.nodeName.toLowerCase()){case"textarea":case"select":return true;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return !target.disabled&&!target.readOnly;default:return false}},focus:function(targetElement){var length;var type=targetElement.type;if(deviceIsIOS&&targetElement.setSelectionRange&&type.indexOf("date")!==0&&type!=="time"&&type!=="month"){length=targetElement.value.length;targetElement.setSelectionRange(length,length)}else{targetElement.focus()}},findControl:function(labelElement){if(labelElement.control!==undefined){return labelElement.control}if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor)}return labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},fixTarget:function(target){if(target.nodeType===3){return target.parentNode}if(window.SVGElementInstance&&(target instanceof SVGElementInstance)){return target.correspondingUseElement}return target},updateScrollParent:function(targetElement){var scrollParent=targetElement.tapScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){var parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.tapScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}if(scrollParent){scrollParent.lastScrollTop=scrollParent.scrollTop}},touchHasMoved:function(event){var touch=event.changedTouches[0],boundary=tapRecognizer.touchBoundary;return Math.abs(touch.pageX-tapRecognizer.touchStartX)>boundary||Math.abs(touch.pageY-tapRecognizer.touchStartY)>boundary},findType:function(targetElement){return deviceIsAndroid&&targetElement.tagName.toLowerCase()==="select"?"mousedown":"click"},sendClick:function(targetElement,event){Recognizer.fire(targetElement,"tap",{touchEvent:event});var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur()}touch=event.changedTouches[0];clickEvent=document.createEvent("MouseEvents");clickEvent.initMouseEvent(tapRecognizer.findType(targetElement),true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.touchEvent=event;targetElement.dispatchEvent(clickEvent)},touchstart:function(event){if(event.targetTouches.length!==1){return true}var targetElement=tapRecognizer.fixTarget(event.target);var touch=event.targetTouches[0];if(deviceIsIOS){var selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true}var id=touch.identifier;if(id&&isFinite(tapRecognizer.lastTouchIdentifier)&&tapRecognizer.lastTouchIdentifier===id){event.preventDefault();return false}tapRecognizer.lastTouchIdentifier=id;tapRecognizer.updateScrollParent(targetElement)}tapRecognizer.status="tapping";tapRecognizer.startTime=Date.now();tapRecognizer.element=targetElement;tapRecognizer.pageX=touch.pageX;tapRecognizer.pageY=touch.pageY;if((tapRecognizer.startTime-tapRecognizer.lastTime)<tapRecognizer.tapDelay){event.preventDefault()}},touchmove:function(event){if(tapRecognizer.status!=="tapping"){return true
    }if(tapRecognizer.element!==tapRecognizer.fixTarget(event.target)||tapRecognizer.touchHasMoved(event)){tapRecognizer.status=tapRecognizer.element=0}},touchend:function(event){var targetElement=tapRecognizer.element;var now=Date.now();if(!targetElement||now-tapRecognizer.startTime>tapRecognizer.tapDelay){return true}tapRecognizer.lastTime=now;var startTime=tapRecognizer.startTime;tapRecognizer.status=tapRecognizer.startTime=0;targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==="label"){Recognizer.fire(targetElement,"tap",{touchEvent:event});var forElement=tapRecognizer.findControl(targetElement);if(forElement){tapRecognizer.focus(targetElement);targetElement=forElement}}else{if(tapRecognizer.needFocus(targetElement)){if((now-startTime)>100||(deviceIsIOS&&window.top!==window&&targetTagName==="input")){tapRecognizer.element=0;return false}tapRecognizer.focus(targetElement);deviceIsAndroid&&tapRecognizer.sendClick(targetElement,event);return false}}if(deviceIsIOS){var scrollParent=targetElement.tapScrollParent;if(scrollParent&&scrollParent.lastScrollTop!==scrollParent.scrollTop){return true}}if(!tapRecognizer.needClick(targetElement)){event.preventDefault();tapRecognizer.sendClick(targetElement,event)}},touchcancel:function(){tapRecognizer.startTime=tapRecognizer.element=0}};Recognizer.add("tap",tapRecognizer);var pressRecognizer={events:["longtap","doubletap"],cancelPress:function(pointer){clearTimeout(pointer.pressingHandler);pointer.pressingHandler=null},touchstart:function(event){Recognizer.start(event,function(pointer,touch){pointer.pressingHandler=setTimeout(function(){if(pointer.status==="tapping"){Recognizer.fire(event.target,"longtap",{touch:touch,touchEvent:event})}pressRecognizer.cancelPress(pointer)},500);if(event.changedTouches.length!==1){pointer.status=0}})},touchmove:function(event){Recognizer.move(event,function(pointer){if(pointer.distance>10&&pointer.pressingHandler){pressRecognizer.cancelPress(pointer);if(pointer.status==="tapping"){pointer.status="panning"}}})},touchend:function(event){Recognizer.end(event,function(pointer,touch){pressRecognizer.cancelPress(pointer);if(pointer.status==="tapping"){pointer.lastTime=Date.now();if(pressRecognizer.lastTap&&pointer.lastTime-pressRecognizer.lastTap.lastTime<300){Recognizer.fire(pointer.element,"doubletap",{touch:touch,touchEvent:event})}pressRecognizer.lastTap=pointer}})},touchcancel:function(event){Recognizer.end(event,function(pointer){pressRecognizer.cancelPress(pointer)})}};Recognizer.add("press",pressRecognizer);var swipeRecognizer={events:["swipe","swipeleft","swiperight","swipeup","swipedown"],getAngle:function(x,y){return Math.atan2(y,x)*180/Math.PI},getDirection:function(x,y){var angle=swipeRecognizer.getAngle(x,y);if((angle<-45)&&(angle>-135)){return"up"}else{if((angle>=45)&&(angle<315)){return"down"}else{if((angle>-45)&&(angle<=45)){return"right"}else{return"left"}}}},touchstart:function(event){Recognizer.start(event,noop)},touchmove:function(event){Recognizer.move(event,noop)},touchend:function(event){if(event.changedTouches.length!==1){return}Recognizer.end(event,function(pointer,touch){var isflick=(pointer.distance>30&&pointer.distance/pointer.duration>0.65);if(isflick){var extra={deltaX:pointer.deltaX,deltaY:pointer.deltaY,touch:touch,touchEvent:event,direction:swipeRecognizer.getDirection(pointer.deltaX,pointer.deltaY),isVertical:pointer.isVertical};var target=pointer.element;Recognizer.fire(target,"swipe",extra);Recognizer.fire(target,"swipe"+extra.direction,extra)}})}};swipeRecognizer.touchcancel=swipeRecognizer.touchend;Recognizer.add("swipe",swipeRecognizer);if(typeof define==="function"&&define.amd){define("avalon",[],function(){return avalon})}var _avalon=window.avalon;avalon.noConflict=function(deep){if(deep&&window.avalon===avalon){window.avalon=_avalon}return avalon};if(noGlobal===void 0){window.avalon=avalon}return avalon}));