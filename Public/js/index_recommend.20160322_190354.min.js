	/**
	 * 查询首页精选推荐信息  
	 * ms-controller="index_recommend_controller"
	 * ms-repeat-el="recommend_list"   推荐数据
	 * ms-repeat-el="area_list"   	      地区数据
	 * ms-repeat-el="advert_list"      广告数据
	 * 
	 * 详情参考接口文档  api.open.system.index_recommend
	 */
   	var index_recommend_model = avalon.define({   //avalon model定义方式
   		$id : "index_recommend_controller",
   		area_id : "", 
   		area_name : "",
   		page_num : 1,
   		next_page : 1, //是否包含下一页  0-无  1-有
   		recommend_list : [],
   		area_list : [],
   		advert_list : [],
        sponsor_list : [],//主办方列表
   		is_show_more_info : false,   //是否显示查看更多链接

        login_user_id : 0,//登录的用户id
        focus_shop_id : 0,//用户每次关注的店铺id

        focusShop : function(shopId){

            if(!_user._login()){
                _user._toLogin();
                return;
            }

            if(shopId == "0"){
                alert("shopId错误：" + shopId);
                return;
            }

            index_recommend_model.focus_shop_id = shopId;

            _$(_api3._shopAttent, "focus_type=1&focus_shop_id=" + shopId, index_recommend_model.focusShopOk);
        },

        focusShopOk : function(data){


            if(data.is_update == 0){
            	_toast._show("关注成功");
                $("#sponsor_shop_" + index_recommend_model.focus_shop_id).find("a").eq(1).remove();
                $("#sponsor_shop_" + index_recommend_model.focus_shop_id).append('<span>已关注</span>');

            }else{
            	_toast._show("关注失败");
            }

            index_recommend_model.focus_shop_id = 0;

        },

   		/**
   		 * 查询下一页数据
   		 * @param {Object} callback 回调函数
   		 */
   		queryNextPage : function(callback){
   			//console.log("查询下一页");
   			index_recommend_model.page_num = index_recommend_model.page_num+1; //当前页+1
   			index_recommend_model.queryIndexRecommend("","",index_recommend_model.page_num,callback);
   		},
   		
   		/**
   		 * 循环结束之后的回调函数，
   		 */
   		repeatCallback : function(){
   			
   		},
   		
   		/**
   		 * 查询首页数据
   		 * @param {Object} area_id   地区ID
   		 * @param {Object} area_name 地区名称
   		 */
   		queryIndexRecommend : function(area_id,area_name,page_num,callback,isHiddenArea){
   			
   			if(area_id!=""){
   				index_recommend_model.area_id=area_id;
   				
   				require(["oniui/cookie/avalon.cookie"], function(avalon) {
			        var cookie = avalon.cookie
			        cookie.set("AREA_SIGN", area_id); //设置当前地区的cookie
			    })
			}
   			if(area_name!=""){
   				index_recommend_model.area_name=area_name;
   			}
   			//如果是隐藏低去的回调，则在这里执行
   			if(isHiddenArea != undefined && isHiddenArea == true ){
   				if(callback != undefined){
			    	callback(); //执行回调函数
				}
   			}
   			
   			require(['avalon', "mmRequest"], function(avalon) {  //使用avalon自带的ajax需在使用前加载mmRequest

                avalon.ajax({
                    type:'get',
                    url:'/post/api:135?area_id=' + area_id,
                    dataType:'json',
                    cache:false
                }).done(function(data){

                    index_recommend_model.sponsor_list = data.sponsorList;
                    index_recommend_model.login_user_id = data.login_user_id;

                });

				avalon.ajax({
			    	type:"get",
					url:"/post/api:120?area_id="+area_id+"&page_num="+page_num,
					dataType: 'json',
					cache: false
				}).done(function(data) {
//					avalon.log(data);
	
					if(page_num==1){
						if(data.recommend_list!=""){
							index_recommend_model.recommend_list = data.recommend_list;
						}else{
							index_recommend_model.recommend_list = [];
						}
						if(data.area_list!=""){
							index_recommend_model.area_list = data.area_list;
						}else{
							index_recommend_model.area_list = [];
						}
						if(data.advert_list!=""){
							index_recommend_model.advert_list = data.advert_list;
						}else{
							index_recommend_model.advert_list = [];
						}
						
						$(document).scrollTop(0);  //页面跳转至最上端
						
					}else{
						if(data.recommend_list!=""){
							index_recommend_model.recommend_list.pushArray(data.recommend_list);
						}
					}
					
					index_recommend_model.next_page = data.next_page;
					
					//如果不是隐藏低去的回调，最后执行
		   			if(isHiddenArea == undefined || isHiddenArea == false ){
		   				if(callback != undefined){
					    	callback(data.next_page); //执行回调函数
						}
		   			}
		   			
		   			//页面数据生成之后，展示查看更多( wap 首页使用)
		   			index_recommend_model.is_show_more_info=true;
		   			
				});


			});
   		}
   	});
